/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@google/model-viewer@4.1.0/lib/model-viewer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{property as t}from"/npm/lit@3.2.1/decorators.js/+esm";import{ACESFilmicToneMapping as e,AgXToneMapping as i,ReinhardToneMapping as s,CineonToneMapping as n,LinearToneMapping as a,NoToneMapping as r,NeutralToneMapping as o,Texture as l,EventDispatcher as h,Vector2 as c,Mesh as u,BufferGeometry as d,Float32BufferAttribute as p,DoubleSide as m,PlaneGeometry as g,BoxGeometry as f,Spherical as v,Vector3 as y,Matrix3 as b,Euler as w,Quaternion as S,Matrix4 as x,PerspectiveCamera as M,Line as C,Material as T,Sphere as R,FrontSide as A,Scene as L,MeshStandardMaterial as E,BackSide as P,PointLight as k,MeshBasicMaterial as D,TextureLoader as F,HalfFloatType as O,EquirectangularReflectionMapping as I,SRGBColorSpace as z,WebGLCubeRenderTarget as V,RGBAFormat as N,LinearSRGBColorSpace as B,CubeCamera as j,ShaderMaterial as U,NoBlending as _,WebGLRenderer as H,OrthographicCamera as q,WebGLRenderTarget as W,RepeatWrapping as G,ClampToEdgeWrapping as X,MirroredRepeatWrapping as $,NearestFilter as Y,LinearFilter as K,NearestMipmapNearestFilter as Z,LinearMipmapNearestFilter as J,NearestMipmapLinearFilter as Q,LinearMipmapLinearFilter as tt,Color as et,VideoTexture as it,CanvasTexture as st,SphereGeometry as nt,Triangle as at,Object3D as rt,MeshDepthMaterial as ot,Box3 as lt,Raycaster as ht,AnimationMixer as ct,LoopPingPong as ut,LoopRepeat as dt,LoopOnce as pt}from"/npm/three@0.172.0/+esm";export{CanvasTexture,FileLoader,Loader,NearestFilter}from"/npm/three@0.172.0/+esm";import{html as mt,render as gt,ReactiveElement as ft}from"/npm/lit@3.2.1/+esm";import{MeshoptDecoder as vt}from"/npm/three@0.172.0/examples/jsm/libs/meshopt_decoder.module.js/+esm";import{DRACOLoader as yt}from"/npm/three@0.172.0/examples/jsm/loaders/DRACOLoader.js/+esm";import{GLTFLoader as bt}from"/npm/three@0.172.0/examples/jsm/loaders/GLTFLoader.js/+esm";import{KTX2Loader as wt}from"/npm/three@0.172.0/examples/jsm/loaders/KTX2Loader.js/+esm";import{CSS2DObject as St,CSS2DRenderer as xt}from"/npm/three@0.172.0/examples/jsm/renderers/CSS2DRenderer.js/+esm";import{reduceVertices as Mt}from"/npm/three@0.172.0/examples/jsm/utils/SceneUtils.js/+esm";import{GLTFExporter as Ct}from"/npm/three@0.172.0/examples/jsm/exporters/GLTFExporter.js/+esm";import{XREstimatedLight as Tt}from"/npm/three@0.172.0/examples/jsm/webxr/XREstimatedLight.js/+esm";import*as Rt from"/npm/three@0.172.0/examples/jsm/utils/SkeletonUtils.js/+esm";import{HDRJPGLoader as At}from"/npm/@monogrid/gainmap-js@3.1.0/+esm";import{RGBELoader as Lt}from"/npm/three@0.172.0/examples/jsm/loaders/RGBELoader.js/+esm";import{HorizontalBlurShader as Et}from"/npm/three@0.172.0/examples/jsm/shaders/HorizontalBlurShader.js/+esm";import{VerticalBlurShader as Pt}from"/npm/three@0.172.0/examples/jsm/shaders/VerticalBlurShader.js/+esm";import{lerp as kt}from"/npm/three@0.172.0/src/math/MathUtils.js/+esm";import{USDZExporter as Dt}from"/npm/three@0.172.0/examples/jsm/exporters/USDZExporter.js/+esm";
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ft=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported,Ot=Ft&&null!=self.XRSession.prototype.requestHitTestSource,It=null!=self.ResizeObserver,zt=null!=self.IntersectionObserver,Vt=Ot;(()=>{const t=navigator.userAgent||navigator.vendor||self.opera;let e=!1;(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)})(),/\bCrOS\b/.test(navigator.userAgent);const Nt=/android/i.test(navigator.userAgent),Bt=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;/Safari\//.test(navigator.userAgent);const jt=/firefox/i.test(navigator.userAgent),Ut=/OculusBrowser/.test(navigator.userAgent);Bt&&/CriOS\//.test(navigator.userAgent);const _t=Nt&&!jt&&!Ut,Ht=Boolean(window.webkit&&window.webkit.messageHandlers),qt=(()=>{if(Bt){if(Ht)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const t=document.createElement("a");return Boolean(t.relList&&t.relList.supports&&t.relList.supports("ar"))}}return!1})(),Wt=t=>t&&"null"!==t?Xt(t):null,Gt=()=>{if(Vt)return;const t=[];throw Ft||t.push("WebXR Device API"),Ot||t.push("WebXR Hit Test API"),new Error(`The following APIs are required for AR, but are missing in this browser: ${t.join(", ")}`)},Xt=t=>new URL(t,window.location.toString()).toString(),$t=(t,e)=>{let i=null;return(...s)=>{null!=i&&self.clearTimeout(i),i=self.setTimeout((()=>{i=null,t(...s)}),e)}},Yt=(t,e,i)=>Math.max(e,Math.min(i,t)),Kt=(()=>{const t=new RegExp("[?&]model-viewer-debug-mode(&|$)");return()=>self.ModelViewerElement&&self.ModelViewerElement.debugMode||self.location&&self.location.search&&self.location.search.match(t)})();
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Zt=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};const Jt=Symbol("currentEnvironmentMap"),Qt=Symbol("currentBackground"),te=Symbol("updateEnvironment"),ee=Symbol("cancelEnvironmentUpdate");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ie=mt`
<style>
:host {
  display: block;
  position: relative;
  contain: strict;
  width: 300px;
  height: 150px;
}

.container {
  position: relative;
  overflow: hidden;
}

.userInput {
  width: 100%;
  height: 100%;
  display: none;
  position: relative;
  outline-offset: -1px;
  outline-width: 1px;
}

canvas {
  position: absolute;
  display: none;
  pointer-events: none;
  /* NOTE(cdata): Chrome 76 and below apparently have a bug
   * that causes our canvas not to display pixels unless it is
   * on its own render layer
   * @see https://github.com/google/model-viewer/pull/755#issuecomment-536597893
   */
  transform: translateZ(0);
}

.show {
  display: block;
}

/* Adapted from HTML5 Boilerplate
 *
 * @see https://github.com/h5bp/html5-boilerplate/blob/ceb4620c78fc82e13534fc44202a3f168754873f/dist/css/main.css#L122-L133 */
.screen-reader-only {
  border: 0;
  left: 0;
  top: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  white-space: nowrap;
  width: 1px;
  pointer-events: none;
}

.slot {
  position: absolute;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.slot > * {
  pointer-events: initial;
}

.annotation-wrapper ::slotted(*) {
  opacity: var(--max-hotspot-opacity, 1);
  transition: opacity 0.3s;
}

.pointer-tumbling .annotation-wrapper ::slotted(*) {
  pointer-events: none;
}

.annotation-wrapper ::slotted(*) {
  pointer-events: initial;
}

.annotation-wrapper.hide ::slotted(*) {
  opacity: var(--min-hotspot-opacity, 0.25);
}

.slot.poster {
  display: none;
  background-color: inherit;
}

.slot.poster.show {
  display: inherit;
}

.slot.poster > * {
  pointer-events: initial;
}

.slot.poster:not(.show) > * {
  pointer-events: none;
}

#default-poster {
  width: 100%;
  height: 100%;
  /* The default poster is a <button> so we need to set display
   * to prevent it from being affected by text-align: */
  display: block;
  position: absolute;
  border: none;
  padding: 0;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  background-color: #fff0;
}

#default-progress-bar {
  display: block;
  position: relative;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

#default-progress-bar > .bar {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: var(--progress-bar-height, 5px);
  background-color: var(--progress-bar-color, rgba(0, 0, 0, 0.4));
  transition: transform 0.09s;
  transform-origin: top left;
  transform: scaleX(0);
  overflow: hidden;
}

#default-progress-bar > .bar.hide {
  transition: opacity 0.3s 1s;
  opacity: 0;
}

.centered {
  align-items: center;
  justify-content: center;
}

.cover {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.slot.interaction-prompt {
  display: var(--interaction-prompt-display, flex);
  overflow: hidden;
  opacity: 0;
  will-change: opacity;
  transition: opacity 0.3s;
}

.slot.interaction-prompt.visible {
  opacity: 1;
}

.animated-container {
  will-change: transform, opacity;
  opacity: 0;
  transition: opacity 0.3s;
}

.slot.interaction-prompt > * {
  pointer-events: none;
}

.slot.ar-button {
  -moz-user-select: none;
  -webkit-tap-highlight-color: transparent;
  user-select: none;

  display: var(--ar-button-display, block);
}

.slot.ar-button:not(.enabled) {
  display: none;
}

.fab {
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
  width: 40px;
  height: 40px;
  cursor: pointer;
  background-color: #fff;
  box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.15);
  border-radius: 100px;
}

.fab > * {
  opacity: 0.87;
}

#default-ar-button {
  position: absolute;
  bottom: 16px;
  right: 16px;
  transform: scale(var(--ar-button-scale, 1));
  transform-origin: bottom right;
}

.slot.pan-target {
  display: block;
  position: absolute;
  width: 0;
  height: 0;
  left: 50%;
  top: 50%;
  transform: translate3d(-50%, -50%, 0);
  background-color: transparent;
  opacity: 0;
  transition: opacity 0.3s;
}

#default-pan-target {
  width: 6px;
  height: 6px;
  border-radius: 6px;
  border: 1px solid white;
  box-shadow: 0px 0px 2px 1px rgba(0, 0, 0, 0.8);
}

.slot.default {
  pointer-events: none;
}

.slot.progress-bar {
  pointer-events: none;
}

.slot.exit-webxr-ar-button {
  pointer-events: none;
}

.slot.exit-webxr-ar-button:not(.enabled) {
  display: none;
}

#default-exit-webxr-ar-button {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  top: env(safe-area-inset-top, 16px);
  right: 16px;
  width: 40px;
  height: 40px;
  box-sizing: border-box;
}

#default-exit-webxr-ar-button > svg {
  fill: #fff;
}
</style>
<div class="container">
  <div class="userInput" tabindex="0" role="img"
      aria-label="3D model">
      <div class="slot canvas">
        <slot name="canvas">
          <canvas></canvas>
        </slot>
      </div>

  </div>

  <!-- NOTE(cdata): We need to wrap slots because browsers without ShadowDOM
        will have their <slot> elements removed by ShadyCSS -->
  <div class="slot poster">
    <slot name="poster">
      <button type="button" id="default-poster" aria-hidden="true" aria-label="Loading 3D model"></button>
    </slot>
  </div>

  <div class="slot ar-button">
    <slot name="ar-button">
      <a id="default-ar-button" part="default-ar-button" class="fab"
          tabindex="2"
          role="button"
          href="javascript:void(0);"
          aria-label="View in your space">
        ${mt`
<svg version="1.1" id="view_x5F_in_x5F_AR_x5F_icon"
	 xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="24px" height="24px"
	 viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
<rect id="Bounding_Box" x="0" y="0" fill="none" width="24" height="24"/>
<g id="Art_layer">
	<path d="M3,4c0-0.55,0.45-1,1-1h2V1H4C2.35,1,1,2.35,1,4v2h2V4z"/>
	<path d="M20,3c0.55,0,1,0.45,1,1v2h2V4c0-1.65-1.35-3-3-3h-2v2H20z"/>
	<path d="M4,21c-0.55,0-1-0.45-1-1v-2H1v2c0,1.65,1.35,3,3,3h2v-2H4z"/>
	<path d="M20,21c0.55,0,1-0.45,1-1v-2h2v2c0,1.65-1.35,3-3,3h-2v-2H20z"/>
	<g>
		<path d="M18.25,7.6l-5.5-3.18c-0.46-0.27-1.04-0.27-1.5,0L5.75,7.6C5.29,7.87,5,8.36,5,8.9v6.35c0,0.54,0.29,1.03,0.75,1.3
			l5.5,3.18c0.46,0.27,1.04,0.27,1.5,0l5.5-3.18c0.46-0.27,0.75-0.76,0.75-1.3V8.9C19,8.36,18.71,7.87,18.25,7.6z M7,14.96v-4.62
			l4,2.32v4.61L7,14.96z M12,10.93L8,8.61l4-2.31l4,2.31L12,10.93z M13,17.27v-4.61l4-2.32v4.62L13,17.27z"/>
	</g>
</g>
</svg>`}
      </a>
    </slot>
  </div>

  <div class="slot pan-target">
    <slot name="pan-target">
      <div id="default-pan-target">
      </div>
    </slot>
  </div>

  <div class="slot interaction-prompt cover centered">
    <div id="prompt" class="animated-container">
      <slot name="interaction-prompt" aria-hidden="true">
        ${mt`
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="36">
    <defs>
        <path id="A" d="M.001.232h24.997V36H.001z" />
    </defs>
    <g transform="translate(-11 -4)" fill="none" fill-rule="evenodd">
        <path fill-opacity="0" fill="#fff" d="M0 0h44v44H0z" />
        <g transform="translate(11 3)">
            <path d="M8.733 11.165c.04-1.108.766-2.027 1.743-2.307a2.54 2.54 0 0 1 .628-.089c.16 0 .314.017.463.044 1.088.2 1.9 1.092 1.9 2.16v8.88h1.26c2.943-1.39 5-4.45 5-8.025a9.01 9.01 0 0 0-1.9-5.56l-.43-.5c-.765-.838-1.683-1.522-2.712-2-1.057-.49-2.226-.77-3.46-.77s-2.4.278-3.46.77c-1.03.478-1.947 1.162-2.71 2l-.43.5a9.01 9.01 0 0 0-1.9 5.56 9.04 9.04 0 0 0 .094 1.305c.03.21.088.41.13.617l.136.624c.083.286.196.56.305.832l.124.333a8.78 8.78 0 0 0 .509.953l.065.122a8.69 8.69 0 0 0 3.521 3.191l1.11.537v-9.178z" fill-opacity=".5" fill="#e4e4e4" />
            <path d="M22.94 26.218l-2.76 7.74c-.172.485-.676.8-1.253.8H12.24c-1.606 0-3.092-.68-3.98-1.82-1.592-2.048-3.647-3.822-6.11-5.27-.095-.055-.15-.137-.152-.23-.004-.1.046-.196.193-.297.56-.393 1.234-.6 1.926-.6a3.43 3.43 0 0 1 .691.069l4.922.994V10.972c0-.663.615-1.203 1.37-1.203s1.373.54 1.373 1.203v9.882h2.953c.273 0 .533.073.757.21l6.257 3.874c.027.017.045.042.07.06.41.296.586.77.426 1.22M4.1 16.614c-.024-.04-.042-.083-.065-.122a8.69 8.69 0 0 1-.509-.953c-.048-.107-.08-.223-.124-.333l-.305-.832c-.058-.202-.09-.416-.136-.624l-.13-.617a9.03 9.03 0 0 1-.094-1.305c0-2.107.714-4.04 1.9-5.56l.43-.5c.764-.84 1.682-1.523 2.71-2 1.058-.49 2.226-.77 3.46-.77s2.402.28 3.46.77c1.03.477 1.947 1.16 2.712 2l.428.5a9 9 0 0 1 1.901 5.559c0 3.577-2.056 6.636-5 8.026h-1.26v-8.882c0-1.067-.822-1.96-1.9-2.16-.15-.028-.304-.044-.463-.044-.22 0-.427.037-.628.09-.977.28-1.703 1.198-1.743 2.306v9.178l-1.11-.537C6.18 19.098 4.96 18 4.1 16.614M22.97 24.09l-6.256-3.874c-.102-.063-.218-.098-.33-.144 2.683-1.8 4.354-4.855 4.354-8.243 0-.486-.037-.964-.104-1.43a9.97 9.97 0 0 0-1.57-4.128l-.295-.408-.066-.092a10.05 10.05 0 0 0-.949-1.078c-.342-.334-.708-.643-1.094-.922-1.155-.834-2.492-1.412-3.94-1.65l-.732-.088-.748-.03a9.29 9.29 0 0 0-1.482.119c-1.447.238-2.786.816-3.94 1.65a9.33 9.33 0 0 0-.813.686 9.59 9.59 0 0 0-.845.877l-.385.437-.36.5-.288.468-.418.778-.04.09c-.593 1.28-.93 2.71-.93 4.222 0 3.832 2.182 7.342 5.56 8.938l1.437.68v4.946L5 25.64a4.44 4.44 0 0 0-.888-.086c-.017 0-.034.003-.05.003-.252.004-.503.033-.75.08a5.08 5.08 0 0 0-.237.056c-.193.046-.382.107-.568.18-.075.03-.15.057-.225.1-.25.114-.494.244-.723.405a1.31 1.31 0 0 0-.566 1.122 1.28 1.28 0 0 0 .645 1.051C4 29.925 5.96 31.614 7.473 33.563a5.06 5.06 0 0 0 .434.491c1.086 1.082 2.656 1.713 4.326 1.715h6.697c.748-.001 1.43-.333 1.858-.872.142-.18.256-.38.336-.602l2.757-7.74c.094-.26.13-.53.112-.794s-.088-.52-.203-.76a2.19 2.19 0 0 0-.821-.91" fill-opacity=".6" fill="#000" />
            <path d="M22.444 24.94l-6.257-3.874a1.45 1.45 0 0 0-.757-.211h-2.953v-9.88c0-.663-.616-1.203-1.373-1.203s-1.37.54-1.37 1.203v16.643l-4.922-.994a3.44 3.44 0 0 0-.692-.069 3.35 3.35 0 0 0-1.925.598c-.147.102-.198.198-.194.298.004.094.058.176.153.23 2.462 1.448 4.517 3.22 6.11 5.27.887 1.14 2.373 1.82 3.98 1.82h6.686c.577 0 1.08-.326 1.253-.8l2.76-7.74c.16-.448-.017-.923-.426-1.22-.025-.02-.043-.043-.07-.06z" fill="#fff" />
            <g transform="translate(0 .769)">
                <mask id="B" fill="#fff">
                    <use xlink:href="#A" />
                </mask>
                <path d="M23.993 24.992a1.96 1.96 0 0 1-.111.794l-2.758 7.74c-.08.22-.194.423-.336.602-.427.54-1.11.87-1.857.872h-6.698c-1.67-.002-3.24-.633-4.326-1.715-.154-.154-.3-.318-.434-.49C5.96 30.846 4 29.157 1.646 27.773c-.385-.225-.626-.618-.645-1.05a1.31 1.31 0 0 1 .566-1.122 4.56 4.56 0 0 1 .723-.405l.225-.1a4.3 4.3 0 0 1 .568-.18l.237-.056c.248-.046.5-.075.75-.08.018 0 .034-.003.05-.003.303-.001.597.027.89.086l3.722.752V20.68l-1.436-.68c-3.377-1.596-5.56-5.106-5.56-8.938 0-1.51.336-2.94.93-4.222.015-.03.025-.06.04-.09.127-.267.268-.525.418-.778.093-.16.186-.316.288-.468.063-.095.133-.186.2-.277L3.773 5c.118-.155.26-.29.385-.437.266-.3.544-.604.845-.877a9.33 9.33 0 0 1 .813-.686C6.97 2.167 8.31 1.59 9.757 1.35a9.27 9.27 0 0 1 1.481-.119 8.82 8.82 0 0 1 .748.031c.247.02.49.05.733.088 1.448.238 2.786.816 3.94 1.65.387.28.752.588 1.094.922a9.94 9.94 0 0 1 .949 1.078l.066.092c.102.133.203.268.295.408a9.97 9.97 0 0 1 1.571 4.128c.066.467.103.945.103 1.43 0 3.388-1.67 6.453-4.353 8.243.11.046.227.08.33.144l6.256 3.874c.37.23.645.55.82.9.115.24.185.498.203.76m.697-1.195c-.265-.55-.677-1.007-1.194-1.326l-5.323-3.297c2.255-2.037 3.564-4.97 3.564-8.114 0-2.19-.637-4.304-1.84-6.114-.126-.188-.26-.37-.4-.552-.645-.848-1.402-1.6-2.252-2.204C15.472.91 13.393.232 11.238.232A10.21 10.21 0 0 0 5.23 2.19c-.848.614-1.606 1.356-2.253 2.205-.136.18-.272.363-.398.55C1.374 6.756.737 8.87.737 11.06c0 4.218 2.407 8.08 6.133 9.842l.863.41v3.092l-2.525-.51c-.356-.07-.717-.106-1.076-.106a5.45 5.45 0 0 0-3.14.996c-.653.46-1.022 1.202-.99 1.983a2.28 2.28 0 0 0 1.138 1.872c2.24 1.318 4.106 2.923 5.543 4.772 1.26 1.62 3.333 2.59 5.55 2.592h6.698c1.42-.001 2.68-.86 3.134-2.138l2.76-7.74c.272-.757.224-1.584-.134-2.325" fill-opacity=".05" fill="#000" mask="url(#B)" />
            </g>
        </g>
    </g>
</svg>`
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}
      </slot>
    </div>
  </div>

  <div id="finger0" class="animated-container cover">
    <slot name="finger0" aria-hidden="true">
    </slot>
  </div>
  <div id="finger1" class="animated-container cover">
    <slot name="finger1" aria-hidden="true">
    </slot>
  </div>

  <div class="slot default">
    <slot></slot>

    <div class="slot progress-bar">
      <slot name="progress-bar">
        <div id="default-progress-bar" aria-hidden="true">
          <div class="bar" part="default-progress-bar"></div>
        </div>
      </slot>
    </div>

    <div class="slot exit-webxr-ar-button">
      <slot name="exit-webxr-ar-button">
        <a id="default-exit-webxr-ar-button" part="default-exit-webxr-ar-button"
            tabindex="3"
            aria-label="Exit AR"
            aria-hidden="true">
          ${mt`
<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="#000000">
    <!-- NOTE(cdata): This SVG filter is a stop-gap until we can implement
         support for dynamic re-coloring of UI components -->
    <defs>
      <filter id="drop-shadow" x="-100%" y="-100%" width="300%" height="300%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
        <feOffset dx="0" dy="0" result="offsetblur"/>
        <feFlood flood-color="#000000"/>
        <feComposite in2="offsetblur" operator="in"/>
        <feMerge>
          <feMergeNode/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>
    </defs>
    <path filter="url(#drop-shadow)" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>`
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}
        </a>
      </slot>
    </div>
  </div>
</div>
<div class="screen-reader-only" role="region" aria-label="Live announcements">
  <span id="status" role="status"></span>
</div>`;
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var se,ne;const ae=Symbol("retainerCount"),re=Symbol("recentlyUsed"),oe=Symbol("evict"),le=Symbol("evictionThreshold"),he=Symbol("cache");class ce{constructor(t,e=5){this[se]=new Map,this[ne]=[],this[he]=t,this[le]=e}set evictionThreshold(t){this[le]=t,this[oe]()}get evictionThreshold(){return this[le]}get cache(){return this[he]}retainerCount(t){return this[ae].get(t)||0}reset(){this[ae].clear(),this[re]=[]}retain(t){this[ae].has(t)||this[ae].set(t,0),this[ae].set(t,this[ae].get(t)+1);const e=this[re].indexOf(t);-1!==e&&this[re].splice(e,1),this[re].unshift(t),this[oe]()}release(t){this[ae].has(t)&&this[ae].set(t,Math.max(this[ae].get(t)-1,0)),this[oe]()}[(se=ae,ne=re,oe)](){if(!(this[re].length<this[le]))for(let t=this[re].length-1;t>=this[le];--t){const e=this[re][t];0===this[ae].get(e)&&(this[he].delete(e),this[re].splice(t,1))}}}
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ue=t=>{const e=new Map;for(const i of t.mappings)for(const t of i.variants)e.set(t,{material:null,gltfMaterialIndex:i.material});return e};class de{constructor(t){this.parser=t,this.name="KHR_materials_variants"}afterRoot(t){const e=this.parser,i=e.json;if(void 0===i.extensions||void 0===i.extensions[this.name])return null;const s=(t=>{const e=[],i=new Set;for(const s of t){let t=s,n=0;for(;i.has(t);)t=s+"."+ ++n;i.add(t),e.push(t)}return e})((i.extensions[this.name].variants||[]).map((t=>t.name)));for(const s of t.scenes)s.traverse((t=>{const s=t;if(!s.material)return;const n=e.associations.get(s);if(null==n||null==n.meshes||null==n.primitives)return;const a=i.meshes[n.meshes].primitives[n.primitives].extensions;a&&a[this.name]&&(s.userData.variantMaterials=ue(a[this.name]))}));return t.userData.variants=s,Promise.resolve()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var pe,me;l.DEFAULT_ANISOTROPY=4;const ge=new Map,fe=new Map;let ve;const ye=new yt;let be;const we=new wt;let Se,xe;const Me=Symbol("loader"),Ce=Symbol("evictionPolicy"),Te=Symbol("GLTFInstance");class Re extends h{static setDRACODecoderLocation(t){ve=t,ye.setDecoderPath(t)}static getDRACODecoderLocation(){return ve}static setKTX2TranscoderLocation(t){be=t,we.setTranscoderPath(t)}static getKTX2TranscoderLocation(){return be}static setMeshoptDecoderLocation(t){var e;Se!==t&&(Se=t,xe=(e=t,new Promise(((t,i)=>{const s=document.createElement("script");document.body.appendChild(s),s.onload=t,s.onerror=i,s.async=!0,s.src=e}))).then((()=>vt.ready)).then((()=>vt)))}static getMeshoptDecoderLocation(){return Se}static initializeKTX2Loader(t){we.detectSupport(t)}static get cache(){return ge}static clearCache(){ge.forEach(((t,e)=>{this.delete(e)})),this[Ce].reset()}static has(t){return ge.has(t)}static async delete(t){if(!this.has(t))return;const e=ge.get(t);fe.delete(t),ge.delete(t);(await e).dispose()}static hasFinishedLoading(t){return!!fe.get(t)}constructor(t){super(),this[me]=(new bt).register((t=>new de(t))),this[Te]=t,this[Me].setDRACOLoader(ye),this[Me].setKTX2Loader(we)}get[(pe=Ce,me=Me,Ce)](){return this.constructor[Ce]}async preload(t,e,i=()=>{}){if(this[Me].setWithCredentials(e.withCredentials),this.dispatchEvent({type:"preload",element:e,src:t}),!ge.has(t)){null!=xe&&this[Me].setMeshoptDecoder(await xe);const e=((t,e,i=()=>{})=>{const s=t=>{const e=t.loaded/t.total;i(Math.max(0,Math.min(1,isFinite(e)?e:1)))};return new Promise(((i,n)=>{e.load(t,i,s,n)}))})(t,this[Me],(t=>{i(.8*t)})),s=this[Te],n=e.then((t=>s.prepare(t))).then((t=>(i(.9),new s(t)))).catch((t=>(console.error(t),new s)));ge.set(t,n)}await ge.get(t),fe.set(t,!0),i&&i(1)}async load(t,e,i=()=>{}){await this.preload(t,e,i);const s=await ge.get(t),n=await s.clone();return this[Ce].retain(t),n.dispose=()=>{this[Ce].release(t)},n}}Re[pe]=new ce(Re);
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ae=t=>void 0!==t.material&&t.userData&&t.userData.variantMaterials&&!!Array.from(t.userData.variantMaterials.values()).filter((t=>Le(t.material))),Le=t=>t&&t.isMaterial&&!Array.isArray(t);class Ee{constructor(t){this.writer=t,this.name="KHR_materials_variants",this.variantNames=[]}beforeParse(t){const e=new Set,i=t=>{if(!Ae(t))return;const i=t.userData.variantMaterials,s=t.userData.variantData;for(const[t,n]of s){const s=i.get(n.index);s&&Le(s.material)&&e.add(t)}};if(Array.isArray(t))for(const e of t)e.traverse(i);else t.traverse(i);e.forEach((t=>this.variantNames.push(t)))}async writeMesh(t,e){if(!Ae(t))return;const i=t.userData,s=i.variantMaterials,n=i.variantData,a=new Map,r=new Map,o=Array.from(n.values()).sort(((t,e)=>t.index-e.index));for(const[t,e]of o.entries())r.set(e.index,t);for(const t of n.values()){const e=s.get(t.index);if(!e||!Le(e.material))continue;const i=await this.writer.processMaterialAsync(e.material);a.has(i)||a.set(i,{material:i,variants:[]}),a.get(i).variants.push(r.get(t.index))}const l=Array.from(a.values()).map((t=>t.variants.sort(((t,e)=>t-e))&&t)).sort(((t,e)=>t.material-e.material));if(0===l.length)return;const h=Le(i.originalMaterial)?await this.writer.processMaterialAsync(i.originalMaterial):-1;for(const t of e.primitives)h>=0&&(t.material=h),t.extensions=t.extensions||{},t.extensions[this.name]={mappings:l}}afterParse(){if(0===this.variantNames.length)return;const t=this.writer.json;t.extensions=t.extensions||{};const e=this.variantNames.map((t=>({name:t})));t.extensions[this.name]={variants:e},this.writer.extensionsUsed[this.name]=!0}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pe{constructor(t=50){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(t)}setDecayTime(t){this.naturalFrequency=1/Math.max(.001,t)}update(t,e,i,s){const n=2e-4*this.naturalFrequency;if(null==t||0===s)return e;if(t===e&&0===this.velocity)return e;if(i<0)return t;const a=t-e,r=this.velocity+this.naturalFrequency*a,o=a+i*r,l=Math.exp(-this.naturalFrequency*i),h=(r-this.naturalFrequency*o)*l,c=-this.naturalFrequency*(h+r*l);return Math.abs(h)<n*Math.abs(s)&&c*a>=0?(this.velocity=0,e):(this.velocity=h,e+o*l)}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ke=.2,De=Math.PI/24,Fe=new c,Oe=(t,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let n=0;n<=12;++n)t.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+ke*Math.cos(s),i+ke*Math.sin(s),0),s+=De};class Ie extends u{constructor(t,e){const i=new d,s=[],n=[],{size:a,boundingBox:r}=t,o=a.x/2,l=("back"===e?a.y:a.z)/2;Oe(n,o,l),Oe(n,-o,l),Oe(n,-o,-l),Oe(n,o,-l);const h=n.length/3;for(let t=0;t<h-2;t+=2)s.push(t,t+1,t+3,t,t+3,t+2);const c=h-2;s.push(c,c+1,1,c,1,0),i.setAttribute("position",new p(n,3)),i.setIndex(s),super(i),this.side=e;const v=this.material;switch(v.side=m,v.transparent=!0,v.opacity=0,this.goalOpacity=0,this.opacityDamper=new Pe,this.hitPlane=new u(new g(2*(o+ke),2*(l+ke))),this.hitPlane.visible=!1,this.hitPlane.material.side=m,this.add(this.hitPlane),this.hitBox=new u(new f(a.x+.4,a.y+ke,a.z+.4)),this.hitBox.visible=!1,this.hitBox.material.side=m,this.add(this.hitBox),r.getCenter(this.position),e){case"bottom":this.rotateX(-Math.PI/2),this.shadowHeight=r.min.y,this.position.y=this.shadowHeight;break;case"back":this.shadowHeight=r.min.z,this.position.z=this.shadowHeight}t.target.add(this),this.hitBox.position.y=(a.y+ke)/2+r.min.y,t.target.add(this.hitBox),this.offsetHeight=0}getHit(t,e,i){Fe.set(e,-i),this.hitPlane.visible=!0;const s=t.positionAndNormalFromPoint(Fe,this.hitPlane);return this.hitPlane.visible=!1,null==s?null:s.position}getExpandedHit(t,e,i){this.hitPlane.scale.set(1e3,1e3,1e3),this.hitPlane.updateMatrixWorld();const s=this.getHit(t,e,i);return this.hitPlane.scale.set(1,1,1),s}controllerIntersection(t,e){this.hitBox.visible=!0;const i=t.hitFromController(e,this.hitBox);return this.hitBox.visible=!1,i}set offsetHeight(t){t-=.001,"back"===this.side?this.position.z=this.shadowHeight+t:this.position.y=this.shadowHeight+t}get offsetHeight(){return"back"===this.side?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(t){this.goalOpacity=t?.75:0}updateOpacity(t){const e=this.material;e.opacity=this.opacityDamper.update(e.opacity,this.goalOpacity,t,1),this.visible=e.opacity>0}dispose(){const{geometry:t,material:e}=this.hitPlane;t.dispose(),e.dispose(),this.hitBox.geometry.dispose(),this.hitBox.material.dispose(),this.geometry.dispose(),this.material.dispose(),this.hitBox.removeFromParent(),this.removeFromParent()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ze=(t,e)=>({type:"number",number:t,unit:e}),Ve=(()=>{const t={};return e=>{const i=e;if(i in t)return t[i];const s=[];let n=0;for(;e;){if(++n>1e3){e="";break}const t=Ne(e),i=t.nodes[0];if(null==i||0===i.terms.length)break;s.push(i),e=t.remainingInput}return t[i]=s}})(),Ne=(()=>{const t=/^(\-\-|[a-z\u0240-\uffff])/i,e=/^([\*\+\/]|[\-]\s)/i,i=/^[\),]/;return s=>{const n=[];for(;s.length&&(s=s.trim(),!i.test(s));)if("("===s[0]){const{nodes:t,remainingInput:e}=_e(s);s=e,n.push({type:"function",name:{type:"ident",value:"calc"},arguments:t})}else if(t.test(s)){const t=Be(s),e=t.nodes[0];if("("===(s=t.remainingInput)[0]){const{nodes:t,remainingInput:i}=_e(s);n.push({type:"function",name:e,arguments:t}),s=i}else n.push(e)}else if(e.test(s))n.push({type:"operator",value:s[0]}),s=s.slice(1);else{const{nodes:t,remainingInput:e}="#"===s[0]?Ue(s):je(s);if(0===t.length)break;n.push(t[0]),s=e}return{nodes:[{type:"expression",terms:n}],remainingInput:s}}})(),Be=(()=>{const t=/[^a-z0-9_\-\u0240-\uffff]/i;return e=>{const i=e.match(t);return{nodes:[{type:"ident",value:null==i?e:e.substr(0,i.index)}],remainingInput:null==i?"":e.substr(i.index)}}})(),je=(()=>{const t=/[\+\-]?(\d+[\.]\d+|\d+|[\.]\d+)([eE][\+\-]?\d+)?/,e=/^[a-z%]+/i,i=/^(m|mm|cm|rad|deg|[%])$/;return s=>{const n=s.match(t),a=null==n?"0":n[0],r=(s=null==a?s:s.slice(a.length)).match(e);let o=null!=r&&""!==r[0]?r[0]:null;const l=null==r?s:s.slice(o.length);return null==o||i.test(o)||(o=null),{nodes:[{type:"number",number:parseFloat(a)||0,unit:o}],remainingInput:l}}})(),Ue=(()=>{const t=/^[a-f0-9]*/i;return e=>{const i=(e=e.slice(1).trim()).match(t);return{nodes:null==i?[]:[{type:"hex",value:i[0]}],remainingInput:null==i?e:e.slice(i[0].length)}}})(),_e=t=>{const e=[];for(t=t.slice(1).trim();t.length;){const i=Ne(t);if(e.push(i.nodes[0]),","===(t=i.remainingInput.trim())[0])t=t.slice(1).trim();else if(")"===t[0]){t=t.slice(1);break}}return{nodes:e,remainingInput:t}},He=Symbol("visitedTypes");class qe{constructor(t){this[He]=t}walk(t,e){const i=t.slice();for(;i.length;){const t=i.shift();switch(this[He].indexOf(t.type)>-1&&e(t),t.type){case"expression":i.unshift(...t.terms);break;case"function":i.unshift(t.name,...t.arguments)}}}}const We=Object.freeze({type:"number",number:0,unit:null}),Ge=(t,e=0)=>{let{number:i,unit:s}=t;if(isFinite(i)){if("rad"===t.unit||null==t.unit)return t}else i=e,s="rad";return{type:"number",number:("deg"===s&&null!=i?i:0)*Math.PI/180,unit:"rad"}},Xe=(t,e=0)=>{let i,{number:s,unit:n}=t;if(isFinite(s)){if("m"===t.unit)return t}else s=e,n="m";switch(n){default:i=1;break;case"cm":i=.01;break;case"mm":i=.001}return{type:"number",number:i*s,unit:"m"}},$e=(()=>{const t=t=>t,e={rad:t,deg:Ge,m:t,mm:Xe,cm:Xe};return(t,i=We)=>{isFinite(t.number)||(t.number=i.number,t.unit=i.unit);const{unit:s}=t;if(null==s)return t;const n=e[s];return null==n?i:n(t)}})();
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ye,Ke,Ze;const Je=Symbol("evaluate"),Qe=Symbol("lastValue");class ti{constructor(){this[Ye]=null}static evaluatableFor(t,e=We){if(t instanceof ti)return t;if("number"===t.type)return"%"===t.unit?new si(t,e):t;switch(t.name.value){case"calc":return new li(t,e);case"env":return new ai(t)}return We}static evaluate(t){return t instanceof ti?t.evaluate():t}static isConstant(t){return!(t instanceof ti)||t.isConstant}static applyIntrinsics(t,e){const{basis:i,keywords:s}=e,{auto:n}=s;return i.map(((e,i)=>{const a=null==n[i]?e:n[i];let r=t[i]?t[i]:a;if("ident"===r.type){const t=r.value;t in s&&(r=s[t][i])}return null!=r&&"ident"!==r.type||(r=a),"%"===r.unit?ze(r.number/100*e.number,e.unit):(r=$e(r,e),r.unit!==e.unit?e:r)}))}get isConstant(){return!1}evaluate(){return this.isConstant&&null!=this[Qe]||(this[Qe]=this[Je]()),this[Qe]}}Ye=Qe;const ei=Symbol("percentage"),ii=Symbol("basis");class si extends ti{constructor(t,e){super(),this[ei]=t,this[ii]=e}get isConstant(){return!0}[Je](){return ze(this[ei].number/100*this[ii].number,this[ii].unit)}}const ni=Symbol("identNode");class ai extends ti{constructor(t){super(),this[Ke]=null;const e=t.arguments.length?t.arguments[0].terms[0]:null;null!=e&&"ident"===e.type&&(this[ni]=e)}get isConstant(){return!1}[(Ke=ni,Je)](){if(null!=this[ni]&&"window-scroll-y"===this[ni].value){return{type:"number",number:window.pageYOffset/(Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight)||0,unit:null}}return We}}const ri=/[\*\/]/,oi=Symbol("evaluator");class li extends ti{constructor(t,e=We){if(super(),this[Ze]=null,1!==t.arguments.length)return;const i=t.arguments[0].terms.slice(),s=[];for(;i.length;){const t=i.shift();if(s.length>0){const i=s[s.length-1];if("operator"===i.type&&ri.test(i.value)){const i=s.pop(),n=s.pop();if(null==n)return;s.push(new di(i,ti.evaluatableFor(n,e),ti.evaluatableFor(t,e)));continue}}s.push("operator"===t.type?t:ti.evaluatableFor(t,e))}for(;s.length>2;){const[t,i,n]=s.splice(0,3);if("operator"!==i.type)return;s.unshift(new di(i,ti.evaluatableFor(t,e),ti.evaluatableFor(n,e)))}1===s.length&&(this[oi]=s[0])}get isConstant(){return null==this[oi]||ti.isConstant(this[oi])}[(Ze=oi,Je)](){return null!=this[oi]?ti.evaluate(this[oi]):We}}const hi=Symbol("operator"),ci=Symbol("left"),ui=Symbol("right");class di extends ti{constructor(t,e,i){super(),this[hi]=t,this[ci]=e,this[ui]=i}get isConstant(){return ti.isConstant(this[ci])&&ti.isConstant(this[ui])}[Je](){const t=$e(ti.evaluate(this[ci])),e=$e(ti.evaluate(this[ui])),{number:i,unit:s}=t,{number:n,unit:a}=e;if(null!=a&&null!=s&&a!=s)return We;const r=s||a;let o;switch(this[hi].value){case"+":o=i+n;break;case"-":o=i-n;break;case"/":o=i/n;break;case"*":o=i*n;break;default:return We}return{type:"number",number:o,unit:r}}}const pi=Symbol("evaluatables"),mi=Symbol("intrinsics");class gi extends ti{constructor(t,e){super(),this[mi]=e;const i=t[0],s=null!=i?i.terms:[];this[pi]=e.basis.map(((t,e)=>{const i=s[e];return null==i?{type:"ident",value:"auto"}:"ident"===i.type?i:ti.evaluatableFor(i,t)}))}get isConstant(){for(const t of this[pi])if(!ti.isConstant(t))return!1;return!0}[Je](){const t=this[pi].map((t=>ti.evaluate(t)));return ti.applyIntrinsics(t,this[mi]).map((t=>t.number))}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fi,vi,yi,bi;const wi=Symbol("instances"),Si=Symbol("activateListener"),xi=Symbol("deactivateListener"),Mi=Symbol("notifyInstances"),Ci=Symbol("notify"),Ti=Symbol("callback");class Ri{static[Mi](){for(const t of Ri[wi])t[Ci]()}static[(fi=wi,Si)](){window.addEventListener("scroll",this[Mi],{passive:!0})}static[xi](){window.removeEventListener("scroll",this[Mi])}constructor(t){this[Ti]=t}observe(){0===Ri[wi].size&&Ri[Si](),Ri[wi].add(this)}disconnect(){Ri[wi].delete(this),0===Ri[wi].size&&Ri[xi]()}[Ci](){this[Ti]()}}Ri[fi]=new Set;const Ai=Symbol("computeStyleCallback"),Li=Symbol("astWalker"),Ei=Symbol("dependencies"),Pi=Symbol("onScroll");class ki{constructor(t){this[vi]={},this[yi]=new qe(["function"]),this[bi]=()=>{this[Ai]({relatedState:"window-scroll"})},this[Ai]=t}observeEffectsFor(t){const e={},i=this[Ei];this[Li].walk(t,(t=>{const{name:s}=t,n=t.arguments[0].terms[0];if("env"===s.value&&null!=n&&"ident"===n.type&&"window-scroll-y"===n.value)if(null==e["window-scroll"]){const t="window-scroll"in i?i["window-scroll"]:new Ri(this[Pi]);t.observe(),delete i["window-scroll"],e["window-scroll"]=t}}));for(const t in i){i[t].disconnect()}this[Ei]=e}dispose(){for(const t in this[Ei]){this[Ei][t].disconnect()}}}vi=Ei,yi=Li,bi=Pi;
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Di=t=>{const e=t.observeEffects||!1,i=t.intrinsics instanceof Function?t.intrinsics:()=>t.intrinsics;return(s,n)=>{const a=s.updated,r=s.connectedCallback,o=s.disconnectedCallback,l=Symbol(`${n}StyleEffector`),h=Symbol(`${n}StyleEvaluator`),c=Symbol(`${n}UpdateEvaluator`),u=Symbol(`${n}EvaluateAndSync`);Object.defineProperties(s,{[l]:{value:null,writable:!0},[h]:{value:null,writable:!0},[c]:{value:function(){const t=Ve(this[n]);this[h]=new gi(t,i(this)),null==this[l]&&e&&(this[l]=new ki((()=>this[u]()))),null!=this[l]&&this[l].observeEffectsFor(t)}},[u]:{value:function(){if(null==this[h])return;const e=this[h].evaluate();this[t.updateHandler](e)}},updated:{value:function(t){t.has(n)&&(this[c](),this[u]()),a.call(this,t)}},connectedCallback:{value:function(){r.call(this),this.requestUpdate(n,this[n])}},disconnectedCallback:{value:function(){o.call(this),null!=this[l]&&(this[l].dispose(),this[l]=null)}}})}},Fi=t=>t<.5?2*t*t:(4-2*t)*t-1,Oi=(t,e,i=Fi)=>s=>t+(e-t)*i(s),Ii=t=>{const e=[],i=[];let s=t.initialValue;for(let n=0;n<t.keyframes.length;++n){const a=t.keyframes[n],{value:r,frames:o}=a,l=a.ease||Fi,h=Oi(s,r,l);e.push(h),i.push(o),s=r}return((t,e)=>{const i=e.map((s=0,t=>s+=t));var s;return e=>{e=Yt(e,0,1),e*=i[i.length-1];const s=i.findIndex((t=>t>=e)),n=s<1?0:i[s-1],a=i[s];return t[s]((e-n)/(a-n))}})(e,i)};
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var zi=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};const Vi=Ii({initialValue:0,keyframes:[{frames:5,value:-1},{frames:1,value:-1},{frames:8,value:1},{frames:1,value:1},{frames:5,value:0},{frames:18,value:0}]}),Ni=Ii({initialValue:0,keyframes:[{frames:1,value:1},{frames:5,value:1},{frames:1,value:0},{frames:6,value:0}]}),Bi="0deg 75deg 105%",ji=["front","right","back","left"],Ui=["upper-","","lower-"],_i="auto",Hi="basic",qi="wiggle",Wi="none",Gi=()=>({basis:[Ge(ze(30,"deg"))],keywords:{auto:[null]}}),Xi=()=>({basis:[Ge(ze(12,"deg"))],keywords:{auto:[null]}}),$i=(()=>{const t=Ve(Bi)[0].terms,e=$e(t[0]),i=$e(t[1]);return t=>{const s=t[mo].idealCameraDistance();return{basis:[e,i,ze(s,"m")],keywords:{auto:[null,null,ze(105,"%")]}}}})(),Yi=t=>{const e=2.2*t[mo].boundingSphere.radius;return{basis:[ze(-1/0,"rad"),ze(0,"rad"),ze(e,"m")],keywords:{auto:[null,null,null]}}},Ki=t=>{const e=$i(t),i=new gi([],e).evaluate()[2];return{basis:[ze(1/0,"rad"),ze(Math.PI,"rad"),ze(i,"m")],keywords:{auto:[null,null,null]}}},Zi=t=>{const e=t[mo].boundingBox.getCenter(new y);return{basis:[ze(e.x,"m"),ze(e.y,"m"),ze(e.z,"m")],keywords:{auto:[null,null,null]}}},Ji=Math.PI/2,Qi=Math.PI/3,ts=Ji/2,es=2*Math.PI,is=Symbol("controls"),ss=Symbol("panElement"),ns=Symbol("promptElement"),as=Symbol("promptAnimatedContainer"),rs=Symbol("fingerAnimatedContainers"),os=Symbol("deferInteractionPrompt"),ls=Symbol("updateAria"),hs=Symbol("a11y"),cs=Symbol("updateA11y"),us=Symbol("updateCameraForRadius"),ds=Symbol("cancelPrompts"),ps=Symbol("onChange"),ms=Symbol("onPointerChange"),gs=Symbol("waitingToPromptUser"),fs=Symbol("userHasInteracted"),vs=Symbol("promptElementVisibleTime"),ys=Symbol("lastPromptOffset"),bs=Symbol("cancellationSource"),ws=Symbol("lastSpherical"),Ss=Symbol("jumpCamera"),xs=Symbol("initialized"),Ms=Symbol("maintainThetaPhi"),Cs=Symbol("syncCameraOrbit"),Ts=Symbol("syncFieldOfView"),Rs=Symbol("syncCameraTarget"),As=Symbol("syncMinCameraOrbit"),Ls=Symbol("syncMaxCameraOrbit"),Es=Symbol("syncMinFieldOfView"),Ps=Symbol("syncMaxFieldOfView"),ks=new c,Ds=new y,Fs=Object.freeze({minimumRadius:0,maximumRadius:1/0,minimumPolarAngle:0,maximumPolarAngle:Math.PI,minimumAzimuthalAngle:-1/0,maximumAzimuthalAngle:1/0,minimumFieldOfView:10,maximumFieldOfView:45,touchAction:"none"}),Os=Math.PI/8,Is=.04,zs={USER_INTERACTION:"user-interaction",NONE:"none",AUTOMATIC:"automatic"};class Vs extends h{constructor(t,e,i){super(),this.camera=t,this.element=e,this.scene=i,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.inputSensitivity=1,this.changeSource=zs.NONE,this._interactionEnabled=!1,this._disableZoom=!1,this.isUserPointing=!1,this.enablePan=!0,this.enableTap=!0,this.panProjection=new b,this.panPerPixel=0,this.spherical=new v,this.goalSpherical=new v,this.thetaDamper=new Pe,this.phiDamper=new Pe,this.radiusDamper=new Pe,this.logFov=Math.log(Fs.maximumFieldOfView),this.goalLogFov=this.logFov,this.fovDamper=new Pe,this.touchMode=null,this.pointers=[],this.startTime=0,this.startPointerPosition={clientX:0,clientY:0},this.lastSeparation=0,this.touchDecided=!1,this.onContext=t=>{if(this.enablePan)t.preventDefault();else for(const t of this.pointers)this.onPointerUp(new PointerEvent("pointercancel",Object.assign(Object.assign({},this.startPointerPosition),{pointerId:t.id})))},this.touchModeZoom=(t,e)=>{if(!this._disableZoom){const t=this.twoTouchDistance(this.pointers[0],this.pointers[1]),e=Is*this.zoomSensitivity*(this.lastSeparation-t)*50/this.scene.height;this.lastSeparation=t,this.userAdjustOrbit(0,0,e)}this.panPerPixel>0&&this.movePan(t,e)},this.disableScroll=t=>{t.preventDefault()},this.touchModeRotate=(t,e)=>{const{touchAction:i}=this._options;if(!this.touchDecided&&"none"!==i){this.touchDecided=!0;const s=Math.abs(t),n=Math.abs(e);if(this.changeSource===zs.USER_INTERACTION&&("pan-y"===i&&n>s||"pan-x"===i&&s>n))return void(this.touchMode=null);this.element.addEventListener("touchmove",this.disableScroll,{passive:!1})}this.handleSinglePointerMove(t,e)},this.onPointerDown=t=>{if(this.pointers.length>2)return;const{element:e}=this;0===this.pointers.length&&(e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.touchMode=null,this.touchDecided=!1,this.startPointerPosition.clientX=t.clientX,this.startPointerPosition.clientY=t.clientY,this.startTime=performance.now());try{e.setPointerCapture(t.pointerId)}catch(t){}this.pointers.push({clientX:t.clientX,clientY:t.clientY,id:t.pointerId}),this.isUserPointing=!1,"touch"===t.pointerType?(this.changeSource=t.altKey?zs.AUTOMATIC:zs.USER_INTERACTION,this.onTouchChange(t)):(this.changeSource=zs.USER_INTERACTION,this.onMouseDown(t)),this.changeSource===zs.USER_INTERACTION&&this.dispatchEvent({type:"user-interaction"})},this.onPointerMove=t=>{const e=this.pointers.find((e=>e.id===t.pointerId));if(null==e)return;if("mouse"===t.pointerType&&0===t.buttons)return void this.onPointerUp(t);const i=this.pointers.length,s=(t.clientX-e.clientX)/i,n=(t.clientY-e.clientY)/i;0===s&&0===n||(e.clientX=t.clientX,e.clientY=t.clientY,"touch"===t.pointerType?(this.changeSource=t.altKey?zs.AUTOMATIC:zs.USER_INTERACTION,null!==this.touchMode&&this.touchMode(s,n)):(this.changeSource=zs.USER_INTERACTION,this.panPerPixel>0?this.movePan(s,n):this.handleSinglePointerMove(s,n)))},this.onPointerUp=t=>{const{element:e}=this,i=this.pointers.findIndex((e=>e.id===t.pointerId));-1!==i&&this.pointers.splice(i,1),this.panPerPixel>0&&!t.altKey&&this.resetRadius(),0===this.pointers.length?(e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),e.removeEventListener("touchmove",this.disableScroll),this.enablePan&&this.enableTap&&this.recenter(t)):null!==this.touchMode&&this.onTouchChange(t),this.scene.element[ss].style.opacity=0,e.style.cursor="grab",this.panPerPixel=0,this.isUserPointing&&this.dispatchEvent({type:"pointer-change-end"})},this.onWheel=t=>{this.changeSource=zs.USER_INTERACTION;const e=t.deltaY*(1==t.deltaMode?18:1)*Is*this.zoomSensitivity/30;this.userAdjustOrbit(0,0,e),t.preventDefault(),this.dispatchEvent({type:"user-interaction"})},this.onKeyDown=t=>{const{changeSource:e}=this;this.changeSource=zs.USER_INTERACTION;(t.shiftKey&&this.enablePan?this.panKeyCodeHandler(t):this.orbitZoomKeyCodeHandler(t))?(t.preventDefault(),this.dispatchEvent({type:"user-interaction"})):this.changeSource=e},this._options=Object.assign({},Fs),this.setOrbit(0,Math.PI/2,1),this.setFieldOfView(100),this.jumpToGoal()}get interactionEnabled(){return this._interactionEnabled}enableInteraction(){if(!1===this._interactionEnabled){const{element:t}=this;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointercancel",this.onPointerUp),this._disableZoom||t.addEventListener("wheel",this.onWheel),t.addEventListener("keydown",this.onKeyDown),t.addEventListener("touchmove",(()=>{}),{passive:!1}),t.addEventListener("contextmenu",this.onContext),this.element.style.cursor="grab",this._interactionEnabled=!0,this.updateTouchActionStyle()}}disableInteraction(){if(!0===this._interactionEnabled){const{element:t}=this;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),t.removeEventListener("pointercancel",this.onPointerUp),t.removeEventListener("wheel",this.onWheel),t.removeEventListener("keydown",this.onKeyDown),t.removeEventListener("contextmenu",this.onContext),t.style.cursor="",this.touchMode=null,this._interactionEnabled=!1,this.updateTouchActionStyle()}}get options(){return this._options}set disableZoom(t){this._disableZoom!=t&&(this._disableZoom=t,!0===t?this.element.removeEventListener("wheel",this.onWheel):this.element.addEventListener("wheel",this.onWheel),this.updateTouchActionStyle())}getCameraSpherical(t=new v){return t.copy(this.spherical)}getFieldOfView(){return this.camera.fov}applyOptions(t){Object.assign(this._options,t),this.setOrbit(),this.setFieldOfView(Math.exp(this.goalLogFov))}updateNearFar(t,e){this.camera.far=0===e?2:e,this.camera.near=Math.max(t,this.camera.far/1e3),this.camera.updateProjectionMatrix()}updateAspect(t){this.camera.aspect=t,this.camera.updateProjectionMatrix()}setOrbit(t=this.goalSpherical.theta,e=this.goalSpherical.phi,i=this.goalSpherical.radius){const{minimumAzimuthalAngle:s,maximumAzimuthalAngle:n,minimumPolarAngle:a,maximumPolarAngle:r,minimumRadius:o,maximumRadius:l}=this._options,{theta:h,phi:c,radius:u}=this.goalSpherical,d=Yt(t,s,n);isFinite(s)||isFinite(n)||(this.spherical.theta=this.wrapAngle(this.spherical.theta-d)+d);const p=Yt(e,a,r),m=Yt(i,o,l);return(d!==h||p!==c||m!==u)&&(!!(isFinite(d)&&isFinite(p)&&isFinite(m))&&(this.goalSpherical.theta=d,this.goalSpherical.phi=p,this.goalSpherical.radius=m,this.goalSpherical.makeSafe(),!0))}setRadius(t){this.goalSpherical.radius=t,this.setOrbit()}setFieldOfView(t){const{minimumFieldOfView:e,maximumFieldOfView:i}=this._options;t=Yt(t,e,i),this.goalLogFov=Math.log(t)}setDamperDecayTime(t){this.thetaDamper.setDecayTime(t),this.phiDamper.setDecayTime(t),this.radiusDamper.setDecayTime(t),this.fovDamper.setDecayTime(t)}adjustOrbit(t,e,i){const{theta:s,phi:n,radius:a}=this.goalSpherical,{minimumRadius:r,maximumRadius:o,minimumFieldOfView:l,maximumFieldOfView:h}=this._options,c=this.spherical.theta-s,u=Math.PI-.001,d=s-Yt(t,-u-c,u-c),p=n-e,m=0===i?0:((i>0?o:r)-a)/(Math.log(i>0?h:l)-this.goalLogFov),g=a+i*(isFinite(m)?m:2*(o-r));if(this.setOrbit(d,p,g),0!==i){const t=this.goalLogFov+i;this.setFieldOfView(Math.exp(t))}}jumpToGoal(){this.update(0,1e4)}update(t,e){if(this.isStationary())return!1;const{maximumPolarAngle:i,maximumRadius:s}=this._options,n=this.spherical.theta-this.goalSpherical.theta;return Math.abs(n)>Math.PI&&!isFinite(this._options.minimumAzimuthalAngle)&&!isFinite(this._options.maximumAzimuthalAngle)&&(this.spherical.theta-=2*Math.sign(n)*Math.PI),this.spherical.theta=this.thetaDamper.update(this.spherical.theta,this.goalSpherical.theta,e,Math.PI),this.spherical.phi=this.phiDamper.update(this.spherical.phi,this.goalSpherical.phi,e,i),this.spherical.radius=this.radiusDamper.update(this.spherical.radius,this.goalSpherical.radius,e,s),this.logFov=this.fovDamper.update(this.logFov,this.goalLogFov,e,1),this.moveCamera(),!0}updateTouchActionStyle(){const{style:t}=this.element;if(this._interactionEnabled){const{touchAction:e}=this._options;this._disableZoom&&"none"!==e?t.touchAction="manipulation":t.touchAction=e}else t.touchAction=""}isStationary(){return this.goalSpherical.theta===this.spherical.theta&&this.goalSpherical.phi===this.spherical.phi&&this.goalSpherical.radius===this.spherical.radius&&this.goalLogFov===this.logFov}moveCamera(){this.spherical.makeSafe(),this.camera.position.setFromSpherical(this.spherical),this.camera.setRotationFromEuler(new w(this.spherical.phi-Math.PI/2,this.spherical.theta,0,"YXZ")),this.camera.fov!==Math.exp(this.logFov)&&(this.camera.fov=Math.exp(this.logFov),this.camera.updateProjectionMatrix())}userAdjustOrbit(t,e,i){this.adjustOrbit(t*this.orbitSensitivity*this.inputSensitivity,e*this.orbitSensitivity*this.inputSensitivity,i*this.inputSensitivity)}wrapAngle(t){const e=(t+Math.PI)/(2*Math.PI);return 2*(e-Math.floor(e))*Math.PI-Math.PI}pixelLengthToSphericalAngle(t){return 2*Math.PI*t/this.scene.height}twoTouchDistance(t,e){const{clientX:i,clientY:s}=t,{clientX:n,clientY:a}=e,r=n-i,o=a-s;return Math.sqrt(r*r+o*o)}handleSinglePointerMove(t,e){const i=this.pixelLengthToSphericalAngle(t),s=this.pixelLengthToSphericalAngle(e);!1===this.isUserPointing&&(this.isUserPointing=!0,this.dispatchEvent({type:"pointer-change-start"})),this.userAdjustOrbit(i,s,0)}initializePan(){const{theta:t,phi:e}=this.spherical,i=t-this.scene.yaw;this.panPerPixel=.018*this.panSensitivity/this.scene.height,this.panProjection.set(-Math.cos(i),-Math.cos(e)*Math.sin(i),0,0,Math.sin(e),0,Math.sin(i),-Math.cos(e)*Math.cos(i),0)}movePan(t,e){const{scene:i}=this,s=Ds.set(t,e,0).multiplyScalar(this.inputSensitivity),n=this.spherical.radius*Math.exp(this.logFov)*this.panPerPixel;s.multiplyScalar(n);const a=i.getTarget();a.add(s.applyMatrix3(this.panProjection)),i.boundingSphere.clampPoint(a,a),i.setTarget(a.x,a.y,a.z)}recenter(t){if(performance.now()>this.startTime+300||Math.abs(t.clientX-this.startPointerPosition.clientX)>2||Math.abs(t.clientY-this.startPointerPosition.clientY)>2)return;const{scene:e}=this,i=e.positionAndNormalFromPoint(e.getNDC(t.clientX,t.clientY));if(null==i){const{cameraTarget:t}=e.element;e.element.cameraTarget="",e.element.cameraTarget=t,this.userAdjustOrbit(0,0,1)}else e.target.worldToLocal(i.position),e.setTarget(i.position.x,i.position.y,i.position.z)}resetRadius(){const{scene:t}=this,e=t.positionAndNormalFromPoint(ks.set(0,0));if(null==e)return;t.target.worldToLocal(e.position);const i=t.getTarget(),{theta:s,phi:n}=this.spherical,a=s-t.yaw,r=Ds.set(Math.sin(n)*Math.sin(a),Math.cos(n),Math.sin(n)*Math.cos(a)),o=r.dot(e.position.sub(i));i.add(r.multiplyScalar(o)),t.setTarget(i.x,i.y,i.z),this.setOrbit(void 0,void 0,this.goalSpherical.radius-o)}onTouchChange(t){if(1===this.pointers.length)this.touchMode=this.touchModeRotate;else{if(this._disableZoom)return this.touchMode=null,void this.element.removeEventListener("touchmove",this.disableScroll);this.touchMode=this.touchDecided&&null===this.touchMode?null:this.touchModeZoom,this.touchDecided=!0,this.element.addEventListener("touchmove",this.disableScroll,{passive:!1}),this.lastSeparation=this.twoTouchDistance(this.pointers[0],this.pointers[1]),this.enablePan&&null!=this.touchMode&&(this.initializePan(),t.altKey||(this.scene.element[ss].style.opacity=1))}}onMouseDown(t){this.panPerPixel=0,this.enablePan&&(2===t.button||t.ctrlKey||t.metaKey||t.shiftKey)&&(this.initializePan(),this.scene.element[ss].style.opacity=1),this.element.style.cursor="grabbing"}orbitZoomKeyCodeHandler(t){let e=!0;switch(t.key){case"PageUp":this.userAdjustOrbit(0,0,Is*this.zoomSensitivity);break;case"PageDown":this.userAdjustOrbit(0,0,-.04*this.zoomSensitivity);break;case"ArrowUp":this.userAdjustOrbit(0,-Os,0);break;case"ArrowDown":this.userAdjustOrbit(0,Os,0);break;case"ArrowLeft":this.userAdjustOrbit(-Os,0,0);break;case"ArrowRight":this.userAdjustOrbit(Os,0,0);break;default:e=!1}return e}panKeyCodeHandler(t){this.initializePan();let e=!0;switch(t.key){case"ArrowUp":this.movePan(0,-10);break;case"ArrowDown":this.movePan(0,10);break;case"ArrowLeft":this.movePan(-10,0);break;case"ArrowRight":this.movePan(10,0);break;default:e=!1}return e}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ns=150,Bs="not-presenting",js="session-started",Us="object-placed",_s="failed",Hs="tracking",qs="not-tracking",Ws=new y,Gs=new S,Xs=new x,$s=new y,Ys=new M(45,1,.1,100),Ks=(new d).setFromPoints([new y(0,0,0),new y(0,0,-1)]),Zs=new f;class Js extends h{constructor(t){super(),this.renderer=t,this.currentSession=null,this.placeOnWall=!1,this.placementBox=null,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.initialHitSource=null,this.transientHitTestSource=null,this.inputSource=null,this._presentedScene=null,this.resolveCleanup=null,this.exitWebXRButtonContainer=null,this.overlay=null,this.xrLight=null,this.xrMode=null,this.controller1=null,this.controller2=null,this.selectedController=null,this.tracking=!0,this.frames=0,this.initialized=!1,this.oldTarget=new y,this.placementComplete=!1,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new y,this.relativeOrientation=new S,this.scaleLine=new C(Ks),this.firstRatio=0,this.lastAngle=0,this.goalPosition=new y,this.goalYaw=0,this.goalScale=1,this.xDamper=new Pe,this.yDamper=new Pe,this.zDamper=new Pe,this.yawDamper=new Pe,this.pitchDamper=new Pe,this.rollDamper=new Pe,this.scaleDamper=new Pe,this.onExitWebXRButtonContainerClick=()=>this.stopPresenting(),this.onControllerSelectStart=t=>{const e=this.presentedScene,i=t.target;if(null!=this.placementBox.controllerIntersection(e,i))null!=this.selectedController&&(this.selectedController.userData.line.visible=!1,e.canScale&&(this.isTwoFingering=!0,this.firstRatio=this.controllerSeparation()/e.pivot.scale.x,this.scaleLine.visible=!0)),i.attach(e.pivot),this.selectedController=i,e.setShadowIntensity(.01);else{const t=i===this.controller1?this.controller2:this.controller1;this.relativeOrientation.copy(i.quaternion).invert().multiply(e.pivot.getWorldQuaternion(Gs)),t.userData.turning=!1,i.userData.turning=!0,i.userData.line.visible=!1}},this.onControllerSelectEnd=t=>{const e=t.target;if(e.userData.turning=!1,e.userData.line.visible=!0,this.isTwoFingering=!1,this.scaleLine.visible=!1,null!=this.selectedController&&this.selectedController!=e)return;const i=this.presentedScene;i.attach(i.pivot),this.selectedController=null,this.goalYaw=Math.atan2(i.pivot.matrix.elements[8],i.pivot.matrix.elements[10]),this.goalPosition.x=i.pivot.position.x,this.goalPosition.z=i.pivot.position.z},this.onUpdateScene=()=>{null!=this.placementBox&&this.isPresenting&&(this.placementBox.dispose(),this.placementBox=new Ie(this.presentedScene,this.placeOnWall?"back":"bottom"))},this.onSelectStart=t=>{const e=this.transientHitTestSource;if(null==e)return;const i=this.frame.getHitTestResultsForTransientInput(e),s=this.presentedScene,n=this.placementBox;if(1===i.length){this.inputSource=t.inputSource;const{axes:e}=this.inputSource.gamepad,i=n.getHit(this.presentedScene,e[0],e[1]);n.show=!0,null!=i?(this.isTranslating=!0,this.lastDragPosition.copy(i)):!1===this.placeOnWall&&(this.isRotating=!0,this.lastAngle=1.5*e[0])}else if(2===i.length){n.show=!0,this.isTwoFingering=!0;const{separation:t}=this.fingerPolar(i);this.firstRatio=t/s.pivot.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1},this.threeRenderer=t.threeRenderer,this.threeRenderer.xr.enabled=!0}async resolveARSession(){Gt();const t=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:[],optionalFeatures:["hit-test","dom-overlay","light-estimation"],domOverlay:this.overlay?{root:this.overlay}:void 0});return this.threeRenderer.xr.setReferenceSpaceType("local"),await this.threeRenderer.xr.setSession(t),this.threeRenderer.xr.cameraAutoUpdate=!1,t}get presentedScene(){return this._presentedScene}async supportsPresentation(){try{return Gt(),await navigator.xr.isSessionSupported("immersive-ar")}catch(t){return console.warn("Request to present in WebXR denied:"),console.warn(t),console.warn("Falling back to next ar-mode"),!1}}async present(t,e=!1){this.isPresenting&&console.warn("Cannot present while a model is already presenting");let i=new Promise(((t,e)=>{requestAnimationFrame((()=>t()))}));t.setHotspotsVisibility(!1),t.queueRender(),await i,this._presentedScene=t,this.overlay=t.element.shadowRoot.querySelector("div.default"),!0===e&&(this.xrLight=new Tt(this.threeRenderer),this.xrLight.addEventListener("estimationstart",(()=>{if(!this.isPresenting||null==this.xrLight)return;const t=this.presentedScene;t.add(this.xrLight),t.environment=this.xrLight.environment})));const s=await this.resolveARSession();s.addEventListener("end",(()=>{this.postSessionCleanup()}),{once:!0});const n=t.element.shadowRoot.querySelector(".slot.exit-webxr-ar-button");n.classList.add("enabled"),n.addEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=n;const a=await s.requestReferenceSpace("viewer");this.xrMode=s.interactionMode,this.tracking=!0,this.frames=0,this.initialized=!1,this.turntableRotation=t.yaw,this.goalYaw=t.yaw,this.goalScale=1,t.setBackground(null),this.oldShadowIntensity=t.shadowIntensity,t.setShadowIntensity(.01),this.oldTarget.copy(t.getTarget()),t.element.addEventListener("load",this.onUpdateScene);const r=20*Math.PI/180,o=!0===this.placeOnWall?void 0:new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(r),z:-Math.cos(r)});s.requestHitTestSource({space:a,offsetRay:o}).then((t=>{this.initialHitSource=t})),"screen-space"!==this.xrMode&&(this.setupControllers(),this.xDamper.setDecayTime(Ns),this.yDamper.setDecayTime(Ns),this.zDamper.setDecayTime(Ns),this.yawDamper.setDecayTime(Ns),this.pitchDamper.setDecayTime(Ns),this.rollDamper.setDecayTime(Ns)),this.currentSession=s,this.placementBox=new Ie(t,this.placeOnWall?"back":"bottom"),this.placementComplete=!1,this.lastTick=performance.now(),this.dispatchEvent({type:"status",status:js})}setupControllers(){this.controller1=this.threeRenderer.xr.getController(0),this.controller1.addEventListener("selectstart",this.onControllerSelectStart),this.controller1.addEventListener("selectend",this.onControllerSelectEnd),this.controller2=this.threeRenderer.xr.getController(1),this.controller2.addEventListener("selectstart",this.onControllerSelectStart),this.controller2.addEventListener("selectend",this.onControllerSelectEnd);const t=this.presentedScene;if(t.add(this.controller1),t.add(this.controller2),!this.controller1.userData.line){const e=new C(Ks);e.name="line",e.scale.z=5,this.controller1.userData.turning=!1,this.controller1.userData.line=e,this.controller1.add(e),this.controller2.userData.turning=!1;const i=e.clone();this.controller2.userData.line=i,this.controller2.add(i),this.scaleLine.name="scale line",this.scaleLine.visible=!1,this.controller1.add(this.scaleLine);const{size:s}=t,n=.1/Math.max(s.x,s.y,s.z),a=new u(Zs);a.name="box",a.scale.copy(s).multiplyScalar(n),a.visible=!1,this.controller1.userData.box=a,t.add(a);const r=a.clone();this.controller2.userData.box=r,t.add(r)}}hover(t){if("screen-space"===this.xrMode||this.selectedController==t)return!1;const e=this.presentedScene,i=this.placementBox.controllerIntersection(e,t);return t.userData.box.visible=(null==i||t.userData.turning)&&!this.isTwoFingering,t.userData.line.scale.z=null==i?5:i.distance,null!=i}controllerSeparation(){return this.controller1.position.distanceTo(this.controller2.position)}async stopPresenting(){if(!this.isPresenting)return;const t=new Promise((t=>{this.resolveCleanup=t}));try{await this.currentSession.end(),await t}catch(t){console.warn("Error while trying to end WebXR AR session"),console.warn(t),this.postSessionCleanup()}}get isPresenting(){return null!=this.presentedScene}get target(){return this.oldTarget}updateTarget(){const t=this.presentedScene;if(null!=t){const e=t.getTarget();this.oldTarget.copy(e),this.placeOnWall?e.z=t.boundingBox.min.z:e.y=t.boundingBox.min.y,t.setTarget(e.x,e.y,e.z)}}postSessionCleanup(){const t=this.currentSession;null!=t&&(t.removeEventListener("selectstart",this.onSelectStart),t.removeEventListener("selectend",this.onSelectEnd),this.currentSession=null);const e=this.presentedScene;if(this._presentedScene=null,null!=e){const{element:t}=e;null!=this.xrLight&&(e.remove(this.xrLight),this.xrLight.dispose(),this.xrLight=null),e.add(e.pivot),e.pivot.quaternion.set(0,0,0,1),e.pivot.position.set(0,0,0),e.pivot.scale.set(1,1,1),e.setShadowOffset(0);const i=this.turntableRotation;null!=i&&(e.yaw=i);const s=this.oldShadowIntensity;null!=s&&e.setShadowIntensity(s),e.setEnvironmentAndSkybox(t[Jt],t[Qt]);const n=this.oldTarget;e.setTarget(n.x,n.y,n.z),e.xrCamera=null,e.element.removeEventListener("load",this.onUpdateScene),e.orientHotspots(0);const{width:a,height:r}=t.getBoundingClientRect();e.setSize(a,r),requestAnimationFrame((()=>{e.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:zs.NONE}}))}))}this.renderer.height=0;const i=this.exitWebXRButtonContainer;null!=i&&(i.classList.remove("enabled"),i.removeEventListener("click",this.onExitWebXRButtonContainerClick),this.exitWebXRButtonContainer=null);const s=this.transientHitTestSource;null!=s&&(s.cancel(),this.transientHitTestSource=null);const n=this.initialHitSource;null!=n&&(n.cancel(),this.initialHitSource=null),null!=this.placementBox&&(this.placementBox.dispose(),this.placementBox=null),"screen-space"!==this.xrMode&&(null!=this.controller1&&(this.controller1.userData.turning=!1,this.controller1.userData.box.visible=!1,this.controller1.userData.line.visible=!0,this.controller1.removeEventListener("selectstart",this.onControllerSelectStart),this.controller1.removeEventListener("selectend",this.onControllerSelectEnd),this.controller1.removeFromParent(),this.controller1=null),null!=this.controller2&&(this.controller2.userData.turning=!1,this.controller2.userData.box.visible=!1,this.controller2.userData.line.visible=!0,this.controller2.removeEventListener("selectstart",this.onControllerSelectStart),this.controller2.removeEventListener("selectend",this.onControllerSelectEnd),this.controller2.removeFromParent(),this.controller2=null),this.selectedController=null,this.scaleLine.visible=!1),this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastTick=null,this.turntableRotation=null,this.oldShadowIntensity=null,this.frame=null,this.inputSource=null,this.overlay=null,null!=this.resolveCleanup&&this.resolveCleanup(),this.dispatchEvent({type:"status",status:Bs})}updateView(t){const e=this.presentedScene,i=this.threeRenderer.xr;i.updateCamera(Ys),e.xrCamera=i.getCamera();const{elements:s}=e.getCamera().matrixWorld;if(e.orientHotspots(Math.atan2(s[1],s[5])),this.initialized||(this.placeInitially(),this.initialized=!0),t.requestViewportScale&&t.recommendedViewportScale){const e=t.recommendedViewportScale;t.requestViewportScale(Math.max(e,.25))}const n=i.getBaseLayer();if(null!=n){const e=n instanceof XRWebGLLayer?n.getViewport(t):i.getBinding().getViewSubImage(n,t).viewport;this.threeRenderer.setViewport(e.x,e.y,e.width,e.height)}}placeInitially(){const t=this.presentedScene,{pivot:e,element:i}=t,{position:s}=e,n=t.getCamera(),{width:a,height:r}=this.overlay.getBoundingClientRect();t.setSize(a,r),n.projectionMatrixInverse.copy(n.projectionMatrix).invert();const{theta:o}=i.getCameraOrbit(),l=n.getWorldDirection(Ws);t.yaw=Math.atan2(-l.x,-l.z)-o,this.goalYaw=t.yaw;const h=Math.max(1,2*t.boundingSphere.radius);s.copy(n.position).add(l.multiplyScalar(h)),this.updateTarget();const c=t.getTarget();if(s.add(c).sub(this.oldTarget),this.goalPosition.copy(s),t.setHotspotsVisibility(!0),"screen-space"===this.xrMode){const{session:t}=this.frame;t.addEventListener("selectstart",this.onSelectStart),t.addEventListener("selectend",this.onSelectEnd),t.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then((t=>{this.transientHitTestSource=t}))}}getTouchLocation(){const{axes:t}=this.inputSource.gamepad;let e=this.placementBox.getExpandedHit(this.presentedScene,t[0],t[1]);return null!=e&&(Ws.copy(e).sub(this.presentedScene.getCamera().position),Ws.length()>10)?null:e}getHitPoint(t){const e=this.threeRenderer.xr.getReferenceSpace(),i=t.getPose(e);if(null==i)return null;const s=Xs.fromArray(i.transform.matrix);return!0===this.placeOnWall&&(this.goalYaw=Math.atan2(s.elements[4],s.elements[6])),s.elements[5]>.75!==this.placeOnWall?$s.setFromMatrixPosition(s):null}moveToFloor(t){const e=this.initialHitSource;if(null==e)return;const i=t.getHitTestResults(e);if(0==i.length)return;const s=i[0],n=this.getHitPoint(s);null!=n&&(this.placementBox.show=!0,this.isTranslating||(this.placeOnWall?this.goalPosition.copy(n):this.goalPosition.y=n.y),e.cancel(),this.initialHitSource=null,this.dispatchEvent({type:"status",status:Us}))}fingerPolar(t){const e=t[0].inputSource.gamepad.axes,i=t[1].inputSource.gamepad.axes,s=i[0]-e[0],n=i[1]-e[1],a=Math.atan2(n,s);let r=this.lastAngle-a;return r>Math.PI?r-=2*Math.PI:r<-Math.PI&&(r+=2*Math.PI),this.lastAngle=a,{separation:Math.sqrt(s*s+n*n),deltaYaw:r}}setScale(t){const e=t/this.firstRatio;this.goalScale=Math.abs(e-1)<.2?1:e}processInput(t){const e=this.transientHitTestSource;if(null==e)return;if(!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const i=t.getHitTestResultsForTransientInput(e),s=this.presentedScene,n=s.pivot.scale.x;if(this.isTwoFingering)if(i.length<2)this.isTwoFingering=!1;else{const{separation:t,deltaYaw:e}=this.fingerPolar(i);!1===this.placeOnWall&&(this.goalYaw+=e),s.canScale&&this.setScale(t)}else if(2!==i.length)if(this.isRotating){const t=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=t-this.lastAngle,this.lastAngle=t}else this.isTranslating&&i.forEach((t=>{if(t.inputSource!==this.inputSource)return;let e=null;if(t.results.length>0&&(e=this.getHitPoint(t.results[0])),null==e&&(e=this.getTouchLocation()),null!=e){if(this.goalPosition.sub(this.lastDragPosition),!1===this.placeOnWall){const t=e.y-this.lastDragPosition.y;if(t<0){this.placementBox.offsetHeight=t/n,this.presentedScene.setShadowOffset(t);const i=Ws.copy(s.getCamera().position),a=-t/(i.y-e.y);i.multiplyScalar(a),e.multiplyScalar(1-a).add(i)}}this.goalPosition.add(e),this.lastDragPosition.copy(e)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:t}=this.fingerPolar(i);this.firstRatio=t/n}}moveScene(t){const e=this.presentedScene,{pivot:i}=e,s=this.placementBox;if(s.updateOpacity(t),this.controller1&&(this.controller1.userData.turning&&(i.quaternion.copy(this.controller1.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller2&&i.quaternion.premultiply(Gs.copy(this.controller2.quaternion).invert())),this.controller1.userData.box.position.copy(this.controller1.position),i.getWorldQuaternion(this.controller1.userData.box.quaternion)),this.controller2&&(this.controller2.userData.turning&&(i.quaternion.copy(this.controller2.quaternion).multiply(this.relativeOrientation),this.selectedController&&this.selectedController===this.controller1&&i.quaternion.premultiply(Gs.copy(this.controller1.quaternion).invert())),this.controller2.userData.box.position.copy(this.controller2.position),i.getWorldQuaternion(this.controller2.userData.box.quaternion)),this.controller1&&this.controller2&&this.isTwoFingering){const t=this.controllerSeparation();this.setScale(t),this.scaleLine.scale.z=-t,this.scaleLine.lookAt(this.controller2.position)}const n=e.pivot.scale.x;if(this.goalScale!==n){const i=this.scaleDamper.update(n,this.goalScale,t,1);e.pivot.scale.set(i,i,i)}if(i.parent!==e)return;const{position:a}=i,r=e.boundingSphere.radius,o=this.goalPosition;let l=zs.NONE;if(!o.equals(a)){l=zs.USER_INTERACTION;let{x:i,y:n,z:h}=a;if(i=this.xDamper.update(i,o.x,t,r),n=this.yDamper.update(n,o.y,t,r),h=this.zDamper.update(h,o.z,t,r),a.set(i,n,h),"screen-space"===this.xrMode&&!this.isTranslating){const t=o.y-n;this.placementComplete&&!1===this.placeOnWall?(s.offsetHeight=t/e.pivot.scale.x,e.setShadowOffset(t)):0===t&&(this.placementComplete=!0,s.show=!1,e.setShadowIntensity(.8))}"screen-space"!==this.xrMode&&o.equals(a)&&e.setShadowIntensity(.8)}e.updateTarget(t),Gs.setFromAxisAngle(Ws.set(0,1,0),this.goalYaw);const h=e.pivot.quaternion.angleTo(Gs),c=h-this.yawDamper.update(h,0,t,Math.PI);e.pivot.quaternion.rotateTowards(Gs,c),e.element.dispatchEvent(new CustomEvent("camera-change",{detail:{source:l}}))}onWebXRFrame(t,e){if("screen-space"!==this.xrMode){const t=this.hover(this.controller1),e=this.hover(this.controller2);this.placementBox.show=(t||e)&&!this.isTwoFingering}this.frame=e,++this.frames;const i=this.threeRenderer.xr.getReferenceSpace(),s=e.getViewerPose(i);null==s&&!0===this.tracking&&this.frames>30&&(this.tracking=!1,this.dispatchEvent({type:"tracking",status:qs}));const n=this.presentedScene;if(null==s||null==n||!n.element.loaded)return void this.threeRenderer.clear();!1===this.tracking&&(this.tracking=!0,this.dispatchEvent({type:"tracking",status:Hs}));let a=!0;for(const i of s.views){if(this.updateView(i),a){this.moveToFloor(e),this.processInput(e);const i=t-this.lastTick;this.moveScene(i),this.renderer.preRender(n,t,i),this.lastTick=t,n.renderShadow(this.threeRenderer)}this.threeRenderer.render(n,n.getCamera()),a=!1}}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qs=Symbol("prepared"),tn=Symbol("prepare"),en=Symbol("preparedGLTF"),sn=Symbol("clone");class nn{static prepare(t){if(null==t.scene)throw new Error("Model does not have a scene");if(t[Qs])return t;const e=this[tn](t);return e[Qs]=!0,e}static[tn](t){const{scene:e}=t,i=[e];return Object.assign(Object.assign({},t),{scene:e,scenes:i})}get parser(){return this[en].parser}get animations(){return this[en].animations}get scene(){return this[en].scene}get scenes(){return this[en].scenes}get cameras(){return this[en].cameras}get asset(){return this[en].asset}get userData(){return this[en].userData}constructor(t){this[en]=t}clone(){return new(0,this.constructor)(this[sn]())}dispose(){this.scenes.forEach((t=>{t.traverse((t=>{const e=t;if(!e.material)return;(Array.isArray(e.material)?e.material:[e.material]).forEach((t=>{for(const e in t){const i=t[e];if(i instanceof l){const t=i.source.data;null!=t.close&&t.close(),i.dispose()}}t.dispose()})),e.geometry.dispose()}))}))}[sn](){const t=this[en],e=Rt.clone(this.scene);an(e,this.scene);const i=[e],s=t.userData?Object.assign({},t.userData):{};return Object.assign(Object.assign({},t),{scene:e,scenes:i,userData:s})}}const an=(t,e)=>{rn(t,e,((t,e)=>{void 0!==e.userData.variantMaterials&&(t.userData.variantMaterials=new Map(e.userData.variantMaterials)),void 0!==e.userData.variantData&&(t.userData.variantData=e.userData.variantData),void 0!==e.userData.originalMaterial&&(t.userData.originalMaterial=e.userData.originalMaterial)}))},rn=(t,e,i)=>{i(t,e);for(let s=0;s<t.children.length;s++)rn(t.children[s],e.children[s],i)},on=Symbol("threeGLTF"),ln=Symbol("gltf"),hn=Symbol("gltfElementMap"),cn=Symbol("threeObjectMap"),un=Symbol("parallelTraverseThreeScene"),dn=Symbol("correlateOriginalThreeGLTF"),pn=Symbol("correlateCloneThreeGLTF");class mn{static from(t,e){return null!=e?this[pn](t,e):this[dn](t)}static[dn](t){const e=t.parser.json,i=t.parser.associations,s=new Map,n={name:"Default"},a={type:"materials",index:-1};for(const t of i.keys())t instanceof T&&null==i.get(t)&&(a.index<0&&(null==e.materials&&(e.materials=[]),a.index=e.materials.length,e.materials.push(n)),t.name=n.name,i.set(t,{materials:a.index}));for(const[t,n]of i){n&&(t.userData=t.userData||{},t.userData.associations=n);for(const i in n)if(null!=i&&"primitives"!==i){const a=i,r=(e[a]||[])[n[a]];if(null==r)continue;let o=s.get(r);null==o&&(o=new Set,s.set(r,o)),o.add(t)}}return new mn(t,e,i,s)}static[pn](t,e){const i=e.threeGLTF,s=e.gltf,n=JSON.parse(JSON.stringify(s)),a=new Map,r=new Map;for(let s=0;s<i.scenes.length;s++)this[un](i.scenes[s],t.scenes[s],((t,i)=>{const s=e.threeObjectMap.get(t);if(null!=s)for(const t in s)if(null!=t&&"primitives"!==t){const e=t,o=s[e],l=n[e][o],h=a.get(i)||{};h[e]=o,a.set(i,h);const c=r.get(l)||new Set;c.add(i),r.set(l,c)}}));return new mn(t,n,a,r)}static[un](t,e,i){const s=(t,e)=>{if(i(t,e),t.isObject3D){const n=t,a=e;if(n.material)if(Array.isArray(n.material))for(let t=0;t<n.material.length;++t)i(n.material[t],a.material[t]);else i(n.material,a.material);for(let i=0;i<t.children.length;++i)s(t.children[i],e.children[i])}};s(t,e)}get threeGLTF(){return this[on]}get gltf(){return this[ln]}get gltfElementMap(){return this[hn]}get threeObjectMap(){return this[cn]}constructor(t,e,i,s){this[on]=t,this[ln]=e,this[hn]=s,this[cn]=i}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gn=Symbol("correlatedSceneGraph");class fn extends nn{static[tn](t){const e=super[tn](t);null==e[gn]&&(e[gn]=mn.from(e));const{scene:i}=e,s=new R(void 0,1/0);return i.traverse((t=>{t.renderOrder=1e3,t.frustumCulled=!1,t.name||(t.name=t.uuid);const i=t;if(i.material){const{geometry:t}=i;i.castShadow=!0,i.isSkinnedMesh&&(t.boundingSphere=s,t.boundingBox=null);const n=i.material;if(!0===n.isMeshBasicMaterial&&(n.toneMapped=!1),n.shadowSide=A,n.aoMap){const{gltf:i,threeObjectMap:s}=e[gn],a=s.get(n);if(null!=i.materials&&null!=a&&null!=a.materials){const e=i.materials[a.materials];e.occlusionTexture&&0===e.occlusionTexture.texCoord&&null!=t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv)}}}})),e}get correlatedSceneGraph(){return this[en][gn]}[sn](){const t=super[sn](),e=new Map;return t.scene.traverse((t=>{const i=t;if(i.material){const t=i.material;if(null!=t){if(e.has(t.uuid))return void(i.material=e.get(t.uuid));i.material=t.clone(),e.set(t.uuid,i.material)}}const s=t;void 0!==s.target&&s.add(s.target)})),t[gn]=mn.from(t,this.correlatedSceneGraph),t}}
/* @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vn={topLight:{intensity:500,position:[.418,16.199,.3]},room:{position:[-.757,13.219,.717],scale:[31.713,28.305,28.591]},boxes:[{position:[-10.906,2.009,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,.857,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:50,position:[-16.116,14.37,8.208],scale:[.1,2.428,2.739]},{intensity:50,position:[-16.109,18.021,-8.207],scale:[.1,2.425,2.751]},{intensity:17,position:[14.904,12.198,-1.832],scale:[.15,4.265,6.331]},{intensity:43,position:[-.462,8.89,14.52],scale:[4.38,5.441,.088]},{intensity:20,position:[3.235,11.486,-12.541],scale:[2.5,2,.1]},{intensity:100,position:[0,20,0],scale:[1,.1,1]}]},yn={topLight:{intensity:400,position:[.5,14,.5]},room:{position:[0,13.2,0],scale:[31.5,28.5,31.5]},boxes:[{position:[-10.906,-1,1.846],rotation:-.195,scale:[2.328,7.905,4.651]},{position:[-5.607,-.754,-.758],rotation:.994,scale:[1.97,1.534,3.955]},{position:[6.167,-.16,7.803],rotation:.561,scale:[3.927,6.285,3.687]},{position:[-2.017,.018,6.124],rotation:.333,scale:[2.002,4.566,2.064]},{position:[2.291,-.756,-2.621],rotation:-.286,scale:[1.546,1.552,1.496]},{position:[-2.193,-.369,-5.547],rotation:.516,scale:[3.875,3.487,2.986]}],lights:[{intensity:80,position:[-14,10,8],scale:[.1,2.5,2.5]},{intensity:80,position:[-14,14,-4],scale:[.1,2.5,2.5]},{intensity:23,position:[14,12,0],scale:[.1,5,5]},{intensity:16,position:[0,9,14],scale:[5,5,.1]},{intensity:80,position:[7,8,-14],scale:[2.5,2.5,.1]},{intensity:80,position:[-7,16,-14],scale:[2.5,2.5,.1]},{intensity:1,position:[0,20,0],scale:[.1,.1,.1]}]};class bn extends L{constructor(t){super(),this.position.y=-3.5;const e=new f;e.deleteAttribute("uv");const i=new E({metalness:0,side:P}),s=new E({metalness:0}),n="legacy"==t?vn:yn,a=new k(16777215,n.topLight.intensity,28,2);a.position.set(...n.topLight.position),this.add(a);const r=new u(e,i);r.position.set(...n.room.position),r.scale.set(...n.room.scale),this.add(r);for(const t of n.boxes){const i=new u(e,s);i.position.set(...t.position),i.rotation.set(0,t.rotation,0),i.scale.set(...t.scale),this.add(i)}for(const t of n.lights){const i=new u(e,this.createAreaLightMaterial(t.intensity));i.position.set(...t.position),i.scale.set(...t.scale),this.add(i)}}createAreaLightMaterial(t){const e=new D;return e.color.setScalar(t),e}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wn=20,Sn=/\.hdr(\.js)?$/;class xn{constructor(t){this.threeRenderer=t,this.lottieLoaderUrl="",this._ldrLoader=null,this._imageLoader=null,this._hdrLoader=null,this._lottieLoader=null,this.generatedEnvironmentMap=null,this.generatedEnvironmentMapAlt=null,this.skyboxCache=new Map,this.blurMaterial=null,this.blurScene=null}ldrLoader(t){return null==this._ldrLoader&&(this._ldrLoader=new F),this._ldrLoader.setWithCredentials(t),this._ldrLoader}imageLoader(t){return null==this._imageLoader&&(this._imageLoader=new At(this.threeRenderer)),this._imageLoader.setWithCredentials(t),this._imageLoader}hdrLoader(t){return null==this._hdrLoader&&(this._hdrLoader=new Lt,this._hdrLoader.setDataType(O)),this._hdrLoader.setWithCredentials(t),this._hdrLoader}async getLottieLoader(t){if(null==this._lottieLoader){const{LottieLoader:t}=await import(this.lottieLoaderUrl);this._lottieLoader=new t}return this._lottieLoader.setWithCredentials(t),this._lottieLoader}async loadImage(t,e){const i=await new Promise(((i,s)=>this.ldrLoader(e).load(t,i,(()=>{}),s)));return i.name=t,i.flipY=!1,i}async loadLottie(t,e,i){const s=await this.getLottieLoader(i);s.setQuality(e);const n=await new Promise(((e,i)=>s.load(t,e,(()=>{}),i)));return n.name=t,n}async loadEquirect(t,e=!1,i=()=>{}){try{const s=Sn.test(t),n=s?this.hdrLoader(e):this.imageLoader(e),a=await new Promise(((e,s)=>n.load(t,(t=>{const{renderTarget:i}=t;if(null!=i){const{texture:s}=i;t.dispose(!1),e(s)}else e(t)}),(t=>{i(t.loaded/t.total*.9)}),s)));return i(1),a.name=t,a.mapping=I,s||(a.colorSpace=z),a}finally{i&&i(1)}}async generateEnvironmentMapAndSkybox(t=null,e=null,i=()=>{},s=!1){const n="legacy"!==e;"legacy"!==e&&"neutral"!==e||(e=null),e=Wt(e);let a,r=Promise.resolve(null);t&&(r=this.loadEquirectFromUrl(t,s,i)),a=e?this.loadEquirectFromUrl(e,s,i):t?this.loadEquirectFromUrl(t,s,i):n?this.loadGeneratedEnvironmentMapAlt():this.loadGeneratedEnvironmentMap();const[o,l]=await Promise.all([a,r]);if(null==o)throw new Error("Failed to load environment map.");return{environmentMap:o,skybox:l}}async loadEquirectFromUrl(t,e,i){if(!this.skyboxCache.has(t)){const s=this.loadEquirect(t,e,i);this.skyboxCache.set(t,s)}return this.skyboxCache.get(t)}async GenerateEnvironmentMap(t,e){await((t=0)=>new Promise((e=>setTimeout(e,t))))();const i=this.threeRenderer,s=new V(256,{generateMipmaps:!1,type:O,format:N,colorSpace:B,depthBuffer:!0}),n=new j(.1,100,s),a=n.renderTarget.texture;a.name=e;const o=i.outputColorSpace,l=i.toneMapping;return i.toneMapping=r,i.outputColorSpace=B,n.update(i,t),this.blurCubemap(s,.04),i.toneMapping=l,i.outputColorSpace=o,a}async loadGeneratedEnvironmentMap(){return null==this.generatedEnvironmentMap&&(this.generatedEnvironmentMap=this.GenerateEnvironmentMap(new bn("legacy"),"legacy")),this.generatedEnvironmentMap}async loadGeneratedEnvironmentMapAlt(){return null==this.generatedEnvironmentMapAlt&&(this.generatedEnvironmentMapAlt=this.GenerateEnvironmentMap(new bn("neutral"),"neutral")),this.generatedEnvironmentMapAlt}blurCubemap(t,e){if(null==this.blurMaterial){this.blurMaterial=this.getBlurShader(wn);const t=new f,e=new u(t,this.blurMaterial);this.blurScene=new L,this.blurScene.add(e)}const i=t.clone();this.halfblur(t,i,e,"latitudinal"),this.halfblur(i,t,e,"longitudinal")}halfblur(t,e,i,s){const n=t.width,a=isFinite(i)?Math.PI/(2*n):2*Math.PI/39,r=i/a,o=isFinite(i)?1+Math.floor(3*r):wn;o>wn&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${o} samples when the maximum is set to 20`);const l=[];let h=0;for(let t=0;t<wn;++t){const e=t/r,i=Math.exp(-e*e/2);l.push(i),0==t?h+=i:t<o&&(h+=2*i)}for(let t=0;t<l.length;t++)l[t]=l[t]/h;const c=this.blurMaterial.uniforms;c.envMap.value=t.texture,c.samples.value=o,c.weights.value=l,c.latitudinal.value="latitudinal"===s,c.dTheta.value=a;new j(.1,100,e).update(this.threeRenderer,this.blurScene)}getBlurShader(t){const e=new Float32Array(t),i=new y(0,1,0);return new U({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},poleAxis:{value:i}},vertexShader:"\n      \n      varying vec3 vOutputDirection;\n  \n      void main() {\n  \n        vOutputDirection = vec3( position );\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n  \n      }\n    ",fragmentShader:"\n        varying vec3 vOutputDirection;\n  \n        uniform samplerCube envMap;\n        uniform int samples;\n        uniform float weights[ n ];\n        uniform bool latitudinal;\n        uniform float dTheta;\n        uniform vec3 poleAxis;\n  \n        vec3 getSample( float theta, vec3 axis ) {\n  \n          float cosTheta = cos( theta );\n          // Rodrigues' axis-angle rotation\n          vec3 sampleDirection = vOutputDirection * cosTheta\n            + cross( axis, vOutputDirection ) * sin( theta )\n            + axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n  \n          return vec3( textureCube( envMap, sampleDirection ) );\n  \n        }\n  \n        void main() {\n  \n          vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n  \n          if ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n  \n            axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n  \n          }\n  \n          axis = normalize( axis );\n  \n          gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n          gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n  \n          for ( int i = 1; i < n; i++ ) {\n  \n            if ( i >= samples ) {\n  \n              break;\n  \n            }\n  \n            float theta = dTheta * float( i );\n            gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n            gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n  \n          }\n        }\n      ",blending:_,depthTest:!1,depthWrite:!1,side:P})}async dispose(){for(const[,t]of this.skyboxCache){(await t).dispose()}null!=this.generatedEnvironmentMap&&((await this.generatedEnvironmentMap).dispose(),this.generatedEnvironmentMap=null),null!=this.generatedEnvironmentMapAlt&&((await this.generatedEnvironmentMapAlt).dispose(),this.generatedEnvironmentMapAlt=null),null!=this.blurMaterial&&this.blurMaterial.dispose()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn=[1,.79,.62,.5,.4,.31,.25],Cn="high-performance";class Tn extends h{static get singleton(){return this._singleton||(this._singleton=new Tn({powerPreference:(self.ModelViewerElement||{}).powerPreference||Cn,debug:Kt()})),this._singleton}static resetSingleton(){const t=this._singleton.dispose();for(const e of t)e.disconnectedCallback();this._singleton=new Tn({powerPreference:(self.ModelViewerElement||{}).powerPreference||Cn,debug:Kt()});for(const e of t)e.connectedCallback()}get canRender(){return null!=this.threeRenderer}get scaleFactor(){return Mn[this.scaleStep]}set minScale(t){let e=1;for(;e<Mn.length&&!(Mn[e]<t);)++e;this.lastStep=e-1}constructor(t){super(),this.loader=new Re(fn),this.width=0,this.height=0,this.dpr=1,this.scenes=new Set,this.multipleScenesVisible=!1,this.lastTick=performance.now(),this.renderedLastFrame=!1,this.scaleStep=0,this.lastStep=3,this.avgFrameDuration=50,this.onWebGLContextLost=t=>{this.dispatchEvent({type:"contextlost",sourceEvent:t})},this.onWebGLContextRestored=()=>{var t;null===(t=this.textureUtils)||void 0===t||t.dispose(),this.textureUtils=new xn(this.threeRenderer);for(const t of this.scenes)t.element[te]()},this.dpr=window.devicePixelRatio,this.canvas3D=document.createElement("canvas"),this.canvas3D.id="webgl-canvas",this.canvas3D.classList.add("show");try{this.threeRenderer=new H({canvas:this.canvas3D,alpha:!0,antialias:!0,powerPreference:t.powerPreference,preserveDrawingBuffer:!0}),this.threeRenderer.autoClear=!0,this.threeRenderer.setPixelRatio(1),this.threeRenderer.debug={checkShaderErrors:!!t.debug,onShaderError:null},this.threeRenderer.toneMapping=o}catch(t){console.warn(t)}this.arRenderer=new Js(this),this.textureUtils=this.canRender?new xn(this.threeRenderer):null,Re.initializeKTX2Loader(this.threeRenderer),this.canvas3D.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.updateRendererSize()}registerScene(t){this.scenes.add(t),t.forceRescale();const e=new c;this.threeRenderer.getSize(e),t.canvas.width=e.x,t.canvas.height=e.y,this.canRender&&this.scenes.size>0&&this.threeRenderer.setAnimationLoop(((t,e)=>this.render(t,e)))}unregisterScene(t){this.scenes.delete(t),this.canvas3D.parentElement===t.canvas.parentElement&&t.canvas.parentElement.removeChild(this.canvas3D),this.canRender&&0===this.scenes.size&&this.threeRenderer.setAnimationLoop(null)}displayCanvas(t){return t.element.modelIsVisible&&!this.multipleScenesVisible?this.canvas3D:t.element[po]}countVisibleScenes(){const{canvas3D:t}=this;let e=0,i=null;for(const s of this.scenes){const{element:n}=s;n.modelIsVisible&&null==s.externalRenderer&&++e,t.parentElement===s.canvas.parentElement&&(i=s)}const s=e>1;if(null!=i){const e=s&&!this.multipleScenesVisible,n=!i.element.modelIsVisible;if(e||n){const{width:e,height:s}=this.sceneSize(i);this.copyPixels(i,e,s),t.parentElement.removeChild(t)}}this.multipleScenesVisible=s}updateRendererSize(){var t;const e=window.devicePixelRatio;if(e!==this.dpr)for(const t of this.scenes){const{element:e}=t;e[Qr](e.getBoundingClientRect())}let i=0,s=0;for(const t of this.scenes)i=Math.max(i,t.width),s=Math.max(s,t.height);if(i!==this.width||s!==this.height||e!==this.dpr){this.width=i,this.height=s,this.dpr=e,i=Math.ceil(i*e),s=Math.ceil(s*e),this.canRender&&this.threeRenderer.setSize(i,s,!1);for(const e of this.scenes){const{canvas:n}=e;n.width=i,n.height=s,e.forceRescale(),null===(t=e.effectRenderer)||void 0===t||t.setSize(i,s)}}}updateRendererScale(t){const e=this.scaleStep;this.avgFrameDuration+=Yt(.2*(t-this.avgFrameDuration),-5,5),this.avgFrameDuration>60?++this.scaleStep:this.avgFrameDuration<40&&this.scaleStep>0&&--this.scaleStep,this.scaleStep=Math.min(this.scaleStep,this.lastStep),e!==this.scaleStep&&(this.avgFrameDuration=50)}shouldRender(t){if(t.shouldRender())t.scaleStep!=this.scaleStep&&(t.scaleStep=this.scaleStep,this.rescaleCanvas(t));else{if(0==t.scaleStep)return!1;t.scaleStep=0,this.rescaleCanvas(t)}return!0}rescaleCanvas(t){const e=Mn[t.scaleStep],i=Math.ceil(this.width/e),s=Math.ceil(this.height/e),{style:n}=t.canvas;n.width=`${i}px`,n.height=`${s}px`,this.canvas3D.style.width=`${i}px`,this.canvas3D.style.height=`${s}px`;const a=this.dpr*e,r=e<1?"GPU throttling":this.dpr!==window.devicePixelRatio?"No meta viewport tag":"";t.element.dispatchEvent(new CustomEvent("render-scale",{detail:{reportedDpr:window.devicePixelRatio,renderedDpr:a,minimumDpr:this.dpr*Mn[this.lastStep],pixelWidth:Math.ceil(t.width*a),pixelHeight:Math.ceil(t.height*a),reason:r}}))}sceneSize(t){const{dpr:e}=this,i=Mn[t.scaleStep];return{width:Math.min(Math.ceil(t.width*i*e),this.canvas3D.width),height:Math.min(Math.ceil(t.height*i*e),this.canvas3D.height)}}copyPixels(t,e,i){const s=t.context;null!=s?(s.clearRect(0,0,e,i),s.drawImage(this.canvas3D,0,0,e,i,0,0,e,i),t.canvas.classList.add("show")):console.log("could not acquire 2d context")}orderedScenes(){const t=[];for(const e of[!1,!0])for(const i of this.scenes)i.element.modelIsVisible===e&&t.push(i);return t}get isPresenting(){return this.arRenderer.isPresenting}preRender(t,e,i){const{element:s,exposure:n,toneMapping:a}=t;s[fo](e,i);const r="number"==typeof n&&!Number.isNaN(n),l=s.environmentImage,h=s.skyboxImage,c=a===o&&("neutral"===l||"legacy"===l||!l&&!h);this.threeRenderer.toneMappingExposure=(r?n:1)*(c?1.3:1)}render(t,e){if(null!=e)return void this.arRenderer.onWebXRFrame(t,e);const i=t-this.lastTick;if(this.lastTick=t,!this.canRender||this.isPresenting)return;this.countVisibleScenes(),this.updateRendererSize(),this.renderedLastFrame&&(this.updateRendererScale(i),this.renderedLastFrame=!1);const{canvas3D:s}=this;for(const e of this.orderedScenes()){const{element:n}=e;if(!n.loaded||!n.modelIsVisible&&e.renderCount>0)continue;if(this.preRender(e,t,i),!this.shouldRender(e))continue;if(null!=e.externalRenderer){const t=e.getCamera();t.updateMatrix();const{matrix:i,projectionMatrix:s}=t,n=i.elements.slice(),a=e.getTarget();n[12]+=a.x,n[13]+=a.y,n[14]+=a.z,e.externalRenderer.render({viewMatrix:n,projectionMatrix:s.elements});continue}if(!n.modelIsVisible&&!this.multipleScenesVisible)for(const t of this.scenes)t.element.modelIsVisible&&t.queueRender();const{width:a,height:r}=this.sceneSize(e);e.renderShadow(this.threeRenderer),this.threeRenderer.setRenderTarget(null),this.threeRenderer.setViewport(0,Math.ceil(this.height*this.dpr)-r,a,r),null!=e.effectRenderer?e.effectRenderer.render(i):(this.threeRenderer.autoClear=!0,this.threeRenderer.toneMapping=e.toneMapping,this.threeRenderer.render(e,e.camera)),this.multipleScenesVisible||!e.element.modelIsVisible&&0===e.renderCount?this.copyPixels(e,a,r):s.parentElement!==e.canvas.parentElement&&(e.canvas.parentElement.appendChild(s),e.canvas.classList.remove("show")),e.hasRendered(),++e.renderCount,this.renderedLastFrame=!0}}dispose(){null!=this.textureUtils&&this.textureUtils.dispose(),null!=this.threeRenderer&&this.threeRenderer.dispose(),this.textureUtils=null,this.threeRenderer=null;const t=[];for(const e of this.scenes)t.push(e.element);return this.canvas3D.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas3D.removeEventListener("webglcontextrestored",this.onWebGLContextRestored),t}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rn=Symbol("correlatedObjects"),An=Symbol("onUpdate");class Ln{constructor(t,e){this[An]=t,this[Rn]=e}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const En=new D,Pn=new g(2,2);let kn=0;const Dn=Symbol("threeTexture"),Fn=Symbol("threeTextures");class On extends Ln{get[Dn](){var t;return null===(t=this[Rn])||void 0===t?void 0:t.values().next().value}get[Fn](){return this[Rn]}constructor(t,e){super(t,new Set(e?[e]:[])),this[Dn].image.src||(this[Dn].image.src=e.name?e.name:"adhoc_image"+kn++),this[Dn].image.name||(this[Dn].image.name=e&&e.image&&e.image.src?e.image.src.split("/").pop():"adhoc_image")}get name(){return this[Dn].image.name||""}get uri(){return this[Dn].image.src}get bufferView(){return this[Dn].image.bufferView}get element(){const t=this[Dn];if(t&&(t.isCanvasTexture||t.isVideoTexture))return t.image}get animation(){const t=this[Dn];if(t&&t.isCanvasTexture&&t.animation)return t.animation}get type(){return null!=this.uri?"external":"embedded"}set name(t){for(const e of this[Fn])e.image.name=t}update(){const t=this[Dn];t&&t.isCanvasTexture&&!t.animation&&(this[Dn].needsUpdate=!0,this[An]())}async createThumbnail(t,e){const i=new L;En.map=this[Dn];const s=new u(Pn,En);i.add(s);const n=new q(-1,1,1,-1,0,1),{threeRenderer:a}=Tn.singleton,r=new W(t,e);a.setRenderTarget(r),a.render(i,n),a.setRenderTarget(null);const o=new Uint8Array(t*e*4);a.readRenderTargetPixels(r,0,0,t,e,o),Hr.width=t,Hr.height=e;const l=Hr.getContext("2d"),h=l.createImageData(t,e);return h.data.set(o),l.putImageData(h,0,0),new Promise((async(t,e)=>{Hr.toBlob((i=>{if(!i)return e("Failed to capture thumbnail.");t(URL.createObjectURL(i))}),"image/png")}))}}var In,zn;!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.NearestMipmapNearest=9984]="NearestMipmapNearest",t[t.LinearMipmapNearest=9985]="LinearMipmapNearest",t[t.NearestMipmapLinear=9986]="NearestMipmapLinear",t[t.LinearMipmapLinear=9987]="LinearMipmapLinear"}(In||(In={})),function(t){t[t.ClampToEdge=33071]="ClampToEdge",t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.Repeat=10497]="Repeat"}(zn||(zn={}));
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Vn=new Map([[zn.Repeat,G],[zn.ClampToEdge,X],[zn.MirroredRepeat,$]]),Nn=new Map([[G,zn.Repeat],[X,zn.ClampToEdge],[$,zn.MirroredRepeat]]),Bn=new Map([[In.Nearest,Y],[In.Linear,K],[In.NearestMipmapNearest,Z],[In.LinearMipmapNearest,J],[In.NearestMipmapLinear,Q],[In.LinearMipmapLinear,tt]]),jn=new Map([[Y,In.Nearest],[K,In.Linear],[Z,In.NearestMipmapNearest],[J,In.LinearMipmapNearest],[Q,In.NearestMipmapLinear],[tt,In.LinearMipmapLinear]]),Un=new Map([[In.Nearest,Y],[In.Linear,K]]),_n=new Map([[Y,In.Nearest],[K,In.Linear]]),Hn=t=>jn.has(t),qn=t=>_n.has(t),Wn=t=>Nn.has(t),Gn=Symbol("threeTexture"),Xn=Symbol("threeTextures"),$n=Symbol("setProperty");class Yn extends Ln{get[Gn](){var t;return null===(t=this[Rn])||void 0===t?void 0:t.values().next().value}get[Xn](){return this[Rn]}constructor(t,e){super(t,new Set(e?[e]:[]))}get name(){return this[Gn].name||""}get minFilter(){return jn.get(this[Gn].minFilter)}get magFilter(){return _n.get(this[Gn].magFilter)}get wrapS(){return Nn.get(this[Gn].wrapS)}get wrapT(){return Nn.get(this[Gn].wrapT)}get rotation(){return this[Gn].rotation}get scale(){return To(this[Gn].repeat)}get offset(){return To(this[Gn].offset)}setMinFilter(t){this[$n]("minFilter",Bn.get(t))}setMagFilter(t){this[$n]("magFilter",Un.get(t))}setWrapS(t){this[$n]("wrapS",Vn.get(t))}setWrapT(t){this[$n]("wrapT",Vn.get(t))}setRotation(t){null==t&&(t=0),this[$n]("rotation",t)}setScale(t){null==t&&(t={u:1,v:1}),this[$n]("repeat",new c(t.u,t.v))}setOffset(t){null==t&&(t={u:0,v:0}),this[$n]("offset",new c(t.u,t.v))}[$n](t,e){if(((t,e)=>{switch(t){case"minFilter":return Hn(e);case"magFilter":return qn(e);case"wrapS":case"wrapT":return Wn(e);case"rotation":case"repeat":case"offset":return!0;default:throw new Error(`Cannot configure property "${t}" on Sampler`)}})(t,e))for(const i of this[Xn])i[t]=e,i.needsUpdate=!0;this[An]()}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kn=Symbol("image"),Zn=Symbol("sampler"),Jn=Symbol("threeTexture");class Qn extends Ln{get[Jn](){var t;return null===(t=this[Rn])||void 0===t?void 0:t.values().next().value}constructor(t,e){super(t,new Set(e?[e]:[])),this[Zn]=new Yn(t,e),this[Kn]=new On(t,e)}get name(){return this[Jn].name||""}set name(t){for(const e of this[Rn])e.name=t}get sampler(){return this[Zn]}get source(){return this[Kn]}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ta,ea,ia;const sa=Symbol("texture"),na=Symbol("transform"),aa=Symbol("materials"),ra=Symbol("usage"),oa=Symbol("onUpdate"),la=Symbol("activeVideo");var ha;!function(t){t[t.Base=0]="Base",t[t.MetallicRoughness=1]="MetallicRoughness",t[t.Normal=2]="Normal",t[t.Occlusion=3]="Occlusion",t[t.Emissive=4]="Emissive",t[t.Clearcoat=5]="Clearcoat",t[t.ClearcoatRoughness=6]="ClearcoatRoughness",t[t.ClearcoatNormal=7]="ClearcoatNormal",t[t.SheenColor=8]="SheenColor",t[t.SheenRoughness=9]="SheenRoughness",t[t.Transmission=10]="Transmission",t[t.Thickness=11]="Thickness",t[t.Specular=12]="Specular",t[t.SpecularColor=13]="SpecularColor",t[t.Iridescence=14]="Iridescence",t[t.IridescenceThickness=15]="IridescenceThickness",t[t.Anisotropy=16]="Anisotropy"}(ha||(ha={}));class ca{constructor(t,e,i,s){this[ta]=null,this[ea]={rotation:0,scale:new c(1,1),offset:new c(0,0)},this[ia]=!1,i&&(this[na].rotation=i.rotation,this[na].scale.copy(i.repeat),this[na].offset.copy(i.offset),this[sa]=new Qn(t,i)),this[oa]=t,this[aa]=s,this[ra]=e}get texture(){return this[sa]}setTexture(t){var e,i;const s=null!=t?t.source[Dn]:null,n=null===(e=this[sa])||void 0===e?void 0:e.source[Dn];if(null!=n&&n.isVideoTexture?this[la]=!1:(null===(i=this[sa])||void 0===i?void 0:i.source.animation)&&this[sa].source.animation.removeEventListener("enterFrame",this[oa]),this[sa]=t,null!=s&&s.isVideoTexture){const t=s.image;if(this[la]=!0,null!=t.requestVideoFrameCallback){const e=()=>{this[la]&&(this[oa](),t.requestVideoFrameCallback(e))};t.requestVideoFrameCallback(e)}else{const t=()=>{this[la]&&(this[oa](),requestAnimationFrame(t))};requestAnimationFrame(t)}}else null!=(null==t?void 0:t.source.animation)&&t.source.animation.addEventListener("enterFrame",this[oa]);let a=z;if(this[aa])for(const t of this[aa]){switch(this[ra]){case ha.Base:t.map=s;break;case ha.MetallicRoughness:a=B,t.metalnessMap=s,t.roughnessMap=s;break;case ha.Normal:a=B,t.normalMap=s;break;case ha.Occlusion:a=B,t.aoMap=s;break;case ha.Emissive:t.emissiveMap=s;break;case ha.Clearcoat:t.clearcoatMap=s;break;case ha.ClearcoatRoughness:t.clearcoatRoughnessMap=s;break;case ha.ClearcoatNormal:t.clearcoatNormalMap=s;break;case ha.SheenColor:t.sheenColorMap=s;break;case ha.SheenRoughness:t.sheenRoughnessMap=s;break;case ha.Transmission:t.transmissionMap=s;break;case ha.Thickness:t.thicknessMap=s;break;case ha.Specular:t.specularIntensityMap=s;break;case ha.SpecularColor:t.specularColorMap=s;break;case ha.Iridescence:t.iridescenceMap=s;break;case ha.IridescenceThickness:t.iridescenceThicknessMap=s;break;case ha.Anisotropy:t.anisotropyMap=s}t.needsUpdate=!0}s&&(s.colorSpace=a,s.rotation=this[na].rotation,s.repeat=this[na].scale,s.offset=this[na].offset),this[oa]()}}ta=sa,ea=na,ia=la;
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ua=Symbol("threeMaterial"),da=Symbol("threeMaterials"),pa=Symbol("baseColorTexture"),ma=Symbol("metallicRoughnessTexture");class ga extends Ln{get[da](){return this[Rn]}get[ua](){var t;return null===(t=this[Rn])||void 0===t?void 0:t.values().next().value}constructor(t,e){super(t,e);const{map:i,metalnessMap:s}=e.values().next().value;this[pa]=new ca(t,ha.Base,i,e),this[ma]=new ca(t,ha.MetallicRoughness,s,e)}get baseColorFactor(){const t=[0,0,0,this[ua].opacity];return this[ua].color.toArray(t),t}get metallicFactor(){return this[ua].metalness}get roughnessFactor(){return this[ua].roughness}get baseColorTexture(){return this[pa]}get metallicRoughnessTexture(){return this[ma]}setBaseColorFactor(t){const e=new et;t instanceof Array?e.fromArray(t):e.set(t);for(const i of this[da])i.color.set(e),t instanceof Array&&t.length>3?i.opacity=t[3]:(t=[0,0,0,i.opacity],e.toArray(t));this[An]()}setMetallicFactor(t){for(const e of this[da])e.metalness=t;this[An]()}setRoughnessFactor(t){for(const e of this[da])e.roughness=t;this[An]()}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fa,va;const ya=Symbol("pbrMetallicRoughness"),ba=Symbol("normalTexture"),wa=Symbol("occlusionTexture"),Sa=Symbol("emissiveTexture"),xa=Symbol("backingThreeMaterial"),Ma=Symbol("applyAlphaCutoff"),Ca=Symbol("getAlphaMode"),Ta=Symbol("lazyLoadGLTFInfo"),Ra=Symbol("initialize"),Aa=Symbol("getLoadedMaterial"),La=Symbol("ensureMaterialIsLoaded"),Ea=Symbol("gltfIndex"),Pa=Symbol("setActive"),ka=Symbol("variantIndices"),Da=Symbol("isActive"),Fa=Symbol("modelVariants"),Oa=Symbol("name"),Ia=Symbol("pbrTextures");class za extends Ln{get[(fa=ka,va=Ia,xa)](){return this[Rn].values().next().value}constructor(t,e,i,s,n,a,r=void 0){super(t,n),this[fa]=new Set,this[va]=new Map,this[Ea]=e,this[Da]=i,this[Fa]=s,this[Oa]=a,null==r?this[Ra]():this[Ta]=r}[Ra](){const t=this[An],e=this[Rn];this[ya]=new ga(t,e);const{normalMap:i,aoMap:s,emissiveMap:n}=e.values().next().value;this[ba]=new ca(t,ha.Normal,i,e),this[wa]=new ca(t,ha.Occlusion,s,e),this[Sa]=new ca(t,ha.Emissive,n,e);const a=i=>{this[Ia].set(i,new ca(t,i,null,e))};a(ha.Clearcoat),a(ha.ClearcoatRoughness),a(ha.ClearcoatNormal),a(ha.SheenColor),a(ha.SheenRoughness),a(ha.Transmission),a(ha.Thickness),a(ha.Specular),a(ha.SpecularColor),a(ha.Iridescence),a(ha.IridescenceThickness),a(ha.Anisotropy)}async[Aa](){if(null!=this[Ta]){const t=await this[Ta].doLazyLoad();return this[Ra](),this[Ta]=void 0,this.ensureLoaded=async()=>{},t}return null}colorFromRgb(t){const e=new et;return t instanceof Array?e.fromArray(t):e.set(t),e}[La](){if(null!=this[Ta])throw new Error(`Material "${this.name}" has not been loaded, call 'await\n    myMaterial.ensureLoaded()' before using an unloaded material.`)}async ensureLoaded(){await this[Aa]()}get isLoaded(){return null==this[Ta]}get isActive(){return this[Da]}[Pa](t){this[Da]=t}get name(){return this[Oa]||""}set name(t){if(this[Oa]=t,null!=this[Rn])for(const e of this[Rn])e.name=t}get pbrMetallicRoughness(){return this[La](),this[ya]}get normalTexture(){return this[La](),this[ba]}get occlusionTexture(){return this[La](),this[wa]}get emissiveTexture(){return this[La](),this[Sa]}get emissiveFactor(){return this[La](),this[xa].emissive.toArray()}get index(){return this[Ea]}hasVariant(t){const e=this[Fa].get(t);return null!=e&&this[ka].has(e.index)}setEmissiveFactor(t){this[La]();const e=this.colorFromRgb(t);for(const t of this[Rn])t.emissive.set(e);this[An]()}[Ca](){return this[xa].transparent?"BLEND":this[xa].alphaTest>0?"MASK":"OPAQUE"}[Ma](){this[La]();for(const t of this[Rn])"MASK"===this[Ca]()?null==t.alphaTest&&(t.alphaTest=.5):t.alphaTest=void 0,t.needsUpdate=!0}setAlphaCutoff(t){this[La]();for(const e of this[Rn])e.alphaTest=t,e.needsUpdate=!0;this[Ma](),this[An]()}getAlphaCutoff(){return this[La](),this[xa].alphaTest}setDoubleSided(t){this[La]();for(const e of this[Rn])e.side=t?m:A,e.needsUpdate=!0;this[An]()}getDoubleSided(){return this[La](),this[xa].side==m}setAlphaMode(t){this[La]();const e=(t,e)=>{t.transparent=e,t.depthWrite=!e};for(const i of this[Rn])e(i,"BLEND"===t),i.alphaTest="MASK"===t?.5:void 0,i.needsUpdate=!0;this[An]()}getAlphaMode(){return this[La](),this[Ca]()}get emissiveStrength(){return this[La](),this[xa].emissiveIntensity}setEmissiveStrength(t){this[La]();for(const e of this[Rn])e.emissiveIntensity=t;this[An]()}get clearcoatFactor(){return this[La](),this[xa].clearcoat}get clearcoatRoughnessFactor(){return this[La](),this[xa].clearcoatRoughness}get clearcoatTexture(){return this[La](),this[Ia].get(ha.Clearcoat)}get clearcoatRoughnessTexture(){return this[La](),this[Ia].get(ha.ClearcoatRoughness)}get clearcoatNormalTexture(){return this[La](),this[Ia].get(ha.ClearcoatNormal)}get clearcoatNormalScale(){return this[La](),this[xa].clearcoatNormalScale.x}setClearcoatFactor(t){this[La]();for(const e of this[Rn])e.clearcoat=t;this[An]()}setClearcoatRoughnessFactor(t){this[La]();for(const e of this[Rn])e.clearcoatRoughness=t;this[An]()}setClearcoatNormalScale(t){this[La]();for(const e of this[Rn])e.clearcoatNormalScale=new c(t,t);this[An]()}get ior(){return this[La](),this[xa].ior}setIor(t){this[La]();for(const e of this[Rn])e.ior=t;this[An]()}get sheenColorFactor(){return this[La](),this[xa].sheenColor.toArray()}get sheenColorTexture(){return this[La](),this[Ia].get(ha.SheenColor)}get sheenRoughnessFactor(){return this[La](),this[xa].sheenRoughness}get sheenRoughnessTexture(){return this[La](),this[Ia].get(ha.SheenRoughness)}setSheenColorFactor(t){this[La]();const e=this.colorFromRgb(t);for(const t of this[Rn])t.sheenColor.set(e),t.sheen=1;this[An]()}setSheenRoughnessFactor(t){this[La]();for(const e of this[Rn])e.sheenRoughness=t,e.sheen=1;this[An]()}get transmissionFactor(){return this[La](),this[xa].transmission}get transmissionTexture(){return this[La](),this[Ia].get(ha.Transmission)}setTransmissionFactor(t){this[La]();for(const e of this[Rn])e.transmission=t;this[An]()}get thicknessFactor(){return this[La](),this[xa].thickness}get thicknessTexture(){return this[La](),this[Ia].get(ha.Thickness)}get attenuationDistance(){return this[La](),this[xa].attenuationDistance}get attenuationColor(){return this[La](),this[xa].attenuationColor.toArray()}setThicknessFactor(t){this[La]();for(const e of this[Rn])e.thickness=t;this[An]()}setAttenuationDistance(t){this[La]();for(const e of this[Rn])e.attenuationDistance=t;this[An]()}setAttenuationColor(t){this[La]();const e=this.colorFromRgb(t);for(const t of this[Rn])t.attenuationColor.set(e);this[An]()}get specularFactor(){return this[La](),this[xa].specularIntensity}get specularTexture(){return this[La](),this[Ia].get(ha.Specular)}get specularColorFactor(){return this[La](),this[xa].specularColor.toArray()}get specularColorTexture(){return this[La](),this[Ia].get(ha.SheenColor)}setSpecularFactor(t){this[La]();for(const e of this[Rn])e.specularIntensity=t;this[An]()}setSpecularColorFactor(t){this[La]();const e=this.colorFromRgb(t);for(const t of this[Rn])t.specularColor.set(e);this[An]()}get iridescenceFactor(){return this[La](),this[xa].iridescence}get iridescenceTexture(){return this[La](),this[Ia].get(ha.Iridescence)}get iridescenceIor(){return this[La](),this[xa].iridescenceIOR}get iridescenceThicknessMinimum(){return this[La](),this[xa].iridescenceThicknessRange[0]}get iridescenceThicknessMaximum(){return this[La](),this[xa].iridescenceThicknessRange[1]}get iridescenceThicknessTexture(){return this[La](),this[Ia].get(ha.IridescenceThickness)}setIridescenceFactor(t){this[La]();for(const e of this[Rn])e.iridescence=t;this[An]()}setIridescenceIor(t){this[La]();for(const e of this[Rn])e.iridescenceIOR=t;this[An]()}setIridescenceThicknessMinimum(t){this[La]();for(const e of this[Rn])e.iridescenceThicknessRange[0]=t;this[An]()}setIridescenceThicknessMaximum(t){this[La]();for(const e of this[Rn])e.iridescenceThicknessRange[1]=t;this[An]()}get anisotropyStrength(){return this[La](),this[xa].anisotropy}get anisotropyRotation(){return this[La](),this[xa].anisotropyRotation}get anisotropyTexture(){return this[La](),this[Ia].get(ha.Anisotropy)}setAnisotropyStrength(t){this[La]();for(const e of this[Rn])e.anisotropy=t;this[An]()}setAnisotropyRotation(t){this[La]();for(const e of this[Rn])e.anisotropyRotation=t;this[An]()}}class Va{constructor(t){this.name="",this.children=new Array,this.name=t}}class Na extends Va{constructor(t,e,i,s){super(t.name),this.materials=new Map,this.variantToMaterialMap=new Map,this.initialMaterialIdx=0,this.activeMaterialIdx=0,this.mesh=t;const{gltf:n,threeGLTF:a,threeObjectMap:r}=s;this.parser=a.parser,this.modelVariants=i,this.mesh.userData.variantData=i;const o=r.get(t.material);null!=o.materials?this.initialMaterialIdx=this.activeMaterialIdx=o.materials:console.error(`Primitive (${t.name}) missing initial material reference.`);const l=t.userData.associations||{};if(null==l.meshes)return void console.error("Mesh is missing primitive index association");const h=((n.meshes||[])[l.meshes].primitives||[])[l.primitives];if(null!=h){if(null!=h.material)this.materials.set(h.material,e[h.material]);else{const t=e.findIndex((t=>"Default"===t.name));t>=0?this.materials.set(t,e[t]):console.warn("gltfPrimitive has no material!")}if(h.extensions&&h.extensions.KHR_materials_variants){const t=h.extensions.KHR_materials_variants,s=a.parser.json.extensions.KHR_materials_variants.variants;for(const n of t.mappings){const t=e[n.material];this.materials.set(n.material,t);for(const e of n.variants){const{name:n}=s[e];this.variantToMaterialMap.set(e,t),t[ka].add(e),i.has(n)||i.set(n,{name:n,index:e})}}}}else console.error("Mesh primitive definition is missing.")}async setActiveMaterial(t){const e=this.materials.get(t);if(t!==this.activeMaterialIdx){const i=e[Rn],s=await e[Aa]();this.mesh.material=null!=s?s:i.values().next().value,this.parser.assignFinalMaterial(this.mesh),i.add(this.mesh.material),this.activeMaterialIdx=t}return this.mesh.material}getActiveMaterial(){return this.materials.get(this.activeMaterialIdx)}getMaterial(t){return this.materials.get(t)}async enableVariant(t){if(null==t)return this.setActiveMaterial(this.initialMaterialIdx);if(null!=this.variantToMaterialMap&&this.modelVariants.has(t)){const e=this.modelVariants.get(t);return this.enableVariantHelper(e.index)}return null}async enableVariantHelper(t){if(null!=this.variantToMaterialMap&&null!=t){const e=this.variantToMaterialMap.get(t);if(null!=e)return this.setActiveMaterial(e.index)}return null}async instantiateVariants(){if(null!=this.variantToMaterialMap)for(const t of this.variantToMaterialMap.keys()){const e=this.mesh.userData.variantMaterials.get(t);if(null!=e.material)continue;const i=await this.enableVariantHelper(t);null!=i&&(e.material=i)}}get variantInfo(){return this.variantToMaterialMap}addVariant(t,e){if(!this.ensureVariantIsUnused(e))return!1;this.modelVariants.has(e)||this.modelVariants.set(e,{name:e,index:this.modelVariants.size});const i=this.modelVariants.get(e).index;return t[ka].add(i),this.variantToMaterialMap.set(i,t),this.materials.set(t.index,t),this.updateVariantUserData(i,t),!0}deleteVariant(t){if(this.variantInfo.has(t)){this.variantInfo.delete(t);const e=this.mesh.userData.variantMaterials;null!=e&&e.delete(t)}}updateVariantUserData(t,e){e[ka].add(t),this.mesh.userData.variantData=this.modelVariants,this.mesh.userData.variantMaterials=this.mesh.userData.variantMaterials||new Map;this.mesh.userData.variantMaterials.set(t,{material:e[Rn].values().next().value,gltfMaterialIndex:e.index})}ensureVariantIsUnused(t){const e=this.modelVariants.get(t);return null==e||!this.variantInfo.has(e.index)||(console.warn(`Primitive cannot add variant '${t}' for this material, it already exists.`),!1)}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ba,ja,Ua,_a,Ha,qa;const Wa=Symbol("materials"),Ga=Symbol("hierarchy"),Xa=Symbol("roots"),$a=Symbol("primitives"),Ya=Symbol("prepareVariantsForExport"),Ka=Symbol("switchVariant"),Za=Symbol("materialFromPoint"),Ja=Symbol("nodeFromPoint"),Qa=Symbol("nodeFromIndex"),tr=Symbol("variantData"),er=Symbol("availableVariants"),ir=Symbol("modelOnUpdate"),sr=Symbol("cloneMaterial");class nr{constructor(t,e,i,s){this.gltf=t,this.gltfElementMap=e,this.mapKey=i,this.doLazyLoad=s}}class ar{constructor(t,e=()=>{}){this[Ba]=new Array,this[ja]=new Array,this[Ua]=new Array,this[_a]=new Array,this[Ha]=()=>{},this[qa]=new Map,this[ir]=e;const{gltf:i,threeGLTF:s,gltfElementMap:n}=t;for(const[t,a]of i.materials.entries()){const r=n.get(a);if(null!=r)this[Wa].push(new za(e,t,!0,this[tr],r,a.name));else{const r=(i.materials||[])[t],o=new Set;n.set(r,o);const l=async()=>{const e=await s.parser.getDependency("material",t);return o.add(e),e};this[Wa].push(new za(e,t,!1,this[tr],o,a.name,new nr(i,n,r,l)))}}const a=new Map,r=new Array;for(const t of s.scene.children)r.push(t);for(;r.length>0;){const e=r.pop();let i=null;e instanceof u?(i=new Na(e,this.materials,this[tr],t),this[$a].push(i)):i=new Va(e.name);const s=a.get(e);null!=s?s.children.push(i):this[Xa].push(i),this[Ga].push(i);for(const t of e.children)r.push(t),a.set(e,i)}}get materials(){return this[Wa]}[(Ba=Wa,ja=Ga,Ua=Xa,_a=$a,Ha=ir,qa=tr,er)](){const t=Array.from(this[tr].values());return t.sort(((t,e)=>t.index-e.index)),t.map((t=>t.name))}getMaterialByName(t){const e=this[Wa].filter((e=>e.name===t));return e.length>0?e[0]:null}[Qa](t,e){const i=this[Ga].find((i=>{if(i instanceof Na){const{meshes:s,primitives:n}=i.mesh.userData.associations;if(s==t&&n==e)return!0}return!1}));return null==i?null:i}[Ja](t){return this[Ga].find((e=>{if(e instanceof Na){if(e.mesh===t.object)return!0}return!1}))}[Za](t){return this[Ja](t).getActiveMaterial()}async[Ka](t){for(const e of this[$a])await e.enableVariant(t);for(const t of this.materials)t[Pa](!1);for(const t of this[$a])this.materials[t.getActiveMaterial().index][Pa](!0)}async[Ya](){const t=new Array;for(const e of this[$a])t.push(e.instantiateVariants());await Promise.all(t)}[sr](t,e){const i=this.materials[t];i.isLoaded||console.error("Cloning an unloaded material,\n           call 'material.ensureLoaded() before cloning the material.");const s=i[Rn],n=new Set;for(const[t,i]of s.entries()){const a=i.clone();a.name=e+(s.size>1?"_inst"+t:""),n.add(a)}const a=new za(this[ir],this[Wa].length,!1,this[tr],n,e);return this[Wa].push(a),a}createMaterialInstanceForVariant(t,e,i,s=!0){let n=null;for(const s of this[$a]){const a=this[tr].get(i);null!=a&&s.variantInfo.has(a.index)||null!=s.getMaterial(t)&&(this.hasVariant(i)||this.createVariant(i),null==n&&(n=this[sr](t,e)),s.addVariant(n,i))}if(s&&null!=n){n[Pa](!0),this.materials[t][Pa](!1);for(const t of this[$a])t.enableVariant(i)}return n}createVariant(t){this[tr].has(t)?console.warn(`Variant '${t}'' already exists`):this[tr].set(t,{name:t,index:this[tr].size})}hasVariant(t){return this[tr].has(t)}setMaterialToVariant(t,e){if(null!=this[er]().find((t=>t===e)))if(t<0||t>=this.materials.length)console.error("setMaterialToVariant(): materialIndex is out of bounds.");else for(const i of this[$a]){const s=i.getMaterial(t);null!=s&&i.addVariant(s,e)}else console.warn(`Can't add material to '${e}', the variant does not exist.'`)}updateVariantName(t,e){const i=this[tr].get(t);null!=i&&(i.name=e,this[tr].set(e,i),this[tr].delete(t))}deleteVariant(t){const e=this[tr].get(t);if(null!=e){for(const i of this.materials)i.hasVariant(t)&&i[ka].delete(e.index);for(const t of this[$a])t.deleteVariant(e.index);this[tr].delete(t)}}}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rr=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};const or=Symbol("currentGLTF"),lr=Symbol("originalGltfJson"),hr=Symbol("model"),cr=Symbol("getOnUpdateMethod"),ur=Symbol("buildTexture");
/* @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class dr extends u{constructor(){super(void 0,new D({depthWrite:!1})),this.height=0,this.radius=0,this.resolution=0,this.userData.noHit=!0}get map(){return this.material.map}set map(t){this.material.map=t}isUsable(){return this.height>0&&this.radius>0&&null!=this.geometry&&null!=this.map}updateGeometry(t=this.height,e=this.radius,i=128){t==this.height&&e==this.radius&&i==this.resolution||(this.height=t,this.radius=e,this.resolution=i,t>0&&e>0&&(this.geometry.dispose(),this.geometry=function(t,e,i){const s=new nt(e,2*i,i);s.scale(1,1,-1);const n=s.getAttribute("position"),a=new y;for(let e=0;e<n.count;++e)if(a.fromBufferAttribute(n,e),a.y<0){const i=3*-t/2,s=a.y<i?-t/a.y:1-a.y*a.y/(3*i*i);a.multiplyScalar(s),a.toArray(n.array,3*e)}return n.needsUpdate=!0,s}
/* @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(t,e,i)))}}const pr=new y,mr=new y,gr=new y,fr=new b,vr=new at,yr=new S;class br extends St{constructor(t){super(document.createElement("div")),this.normal=new y(0,1,0),this.initialized=!1,this.referenceCount=1,this.pivot=document.createElement("div"),this.slot=document.createElement("slot"),this.element.classList.add("annotation-wrapper"),this.slot.name=t.name,this.element.appendChild(this.pivot),this.pivot.appendChild(this.slot),this.updatePosition(t.position),this.updateNormal(t.normal),this.surface=t.surface}get facingCamera(){return!this.element.classList.contains("hide")}show(){this.facingCamera&&this.initialized||this.updateVisibility(!0)}hide(){!this.facingCamera&&this.initialized||this.updateVisibility(!1)}increment(){this.referenceCount++}decrement(){return this.referenceCount>0&&--this.referenceCount,0===this.referenceCount}updatePosition(t){if(null==t)return;const e=Ve(t)[0].terms;for(let t=0;t<3;++t)this.position.setComponent(t,$e(e[t]).number);this.updateMatrixWorld()}updateNormal(t){if(null==t)return;const e=Ve(t)[0].terms;for(let t=0;t<3;++t)this.normal.setComponent(t,e[t].number)}updateSurface(){const{mesh:t,tri:e,bary:i}=this;if(null==t||null==e||null==i)return;t.getVertexPosition(e.x,pr),t.getVertexPosition(e.y,mr),t.getVertexPosition(e.z,gr),pr.toArray(fr.elements,0),mr.toArray(fr.elements,3),gr.toArray(fr.elements,6),this.position.copy(i).applyMatrix3(fr);const s=this.parent;s.worldToLocal(t.localToWorld(this.position)),vr.set(pr,mr,gr),vr.getNormal(this.normal).transformDirection(t.matrixWorld);const n=s.parent;yr.setFromAxisAngle(pr.set(0,1,0),-n.rotation.y),this.normal.applyQuaternion(yr)}orient(t){this.pivot.style.transform=`rotate(${t}rad)`}updateVisibility(t){this.element.classList.toggle("hide",!t),this.slot.assignedNodes().forEach((e=>{if(e.nodeType!==Node.ELEMENT_NODE)return;const i=e,s=i.dataset.visibilityAttribute;if(null!=s){const e=`data-${s}`;i.toggleAttribute(e,t)}i.dispatchEvent(new CustomEvent("hotspot-visibility",{detail:{visible:t}}))})),this.initialized=!0}}
/* @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr extends rt{constructor(t,e,i){super(),this.camera=new q,this.renderTarget=null,this.renderTargetBlur=null,this.depthMaterial=new ot,this.horizontalBlurMaterial=new U(Et),this.verticalBlurMaterial=new U(Pt),this.intensity=0,this.softness=1,this.boundingBox=new lt,this.size=new y,this.maxDimension=0,this.isAnimated=!1,this.needsUpdate=!1;const{camera:s}=this;s.rotation.x=Math.PI/2,s.left=-.5,s.right=.5,s.bottom=-.5,s.top=.5,this.add(s);const n=new g,a=new D({opacity:1,transparent:!0,side:P});this.floor=new u(n,a),this.floor.userData.noHit=!0,s.add(this.floor),this.blurPlane=new u(n),this.blurPlane.visible=!1,s.add(this.blurPlane),t.target.add(this),this.depthMaterial.onBeforeCompile=function(t){t.fragmentShader=t.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * opacity );")},this.depthMaterial.side=m,this.horizontalBlurMaterial.depthTest=!1,this.verticalBlurMaterial.depthTest=!1,this.setScene(t,e,i)}setScene(t,e,i){const{boundingBox:s,size:n,rotation:a,position:r}=this;if(this.isAnimated=t.animationNames.length>0,this.boundingBox.copy(t.boundingBox),this.size.copy(t.size),this.maxDimension=Math.max(n.x,n.y,n.z)*(this.isAnimated?2:1),this.boundingBox.getCenter(r),"back"===i){const{min:t,max:e}=s;[t.y,t.z]=[t.z,t.y],[e.y,e.z]=[e.z,e.y],[n.y,n.z]=[n.z,n.y],a.x=Math.PI/2,a.y=Math.PI}else a.x=0,a.y=0;if(this.isAnimated){const t=s.min.y,e=s.max.y;n.y=this.maxDimension,s.expandByVector(n.subScalar(this.maxDimension).multiplyScalar(-.5)),s.min.y=t,s.max.y=e,n.set(this.maxDimension,e-t,this.maxDimension)}"bottom"===i?r.y=s.min.y:r.z=s.min.y,this.setSoftness(e)}setSoftness(t){this.softness=t;const{size:e,camera:i}=this,s=this.isAnimated?2:1,n=s*Math.pow(2,9-3*t);this.setMapSize(n);const a=e.y/2,r=e.y*s;i.near=0,i.far=kt(r,a,t),this.depthMaterial.opacity=1/t,i.updateProjectionMatrix(),this.setIntensity(this.intensity),this.setOffset(0)}setMapSize(t){const{size:e}=this;this.isAnimated&&(t*=2);const i=Math.floor(e.x>e.z?t:t*e.x/e.z),s=Math.floor(e.x>e.z?t*e.z/e.x:t),n=10+i,a=10+s;if(null==this.renderTarget||this.renderTarget.width===n&&this.renderTarget.height===a||(this.renderTarget.dispose(),this.renderTarget=null,this.renderTargetBlur.dispose(),this.renderTargetBlur=null),null==this.renderTarget){const t={format:N};this.renderTarget=new W(n,a,t),this.renderTargetBlur=new W(n,a,t),this.floor.material.map=this.renderTarget.texture}this.camera.scale.set(e.x*(1+10/i),e.z*(1+10/s),1),this.needsUpdate=!0}setIntensity(t){this.intensity=t,t>0?(this.visible=!0,this.floor.visible=!0,this.floor.material.opacity=t*kt(.3,1,this.softness*this.softness)):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.intensity}setOffset(t){this.floor.position.z=-t+this.gap()}gap(){return.001*this.maxDimension}render(t,e){e.overrideMaterial=this.depthMaterial;const i=t.getClearAlpha();t.setClearAlpha(0),this.floor.visible=!1;const s=t.xr.enabled;t.xr.enabled=!1;const n=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.render(e,this.camera),e.overrideMaterial=null,this.floor.visible=!0,this.blurShadow(t),t.xr.enabled=s,t.setRenderTarget(n),t.setClearAlpha(i)}blurShadow(t){const{camera:e,horizontalBlurMaterial:i,verticalBlurMaterial:s,renderTarget:n,renderTargetBlur:a,blurPlane:r}=this;r.visible=!0,r.material=i,i.uniforms.h.value=1/this.renderTarget.width,i.uniforms.tDiffuse.value=this.renderTarget.texture,t.setRenderTarget(a),t.render(r,e),r.material=s,s.uniforms.v.value=1/this.renderTarget.height,s.uniforms.tDiffuse.value=this.renderTargetBlur.texture,t.setRenderTarget(n),t.render(r,e),r.visible=!1}dispose(){null!=this.renderTarget&&this.renderTarget.dispose(),null!=this.renderTargetBlur&&this.renderTargetBlur.dispose(),this.depthMaterial.dispose(),this.horizontalBlurMaterial.dispose(),this.verticalBlurMaterial.dispose(),this.floor.material.dispose(),this.floor.geometry.dispose(),this.blurPlane.geometry.dispose(),this.removeFromParent()}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sr=new y,xr=new y,Mr=new y,Cr=new ht,Tr=new y,Rr=new c;class Ar extends L{constructor({canvas:t,element:e,width:i,height:s}){super(),this.annotationRenderer=new xt,this.effectRenderer=null,this.schemaElement=document.createElement("script"),this.width=1,this.height=1,this.aspect=1,this.scaleStep=0,this.renderCount=0,this.externalRenderer=null,this.appendedAnimations=[],this.markedAnimations=[],this.camera=new M(45,1,.1,100),this.xrCamera=null,this.url=null,this.pivot=new rt,this.target=new rt,this.animationNames=[],this.boundingBox=new lt,this.boundingSphere=new R,this.size=new y,this.idealAspect=0,this.framedFoVDeg=0,this.shadow=null,this.shadowIntensity=0,this.shadowSoftness=1,this.bakedShadows=new Set,this.exposure=1,this.toneMapping=o,this.canScale=!0,this.isDirty=!1,this.goalTarget=new y,this.targetDamperX=new Pe,this.targetDamperY=new Pe,this.targetDamperZ=new Pe,this._currentGLTF=null,this._model=null,this.cancelPendingSourceChange=null,this.animationsByName=new Map,this.currentAnimationAction=null,this.groundedSkybox=new dr,this.name="ModelScene",this.element=e,this.canvas=t,this.camera=new M(45,1,.1,100),this.camera.name="MainCamera",this.add(this.pivot),this.pivot.name="Pivot",this.pivot.add(this.target),this.setSize(i,s),this.target.name="Target",this.mixer=new ct(this.target);const{domElement:n}=this.annotationRenderer,{style:a}=n;a.display="none",a.pointerEvents="none",a.position="absolute",a.top="0",this.element.shadowRoot.querySelector(".default").appendChild(n),this.schemaElement.setAttribute("type","application/ld+json")}get context(){return this.canvas.getContext("2d")}getCamera(){return null!=this.xrCamera?this.xrCamera:this.camera}queueRender(){this.isDirty=!0}shouldRender(){return this.isDirty}hasRendered(){this.isDirty=!1}forceRescale(){this.scaleStep=-1,this.queueRender()}async setObject(t){this.reset(),this._model=t,this.target.add(t),await this.setupScene()}async setSource(t,e=()=>{}){if(!t||t===this.url)return void e(1);if(this.reset(),this.url=t,null!=this.externalRenderer){const t=await this.externalRenderer.load(e);return this.boundingSphere.radius=t.framedRadius,void(this.idealAspect=t.fieldOfViewAspect)}let i;null!=this.cancelPendingSourceChange&&(this.cancelPendingSourceChange(),this.cancelPendingSourceChange=null);try{i=await new Promise((async(i,s)=>{this.cancelPendingSourceChange=()=>s();try{i(await this.element[bo].loader.load(t,this.element,e))}catch(t){s(t)}}))}catch(t){if(null==t)return;throw t}this.cancelPendingSourceChange=null,this.reset(),this.url=t,this._currentGLTF=i,null!=i&&(this._model=i.scene,this.target.add(i.scene));const{animations:s}=i,n=new Map,a=[];for(const t of s)n.set(t.name,t),a.push(t.name);this.animations=s,this.animationsByName=n,this.animationNames=a,await this.setupScene()}async setupScene(){this.applyTransform(),this.updateBoundingBox(),await this.updateFraming(),this.updateShadow(),this.setShadowIntensity(this.shadowIntensity),this.setGroundedSkybox()}reset(){this.url=null,this.renderCount=0,this.queueRender(),null!=this.shadow&&this.shadow.setIntensity(0),this.bakedShadows.clear();const{_model:t}=this;null!=t&&(t.removeFromParent(),this._model=null);const e=this._currentGLTF;null!=e&&(e.dispose(),this._currentGLTF=null),null!=this.currentAnimationAction&&(this.currentAnimationAction.stop(),this.currentAnimationAction=null),this.mixer.stopAllAction(),this.mixer.uncacheRoot(this)}dispose(){this.reset(),null!=this.shadow&&(this.shadow.dispose(),this.shadow=null),this.element[or]=null,this.element[lr]=null,this.element[hr]=null}get currentGLTF(){return this._currentGLTF}setSize(t,e){if(this.width!==t||this.height!==e){if(this.width=Math.max(t,1),this.height=Math.max(e,1),this.annotationRenderer.setSize(t,e),this.aspect=this.width/this.height,null!=this.externalRenderer){const i=window.devicePixelRatio;this.externalRenderer.resize(t*i,e*i)}this.queueRender()}}markBakedShadow(t){t.userData.noHit=!0,this.bakedShadows.add(t)}unmarkBakedShadow(t){t.userData.noHit=!1,t.visible=!0,this.bakedShadows.delete(t),this.boundingBox.expandByObject(t)}findBakedShadows(t){const e=new lt;t.traverse((t=>{const i=t;if(!i.material)return;if(!i.material.transparent)return;e.setFromObject(i);const s=e.getSize(Tr),n=Math.min(s.x,s.y,s.z);Math.max(s.x,s.y,s.z)<100*n||this.markBakedShadow(i)}))}checkBakedShadows(){const{min:t,max:e}=this.boundingBox,i=new lt;this.boundingBox.getSize(this.size);for(const s of this.bakedShadows)i.setFromObject(s),i.min.y<t.y+this.size.y/100&&i.min.x<=t.x&&i.max.x>=e.x&&i.min.z<=t.z&&i.max.z>=e.z||i.min.z<t.z+this.size.z/100&&i.min.x<=t.x&&i.max.x>=e.x&&i.min.y<=t.y&&i.max.y>=e.y||this.unmarkBakedShadow(s)}applyTransform(){const{model:t}=this;if(null==t)return;const e=Ve(this.element.orientation)[0].terms,i=$e(e[0]).number,s=$e(e[1]).number,n=$e(e[2]).number;t.quaternion.setFromEuler(new w(s,n,i,"YXZ"));const a=Ve(this.element.scale)[0].terms;t.scale.set(a[0].number,a[1].number,a[2].number)}updateBoundingBox(){const{model:t}=this;if(null==t)return;this.target.remove(t),this.findBakedShadows(t);const e=(t,e)=>t.expandByPoint(e);this.setBakedShadowVisibility(!1),this.boundingBox=Mt(t,e,new lt),this.boundingBox.isEmpty()&&(this.setBakedShadowVisibility(!0),this.bakedShadows.forEach((t=>this.unmarkBakedShadow(t))),this.boundingBox=Mt(t,e,new lt)),this.checkBakedShadows(),this.setBakedShadowVisibility(),this.boundingBox.getSize(this.size),this.target.add(t)}async updateFraming(){const{model:t}=this;if(null==t)return;this.target.remove(t),this.setBakedShadowVisibility(!1);const{center:e}=this.boundingSphere;this.element.requestUpdate("cameraTarget"),await this.element.updateComplete,e.copy(this.getTarget());this.boundingSphere.radius=Math.sqrt(Mt(t,((t,i)=>Math.max(t,e.distanceToSquared(i))),0));this.idealAspect=Mt(t,((t,i)=>{i.sub(e);const s=Math.sqrt(i.x*i.x+i.z*i.z);return Math.max(t,s/(this.idealCameraDistance()-Math.abs(i.y)))}),0)/Math.tan(this.framedFoVDeg/2*Math.PI/180),this.setBakedShadowVisibility(),this.target.add(t)}setBakedShadowVisibility(t=this.shadowIntensity<=0){for(const e of this.bakedShadows)e.visible=t}idealCameraDistance(){const t=this.framedFoVDeg/2*Math.PI/180;return this.boundingSphere.radius/Math.sin(t)}adjustedFoV(t){const e=Math.tan(t/2*Math.PI/180)*Math.max(1,this.idealAspect/this.aspect);return 2*Math.atan(e)*180/Math.PI}getNDC(t,e){if(null!=this.xrCamera)Rr.set(t/window.screen.width,e/window.screen.height);else{const i=this.element.getBoundingClientRect();Rr.set((t-i.x)/this.width,(e-i.y)/this.height)}return Rr.multiplyScalar(2).subScalar(1),Rr.y*=-1,Rr}getSize(){return{width:this.width,height:this.height}}setEnvironmentAndSkybox(t,e){this.element[bo].arRenderer.presentedScene!==this&&(this.environment=t,this.setBackground(e),this.queueRender())}setBackground(t){this.groundedSkybox.map=t,this.groundedSkybox.isUsable()?(this.target.add(this.groundedSkybox),this.background=null):(this.target.remove(this.groundedSkybox),this.background=t)}farRadius(){return this.boundingSphere.radius*(null!=this.groundedSkybox.parent?10:1)}setGroundedSkybox(){const t=Ve(this.element.skyboxHeight)[0].terms[0],e=$e(t).number,i=10*this.boundingSphere.radius;this.groundedSkybox.updateGeometry(e,i),this.groundedSkybox.position.y=e-(this.shadow?2*this.shadow.gap():0),this.setBackground(this.groundedSkybox.map)}setTarget(t,e,i){this.goalTarget.set(-t,-e,-i)}setTargetDamperDecayTime(t){this.targetDamperX.setDecayTime(t),this.targetDamperY.setDecayTime(t),this.targetDamperZ.setDecayTime(t)}getTarget(){return this.goalTarget.clone().multiplyScalar(-1)}getDynamicTarget(){return this.target.position.clone().multiplyScalar(-1)}jumpToGoal(){this.updateTarget(1e4)}updateTarget(t){const e=this.goalTarget,i=this.target.position;if(e.equals(i))return!1;{const s=this.boundingSphere.radius/10;let{x:n,y:a,z:r}=i;return n=this.targetDamperX.update(n,e.x,t,s),a=this.targetDamperY.update(a,e.y,t,s),r=this.targetDamperZ.update(r,e.z,t,s),this.groundedSkybox.position.x=-n,this.groundedSkybox.position.z=-r,this.target.position.set(n,a,r),this.target.updateMatrixWorld(),this.queueRender(),!0}}pointTowards(t,e){const{x:i,z:s}=this.position;this.yaw=Math.atan2(t-i,e-s)}get model(){return this._model}set yaw(t){this.pivot.rotation.y=t,this.groundedSkybox.rotation.y=-t,this.queueRender()}get yaw(){return this.pivot.rotation.y}set animationTime(t){this.mixer.setTime(t),this.queueShadowRender()}get animationTime(){if(null!=this.currentAnimationAction){const t=Math.max(this.currentAnimationAction._loopCount,0);return this.currentAnimationAction.loop!==ut||1&~t?this.currentAnimationAction.time:this.duration-this.currentAnimationAction.time}return 0}set animationTimeScale(t){this.mixer.timeScale=t}get animationTimeScale(){return this.mixer.timeScale}get duration(){return null!=this.currentAnimationAction&&this.currentAnimationAction.getClip()?this.currentAnimationAction.getClip().duration:0}get hasActiveAnimation(){return null!=this.currentAnimationAction}playAnimation(t=null,e=0,i=dt,s=1/0){if(null==this._currentGLTF)return;const{animations:n}=this;if(null==n||0===n.length)return;let a=null;if(null!=t&&(a=this.animationsByName.get(t),null==a)){const e=parseInt(t);!isNaN(e)&&e>=0&&e<n.length&&(a=n[e])}null==a&&(a=n[0]);try{const{currentAnimationAction:t}=this,n=this.mixer.clipAction(a,this);n.timeScale!=this.element.timeScale&&(n.timeScale=this.element.timeScale),this.currentAnimationAction=n,this.element.paused?this.mixer.stopAllAction():(n.paused=!1,null!=t&&n!==t?n.crossFadeFrom(t,e,!1):this.animationTimeScale>0&&this.animationTime==this.duration&&(this.animationTime=0)),n.setLoop(i,s),n.enabled=!0,n.clampWhenFinished=!0,n.play()}catch(t){console.error(t)}}appendAnimation(t="",e=dt,i=1/0,s=1,n=1,a=!1,r=!1,o=!0,l=null,h=!1){if(null==this._currentGLTF||t===this.element.animationName)return;const{animations:c}=this;if(null==c||0===c.length)return;let u=null;if(t&&(u=this.animationsByName.get(t)),null!=u){"string"==typeof i?isNaN(i)?(i=1/0,console.warn("Invalid repetitionCount value, repetitionCount is set to Infinity")):i=Math.max(parseInt(i),1):"number"==typeof i&&i<1&&(i=1),1===i&&e!==pt&&(e=pt),"string"==typeof s&&(isNaN(s)?(s=1,console.warn("Invalid weight value, weight is set to 1")):s=parseFloat(s)),"string"==typeof n&&(isNaN(n)?(n=1,console.warn("Invalid timeScale value, timeScale is set to 1")):n=parseFloat(n)),"string"==typeof a&&("true"===a.toLowerCase().trim()?a=!0:"false"===a.toLowerCase().trim()?a=!1:isNaN(a)?(a=!1,console.warn("Invalid fade value, fade is set to false")):a=parseFloat(a)),"string"==typeof r&&("true"===r.toLowerCase().trim()?r=!0:"false"===r.toLowerCase().trim()?r=!1:isNaN(r)?(r=!1,console.warn("Invalid warp value, warp is set to false")):r=parseFloat(r)),"string"==typeof l&&(isNaN(l)||(l=parseFloat(l)));try{const c=this.mixer.existingAction(u)||this.mixer.clipAction(u,this),d=c.timeScale;h&&this.appendedAnimations.includes(t)&&(this.markedAnimations.map((t=>t.name)).includes(t)||this.markedAnimations.push({name:t,loopMode:e,repetitionCount:i})),"number"==typeof l&&(c.time=Math.min(Math.max(l,0),u.duration)),"boolean"==typeof a&&a?c.fadeIn(1.25):"number"==typeof a?c.fadeIn(Math.max(a,0)):s>=0&&(c.weight=Math.min(Math.max(s,0),1)),"boolean"==typeof r&&r?c.warp(o?d:0,n,1.25):"number"==typeof r?c.warp(o?d:0,n,Math.max(r,0)):c.timeScale=n,c.isRunning()||(c.time==u.duration&&c.stop(),c.setLoop(e,i),c.paused=!1,c.enabled=!0,c.clampWhenFinished=!0,c.play()),this.appendedAnimations.includes(t)||this.element[mo].appendedAnimations.push(t)}catch(t){console.error(t)}}}detachAnimation(t="",e=!0){if(null==this._currentGLTF||t===this.element.animationName)return;const{animations:i}=this;if(null==i||0===i.length)return;let s=null;if(t&&(s=this.animationsByName.get(t)),null!=s){"string"==typeof e&&("true"===e.toLowerCase().trim()?e=!0:"false"===e.toLowerCase().trim()?e=!1:isNaN(e)?(e=!0,console.warn("Invalid fade value, fade is set to true")):e=parseFloat(e));try{const i=this.mixer.existingAction(s)||this.mixer.clipAction(s,this);"boolean"==typeof e&&e?i.fadeOut(1.5):"number"==typeof e?i.fadeOut(Math.max(e,0)):i.stop();const n=this.element[mo].appendedAnimations.filter((e=>e!==t));this.element[mo].appendedAnimations=n}catch(t){console.error(t)}}}updateAnimationLoop(t="",e=dt,i=1/0){if(null==this._currentGLTF||t===this.element.animationName)return;const{animations:s}=this;if(null==s||0===s.length)return;let n=null;if(t&&(n=this.animationsByName.get(t)),null!=n)try{const t=this.mixer.existingAction(n)||this.mixer.clipAction(n,this);t.stop(),t.setLoop(e,i),t.play()}catch(t){console.error(t)}}stopAnimation(){this.currentAnimationAction=null,this.mixer.stopAllAction()}updateAnimation(t){this.mixer.update(t),this.queueShadowRender()}subscribeMixerEvent(t,e){this.mixer.addEventListener(t,e)}updateShadow(){const t=this.shadow;if(null!=t){const e="wall"===this.element.arPlacement?"back":"bottom";t.setScene(this,this.shadowSoftness,e),t.needsUpdate=!0}}renderShadow(t){const e=this.shadow;null!=e&&1==e.needsUpdate&&(e.render(t,this),e.needsUpdate=!1)}queueShadowRender(){null!=this.shadow&&(this.shadow.needsUpdate=!0)}setShadowIntensity(t){if(this.shadowIntensity=t,null!=this._currentGLTF&&(this.setBakedShadowVisibility(),!(t<=0&&null==this.shadow))){if(null==this.shadow){const t="wall"===this.element.arPlacement?"back":"bottom";this.shadow=new wr(this,this.shadowSoftness,t)}this.shadow.setIntensity(t)}}setShadowSoftness(t){this.shadowSoftness=t;const e=this.shadow;null!=e&&e.setSoftness(t)}setShadowOffset(t){const e=this.shadow;null!=e&&e.setOffset(t)}getHit(t=this){return Cr.intersectObject(t,!0).find((t=>t.object.visible&&!t.object.userData.noHit))}hitFromController(t,e=this){return Cr.setFromXRController(t),this.getHit(e)}hitFromPoint(t,e=this){return Cr.setFromCamera(t,this.getCamera()),this.getHit(e)}positionAndNormalFromPoint(t,e=this){var i;const s=this.hitFromPoint(t,e);if(null==s)return null;return{position:s.point,normal:null!=s.face?s.face.normal.clone().applyNormalMatrix((new b).getNormalMatrix(s.object.matrixWorld)):Cr.ray.direction.clone().multiplyScalar(-1),uv:null!==(i=s.uv)&&void 0!==i?i:null}}surfaceFromPoint(t,e=this){const i=this.element.model;if(null==i)return null;const s=this.hitFromPoint(t,e);if(null==s||null==s.face)return null;const n=i[Ja](s),{meshes:a,primitives:r}=n.mesh.userData.associations,o=new y,l=new y,h=new y,{a:c,b:u,c:d}=s.face,p=s.object;p.getVertexPosition(c,o),p.getVertexPosition(u,l),p.getVertexPosition(d,h);const m=new at(o,l,h),g=new y;return m.getBarycoord(p.worldToLocal(s.point),g),`${a} ${r} ${c} ${u} ${d} ${g.x.toFixed(3)} ${g.y.toFixed(3)} ${g.z.toFixed(3)}`}addHotspot(t){this.target.add(t),this.annotationRenderer.domElement.appendChild(t.element),this.updateSurfaceHotspot(t)}removeHotspot(t){this.target.remove(t)}forHotspots(t){const{children:e}=this.target;for(let i=0,s=e.length;i<s;i++){const s=e[i];s instanceof br&&t(s)}}updateSurfaceHotspot(t){if(null==t.surface||null==this.element.model)return;const e=Ve(t.surface)[0].terms;if(8!=e.length)return void console.warn(t.surface+" does not have exactly 8 numbers.");const i=this.element.model[Qa](e[0].number,e[1].number);if(null==i)return void console.warn(t.surface+" does not match a node/primitive in this glTF! Skipping this hotspot.");const s=i.mesh.geometry.attributes.position.count,n=new y(e[2].number,e[3].number,e[4].number);if(n.x>=s||n.y>=s||n.z>=s)return void console.warn(t.surface+" vertex indices out of range in this glTF! Skipping this hotspot.");const a=new y(e[5].number,e[6].number,e[7].number);t.mesh=i.mesh,t.tri=n,t.bary=a,t.updateSurface()}animateSurfaceHotspots(){this.element.paused||this.forHotspots((t=>{t.updateSurface()}))}updateHotspotsVisibility(t){this.forHotspots((e=>{Sr.copy(t),xr.setFromMatrixPosition(e.matrixWorld),Sr.sub(xr),Mr.copy(e.normal).transformDirection(this.target.matrixWorld),Sr.dot(Mr)<0?e.hide():e.show()}))}orientHotspots(t){this.forHotspots((e=>{e.orient(t)}))}setHotspotsVisibility(t){this.forHotspots((e=>{e.visible=t}))}updateSchema(t){var e;const{schemaElement:i,element:s}=this,{alt:n,poster:a,iosSrc:r}=s;if(null!=t){const s=[{"@type":"MediaObject",contentUrl:t,encodingFormat:"gltf"===(null===(e=t.split(".").pop())||void 0===e?void 0:e.toLowerCase())?"model/gltf+json":"model/gltf-binary"}];r&&s.push({"@type":"MediaObject",contentUrl:r,encodingFormat:"model/vnd.usdz+zip"});const o={"@context":"http://schema.org/","@type":"3DModel",image:null!=a?a:void 0,name:null!=n?n:void 0,encoding:s};i.textContent=JSON.stringify(o),document.head.appendChild(i)}else null!=i.parentElement&&i.parentElement.removeChild(i)}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr extends EventTarget{constructor(){super(...arguments),this.ongoingActivities=new Set,this.totalProgress=0}get ongoingActivityCount(){return this.ongoingActivities.size}beginActivity(t){const e={progress:0,completed:!1};return this.ongoingActivities.add(e),1===this.ongoingActivityCount&&this.announceTotalProgress(e,0,t),i=>{let s;return s=Math.max(Yt(i,0,1),e.progress),s!==e.progress&&this.announceTotalProgress(e,s,t),e.progress}}announceTotalProgress(t,e,i){let s=0,n=0;1==e&&(t.completed=!0);for(const t of this.ongoingActivities){const{progress:e}=t;s+=1-e,t.completed&&n++}const a=t.progress;t.progress=e,this.totalProgress+=(e-a)*(1-this.totalProgress)/s;const r=n===this.ongoingActivityCount?1:this.totalProgress;this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:r,reason:i}})),n===this.ongoingActivityCount&&(this.totalProgress=0,this.ongoingActivities.clear())}}
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Er,Pr,kr,Dr,Fr,Or,Ir,zr,Vr,Nr,Br,jr,Ur,_r=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};const Hr=document.createElement("canvas"),qr=Symbol("fallbackResizeHandler"),Wr=Symbol("defaultAriaLabel"),Gr=Symbol("resizeObserver"),Xr=Symbol("clearModelTimeout"),$r=Symbol("onContextLost"),Yr=Symbol("loaded"),Kr=Symbol("status"),Zr=Symbol("onFocus"),Jr=Symbol("onBlur"),Qr=Symbol("updateSize"),to=Symbol("intersectionObserver"),eo=Symbol("isElementInViewport"),io=Symbol("announceModelVisibility"),so=Symbol("ariaLabel"),no=Symbol("altDefaulted"),ao=Symbol("statusElement"),ro=Symbol("updateStatus"),oo=Symbol("loadedTime"),lo=Symbol("updateSource"),ho=Symbol("markLoaded"),co=Symbol("container"),uo=Symbol("input"),po=Symbol("canvas"),mo=Symbol("scene"),go=Symbol("needsRender"),fo=Symbol("tick"),vo=Symbol("onModelLoad"),yo=Symbol("onResize"),bo=Symbol("renderer"),wo=Symbol("progressTracker"),So=Symbol("getLoaded"),xo=Symbol("getModelIsVisible"),Mo=Symbol("shouldAttemptPreload"),Co=t=>({x:t.x,y:t.y,z:t.z,toString(){return`${this.x}m ${this.y}m ${this.z}m`}}),To=t=>({u:t.x,v:t.y,toString(){return`${this.u} ${this.v}`}});class Ro extends ft{static get is(){return"model-viewer"}static set modelCacheSize(t){Re[Ce].evictionThreshold=t}static get modelCacheSize(){return Re[Ce].evictionThreshold}static set minimumRenderScale(t){t>1&&console.warn("<model-viewer> minimumRenderScale has been clamped to a maximum value of 1."),t<=0&&console.warn("<model-viewer> minimumRenderScale has been clamped to a minimum value of 0.25."),Tn.singleton.minScale=t}static get minimumRenderScale(){return Tn.singleton.minScale}get loaded(){return this[So]()}get[(Er=eo,Pr=Yr,kr=oo,Dr=Kr,Fr=Xr,Or=qr,Ir=io,zr=Gr,Vr=to,Nr=wo,bo)](){return Tn.singleton}get modelIsVisible(){return this[xo]()}constructor(){super(),this.alt=null,this.src=null,this.withCredentials=!1,this.generateSchema=!1,this[Er]=!1,this[Pr]=!1,this[kr]=0,this[Dr]="",this[Fr]=null,this[Or]=$t((()=>{const t=this.getBoundingClientRect();this[Qr](t)}),50),this[Ir]=$t((t=>{const e=this.modelIsVisible;e!==t&&this.dispatchEvent(new CustomEvent("model-visibility",{detail:{visible:e}}))}),0),this[zr]=null,this[Vr]=null,this[Nr]=new Lr,this[Br]=()=>{this[ao].textContent=this[Kr]},this[jr]=()=>{this[ao].textContent=""},this[Ur]=t=>{this.dispatchEvent(new CustomEvent("error",{detail:{type:"webglcontextlost",sourceError:t.sourceEvent}}))},this.attachShadow({mode:"open"});const t=this.shadowRoot;let e,i;if((t=>{gt(ie,t)})(t),this[co]=t.querySelector(".container"),this[uo]=t.querySelector(".userInput"),this[po]=t.querySelector("canvas"),this[ao]=t.querySelector("#status"),this[Wr]=this[uo].getAttribute("aria-label"),this.isConnected){const t=this.getBoundingClientRect();e=t.width,i=t.height}else e=300,i=150;this[mo]=new Ar({canvas:this[po],element:this,width:e,height:i}),Promise.resolve().then((()=>{this[Qr](this.getBoundingClientRect())})),It&&(this[Gr]=new ResizeObserver((t=>{if(!this[bo].isPresenting)for(let e of t)e.target===this&&this[Qr](e.contentRect)}))),zt?this[to]=new IntersectionObserver((t=>{for(let e of t)if(e.target===this){const t=this.modelIsVisible;this[eo]=e.isIntersecting,this[io](t),this[eo]&&!this.loaded&&this[lo]()}}),{root:null,rootMargin:"0px",threshold:1e-5}):this[eo]=!0}connectedCallback(){super.connectedCallback&&super.connectedCallback(),It?this[Gr].observe(this):self.addEventListener("resize",this[qr]),zt&&this[to].observe(this),this.addEventListener("focus",this[Zr]),this.addEventListener("blur",this[Jr]);const t=this[bo];t.addEventListener("contextlost",this[$r]),t.registerScene(this[mo]),null!=this[Xr]&&(self.clearTimeout(this[Xr]),this[Xr]=null,this.requestUpdate("src",null))}disconnectedCallback(){super.disconnectedCallback&&super.disconnectedCallback(),It?this[Gr].unobserve(this):self.removeEventListener("resize",this[qr]),zt&&this[to].unobserve(this),this.removeEventListener("focus",this[Zr]),this.removeEventListener("blur",this[Jr]);const t=this[bo];t.removeEventListener("contextlost",this[$r]),t.unregisterScene(this[mo]),this[Xr]=self.setTimeout((()=>{this[mo].dispose(),this[Xr]=null}),10)}updated(t){super.updated(t),t.has("src")&&(null==this.src?(this[Yr]=!1,this[oo]=0,this[mo].reset()):this.src!==this[mo].url&&(this[Yr]=!1,this[oo]=0,this[lo]())),t.has("alt")&&this[uo].setAttribute("aria-label",this[so]),t.has("generateSchema")&&(this.generateSchema?this[mo].updateSchema(this.src):this[mo].updateSchema(null))}toDataURL(t,e){return this[bo].displayCanvas(this[mo]).toDataURL(t,e)}async toBlob(t){const e=t?t.mimeType:void 0,i=t?t.qualityArgument:void 0,s=t?t.idealAspect:void 0,{width:n,height:a,idealAspect:r,aspect:o}=this[mo],{dpr:l,scaleFactor:h}=this[bo];let c=n*h*l,u=a*h*l,d=0,p=0;if(!0===s)if(r>o){const t=u;u=Math.round(c/r),p=(t-u)/2}else{const t=c;c=Math.round(u*r),d=(t-c)/2}Hr.width=c,Hr.height=u;try{return new Promise((async(t,s)=>{Hr.getContext("2d").drawImage(this[bo].displayCanvas(this[mo]),d,p,c,u,0,0,c,u),Hr.toBlob((e=>{if(!e)return s(new Error("Unable to retrieve canvas blob"));t(e)}),e,i)}))}finally{this[Qr]({width:n,height:a})}}registerEffectComposer(t){t.setRenderer(this[bo].threeRenderer),t.setMainCamera(this[mo].getCamera()),t.setMainScene(this[mo]),this[mo].effectRenderer=t}unregisterEffectComposer(){this[mo].effectRenderer=null}registerRenderer(t){this[mo].externalRenderer=t}unregisterRenderer(){this[mo].externalRenderer=null}get[so](){return this[no]}get[no](){return null==this.alt||"null"===this.alt?this[Wr]:this.alt}[So](){return this[Yr]}[xo](){return this.loaded&&this[eo]}[Mo](){return!!this.src&&this[eo]}[Qr]({width:t,height:e}){0!==t&&0!==e&&(this[co].style.width=`${t}px`,this[co].style.height=`${e}px`,this[yo]({width:t,height:e}))}[fo](t,e){var i;null===(i=this[mo].effectRenderer)||void 0===i||i.beforeRender(t,e)}[ho](){this[Yr]||(this[Yr]=!0,this[oo]=performance.now())}[go](){this[mo].queueRender()}[vo](){}[ro](t){this[Kr]=t;const e=this.getRootNode();null!=e&&e.activeElement===this&&this[ao].textContent!=t&&(this[ao].textContent=t)}[(Br=Zr,jr=Jr,yo)](t){this[mo].setSize(t.width,t.height)}async[(Ur=$r,lo)](){const t=this[mo];if(this.loaded||!this[Mo]()||this.src===t.url)return;this.generateSchema&&t.updateSchema(this.src),this[ro]("Loading"),t.stopAnimation();const e=this[wo].beginActivity("model-load"),i=this.src;try{const s=t.setSource(i,(t=>e(.95*Yt(t,0,1)))),n=this[te]();await Promise.all([s,n]),this[ho](),this[vo](),this.updateComplete.then((()=>{this.dispatchEvent(new CustomEvent("before-render"))})),await new Promise((t=>{requestAnimationFrame((()=>{requestAnimationFrame((()=>{this.dispatchEvent(new CustomEvent("load",{detail:{url:i}})),t()}))}))}))}catch(t){this.dispatchEvent(new CustomEvent("error",{detail:{type:"loadfailure",sourceError:t}}))}finally{e(1)}}}_r([t({type:String})],Ro.prototype,"alt",void 0),_r([t({type:String})],Ro.prototype,"src",void 0),_r([t({type:Boolean,attribute:"with-credentials"})],Ro.prototype,"withCredentials",void 0),_r([t({type:Boolean,attribute:"generate-schema"})],Ro.prototype,"generateSchema",void 0);
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ao=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};const Lo=Symbol("changeAnimation"),Eo=Symbol("appendAnimation"),Po=Symbol("detachAnimation"),ko=Symbol("paused"),Do={repetitions:1/0,pingpong:!1},Fo={pingpong:!1,repetitions:null,weight:1,timeScale:1,fade:!1,warp:!1,relativeWarp:!0,time:null},Oo={fade:!0},Io=Symbol("hotspotMap"),zo=Symbol("mutationCallback"),Vo=Symbol("observer"),No=Symbol("addHotspot"),Bo=Symbol("removeHotspot"),jo=new x;
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Uo=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};let _o=!1,Ho=!1;const qo="#model-viewer-no-ar-fallback",Wo=(Go=["quick-look","scene-viewer","webxr","none"],t=>{try{const e=Ve(t),i=(e.length?e[0].terms:[]).filter((t=>t&&"ident"===t.type)).map((t=>t.value)).filter((t=>Go.indexOf(t)>-1));return new Set(i)}catch(t){}return new Set});var Go;const Xo="quick-look",$o="scene-viewer",Yo="webxr",Ko="none",Zo=Symbol("arButtonContainer"),Jo=Symbol("enterARWithWebXR"),Qo=Symbol("openSceneViewer"),tl=Symbol("openIOSARQuickLook"),el=Symbol("canActivateAR"),il=Symbol("arMode"),sl=Symbol("arModes"),nl=Symbol("arAnchor"),al=Symbol("preload"),rl=Symbol("onARButtonContainerClick"),ol=Symbol("onARStatus"),ll=Symbol("onARTracking"),hl=Symbol("onARTap"),cl=Symbol("selectARMode"),ul=Symbol("triggerLoad");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var dl=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};const pl="auto",ml="auto",gl="eager",fl=Symbol("defaultProgressBarElement"),vl=Symbol("posterContainerElement"),yl=Symbol("defaultPosterElement"),bl=Symbol("shouldDismissPoster"),wl=Symbol("hidePoster"),Sl=Symbol("modelIsRevealed"),xl=Symbol("updateProgressBar"),Ml=Symbol("ariaLabelCallToAction"),Cl=Symbol("onProgress");
/* @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Tl=function(t,e,i,s){var n,a=arguments.length,r=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(r=(a<3?n(r):a>3?n(e,i,r):n(e,i))||r);return a>3&&r&&Object.defineProperty(e,i,r),r};const Rl=Math.PI/32,Al={basis:[Ge(ze(Rl,"rad"))],keywords:{auto:[null]}},Ll=Symbol("autoRotateStartTime"),El=Symbol("radiansPerSecond"),Pl=Symbol("syncRotationRate"),kl=Symbol("onCameraChange"),Dl=(t=>{var e,i,s;class n extends t{constructor(){super(...arguments),this[e]=new Map,this[i]=t=>{t.forEach((t=>{t instanceof MutationRecord&&"childList"!==t.type||(t.addedNodes.forEach((t=>{this[No](t)})),t.removedNodes.forEach((t=>{this[Bo](t)})),this[go]())}))},this[s]=new MutationObserver(this[zo])}connectedCallback(){super.connectedCallback();for(let t=0;t<this.children.length;++t)this[No](this.children[t]);const{ShadyDOM:t}=self;null==t?this[Vo].observe(this,{childList:!0}):this[Vo]=t.observeChildren(this,this[zo])}disconnectedCallback(){super.disconnectedCallback();const{ShadyDOM:t}=self;null==t?this[Vo].disconnect():t.unobserveChildren(this[Vo])}[(e=Io,i=zo,s=Vo,vo)](){super[vo]();const t=this[mo];t.forHotspots((e=>{t.updateSurfaceHotspot(e)}))}[fo](t,e){super[fo](t,e);const i=this[mo],{annotationRenderer:s}=i,n=i.getCamera();i.shouldRender()&&(i.animateSurfaceHotspots(),i.updateHotspotsVisibility(n.position),s.domElement.style.display="",s.render(i,n))}updateHotspot(t){const e=this[Io].get(t.name);null!=e&&(e.updatePosition(t.position),e.updateNormal(t.normal),e.surface=t.surface,this[mo].updateSurfaceHotspot(e),this[go]())}queryHotspot(t){const e=this[Io].get(t);if(null==e)return null;const i=Co(e.position),s=Co(e.normal),n=e.facingCamera,a=this[mo],r=a.getCamera(),o=new y;o.setFromMatrixPosition(e.matrixWorld),o.project(r);const l=a.width/2,h=a.height/2;o.x=o.x*l+l,o.y=-o.y*h+h;const c=Co(new y(o.x,o.y,o.z));return Number.isFinite(c.x)&&Number.isFinite(c.y)?{position:i,normal:s,canvasPosition:c,facingCamera:n}:null}positionAndNormalFromPoint(t,e){const i=this[mo],s=i.getNDC(t,e),n=i.positionAndNormalFromPoint(s);if(null==n)return null;jo.copy(i.target.matrixWorld).invert();const a=Co(n.position.applyMatrix4(jo)),r=Co(n.normal.transformDirection(jo));let o=null;return null!=n.uv&&(o=To(n.uv)),{position:a,normal:r,uv:o}}surfaceFromPoint(t,e){const i=this[mo],s=i.getNDC(t,e);return i.surfaceFromPoint(s)}[No](t){if(!(t instanceof HTMLElement&&0===t.slot.indexOf("hotspot")))return;let e=this[Io].get(t.slot);null!=e?e.increment():(e=new br({name:t.slot,position:t.dataset.position,normal:t.dataset.normal,surface:t.dataset.surface}),this[Io].set(t.slot,e),this[mo].addHotspot(e)),this[mo].queueRender()}[Bo](t){if(!(t instanceof HTMLElement))return;const e=this[Io].get(t.slot);e&&(e.decrement()&&(this[mo].removeHotspot(e),this[Io].delete(t.slot)),this[mo].queueRender())}}return n})((e=>{var i,s,n;class a extends e{constructor(){super(...arguments),this[i]=void 0,this[s]=null,this[n]=null,this.variantName=null,this.orientation="0 0 0",this.scale="1 1 1"}get model(){return this[hr]}get availableVariants(){return this.model?this.model[er]():[]}get originalGltfJson(){return this[lr]}[(i=hr,s=or,n=lr,cr)](){return()=>{this[go]()}}[ur](t){return t.colorSpace=z,t.wrapS=G,t.wrapT=G,new Qn(this[cr](),t)}async createTexture(t,e="image/png"){const{textureUtils:i}=this[bo],s=await i.loadImage(t,this.withCredentials);return s.userData.mimeType=e,this[ur](s)}async createLottieTexture(t,e=1){const{textureUtils:i}=this[bo],s=await i.loadLottie(t,e,this.withCredentials);return this[ur](s)}createVideoTexture(t){const e=document.createElement("video");e.crossOrigin=this.withCredentials?"use-credentials":"anonymous",e.src=t,e.muted=!0,e.playsInline=!0,e.loop=!0,e.play();const i=new it(e);return this[ur](i)}createCanvasTexture(){const t=document.createElement("canvas"),e=new st(t);return this[ur](e)}async updated(t){if(super.updated(t),t.has("variantName")){const t=this[wo].beginActivity("variant-update");t(.1);const e=this[hr],{variantName:i}=this;null!=e&&(await e[Ka](i),this[go](),this.dispatchEvent(new CustomEvent("variant-applied"))),t(1)}if(t.has("orientation")||t.has("scale")){if(!this.loaded)return;const t=this[mo];t.applyTransform(),t.updateBoundingBox(),t.updateShadow(),this[bo].arRenderer.onUpdateScene(),this[go]()}}[vo](){super[vo]();const{currentGLTF:t}=this[mo];if(null!=t){const{correlatedSceneGraph:e}=t;null!=e&&t!==this[or]&&(this[hr]=new ar(e,this[cr]()),this[lr]=JSON.parse(JSON.stringify(e.gltf))),"variants"in t.userData&&this.requestUpdate("variantName")}this[or]=t}async exportScene(t){const e=this[mo];return new Promise((async(i,s)=>{const n={binary:!0,onlyVisible:!0,maxTextureSize:1/0,includeCustomExtensions:!1,forceIndices:!1};Object.assign(n,t),n.animations=e.animations,n.truncateDrawRange=!0;const a=e.shadow;let r=!1;null!=a&&(r=a.visible,a.visible=!1),await this[hr][Ya]();(new Ct).register((t=>new Ee(t))).parse(e.model,(t=>i(new Blob([n.binary?t:JSON.stringify(t)],{type:n.binary?"application/octet-stream":"application/json"}))),(()=>s("glTF export failed")),n),null!=a&&(a.visible=r)}))}materialFromPoint(t,e){const i=this[hr];if(null==i)return null;const s=this[mo],n=s.getNDC(t,e),a=s.hitFromPoint(n);return null==a||null==a.face?null:i[Za](a)}}return rr([t({type:String,attribute:"variant-name"})],a.prototype,"variantName",void 0),rr([t({type:String,attribute:"orientation"})],a.prototype,"orientation",void 0),rr([t({type:String,attribute:"scale"})],a.prototype,"scale",void 0),a})((e=>{var i,s,n;class a extends e{constructor(){super(...arguments),this.autoRotate=!1,this.autoRotateDelay=3e3,this.rotationPerSecond="auto",this[i]=performance.now(),this[s]=0,this[n]=t=>{this.autoRotate&&"user-interaction"===t.detail.source&&(this[Ll]=performance.now())}}connectedCallback(){super.connectedCallback(),this.addEventListener("camera-change",this[kl]),this[Ll]=performance.now()}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("camera-change",this[kl]),this[Ll]=performance.now()}updated(t){super.updated(t),t.has("autoRotate")&&(this[Ll]=performance.now())}[(i=Ll,s=El,Pl)](t){this[El]=t[0]}[fo](t,e){if(super[fo](t,e),!this.autoRotate||!this[xo]()||this[bo].isPresenting)return;const i=Math.min(e,t-this[Ll]-this.autoRotateDelay);i>0&&(this[mo].yaw=this.turntableRotation+this[El]*i*.001)}get turntableRotation(){return this[mo].yaw}resetTurntableRotation(t=0){this[mo].yaw=t}}return n=kl,Tl([t({type:Boolean,attribute:"auto-rotate"})],a.prototype,"autoRotate",void 0),Tl([t({type:Number,attribute:"auto-rotate-delay"})],a.prototype,"autoRotateDelay",void 0),Tl([Di({intrinsics:Al,updateHandler:Pl}),t({type:String,attribute:"rotation-per-second"})],a.prototype,"rotationPerSecond",void 0),a})((l=>{var h,c,u;class d extends l{constructor(){super(...arguments),this.environmentImage=null,this.skyboxImage=null,this.shadowIntensity=0,this.shadowSoftness=1,this.exposure=1,this.toneMapping="auto",this.skyboxHeight="0",this[h]=null,this[c]=null,this[u]=null}updated(t){super.updated(t),t.has("shadowIntensity")&&(this[mo].setShadowIntensity(.5*this.shadowIntensity),this[go]()),t.has("shadowSoftness")&&(this[mo].setShadowSoftness(this.shadowSoftness),this[go]()),t.has("exposure")&&(this[mo].exposure=this.exposure,this[go]()),t.has("toneMapping")&&(this[mo].toneMapping="aces"===this.toneMapping?e:"agx"===this.toneMapping?i:"reinhard"===this.toneMapping?s:"cineon"===this.toneMapping?n:"linear"===this.toneMapping?a:"none"===this.toneMapping?r:o,this[go]()),(t.has("environmentImage")||t.has("skyboxImage"))&&this[Mo]()&&this[te](),t.has("skyboxHeight")&&(this[mo].setGroundedSkybox(),this[go]())}hasBakedShadow(){return this[mo].bakedShadows.size>0}async[(h=Jt,c=Qt,u=ee,te)](){const{skyboxImage:t,environmentImage:e}=this;null!=this[ee]&&(this[ee](),this[ee]=null);const{textureUtils:i}=this[bo];if(null==i)return;const s=this[wo].beginActivity("environment-update");try{const{environmentMap:n,skybox:a}=await i.generateEnvironmentMapAndSkybox(Wt(t),e,(t=>s(Yt(t,0,1))),this.withCredentials);this[Jt]!==n&&(this[Jt]=n,this.dispatchEvent(new CustomEvent("environment-change"))),this[Qt]=null!=a?a.name===n.name?n:a:null,this[mo].setEnvironmentAndSkybox(this[Jt],this[Qt])}catch(t){if(t instanceof Error)throw this[mo].setEnvironmentAndSkybox(null,null),t}finally{s(1)}}}return Zt([t({type:String,attribute:"environment-image"})],d.prototype,"environmentImage",void 0),Zt([t({type:String,attribute:"skybox-image"})],d.prototype,"skyboxImage",void 0),Zt([t({type:Number,attribute:"shadow-intensity"})],d.prototype,"shadowIntensity",void 0),Zt([t({type:Number,attribute:"shadow-softness"})],d.prototype,"shadowSoftness",void 0),Zt([t({type:Number})],d.prototype,"exposure",void 0),Zt([t({type:String,attribute:"tone-mapping"})],d.prototype,"toneMapping",void 0),Zt([t({type:String,attribute:"skybox-height"})],d.prototype,"skyboxHeight",void 0),d})((e=>{var i,s,n,a,r,o,l,h,c,u,d,p,m,g,f,y,b,w;class S extends e{constructor(){super(...arguments),this.cameraControls=!1,this.cameraOrbit=Bi,this.cameraTarget="auto auto auto",this.fieldOfView="auto",this.minCameraOrbit="auto",this.maxCameraOrbit="auto",this.minFieldOfView="auto",this.maxFieldOfView="auto",this.interactionPromptThreshold=3e3,this.interactionPrompt=_i,this.interactionPromptStyle=qi,this.orbitSensitivity=1,this.zoomSensitivity=1,this.panSensitivity=1,this.touchAction=Wi,this.disableZoom=!1,this.disablePan=!1,this.disableTap=!1,this.interpolationDecay=50,this.a11y=null,this[i]=this.shadowRoot.querySelector(".interaction-prompt"),this[s]=this.shadowRoot.querySelector("#prompt"),this[n]=[this.shadowRoot.querySelector("#finger0"),this.shadowRoot.querySelector("#finger1")],this[a]=this.shadowRoot.querySelector(".pan-target"),this[r]=0,this[o]=1/0,this[l]=!1,this[h]=!1,this[c]=zs.AUTOMATIC,this[u]=new Vs(this[mo].camera,this[uo],this[mo]),this[d]=new v,this[p]=!1,this[m]=!1,this[g]=!1,this[f]={},this[y]=()=>{const t=this[is].changeSource;this[bs]=t,t===zs.USER_INTERACTION&&(this[fs]=!0,this[os]())},this[b]=()=>{this[ls](),this[go]();const t=this[is].changeSource;this.dispatchEvent(new CustomEvent("camera-change",{detail:{source:t}}))},this[w]=t=>{this[co].classList.toggle("pointer-tumbling","pointer-change-start"===t.type)}}get inputSensitivity(){return this[is].inputSensitivity}set inputSensitivity(t){this[is].inputSensitivity=t}getCameraOrbit(){const{theta:t,phi:e,radius:i}=this[ws];return{theta:t,phi:e,radius:i,toString(){return`${this.theta}rad ${this.phi}rad ${this.radius}m`}}}getCameraTarget(){return Co(this[bo].isPresenting?this[bo].arRenderer.target:this[mo].getDynamicTarget())}getFieldOfView(){return this[is].getFieldOfView()}getMinimumFieldOfView(){return this[is].options.minimumFieldOfView}getMaximumFieldOfView(){return this[is].options.maximumFieldOfView}getIdealAspect(){return this[mo].idealAspect}jumpCameraToGoal(){this[Ss]=!0,this.requestUpdate(Ss,!1)}resetInteractionPrompt(){this[ys]=0,this[vs]=1/0,this[fs]=!1,this[gs]=this.interactionPrompt===_i&&this.cameraControls}zoom(t){const e=new WheelEvent("wheel",{deltaY:-30*t});this[uo].dispatchEvent(e)}connectedCallback(){super.connectedCallback(),this[is].addEventListener("user-interaction",this[ds]),this[is].addEventListener("pointer-change-start",this[ms]),this[is].addEventListener("pointer-change-end",this[ms])}disconnectedCallback(){super.disconnectedCallback(),this[is].removeEventListener("user-interaction",this[ds]),this[is].removeEventListener("pointer-change-start",this[ms]),this[is].removeEventListener("pointer-change-end",this[ms])}updated(t){super.updated(t);const e=this[is],i=this[mo];if(t.has("cameraControls")&&(this.cameraControls?(e.enableInteraction(),this.interactionPrompt===_i&&(this[gs]=!0)):(e.disableInteraction(),this[os]()),this[uo].setAttribute("aria-label",this[so])),t.has("disableZoom")&&(e.disableZoom=this.disableZoom),t.has("disablePan")&&(e.enablePan=!this.disablePan),t.has("disableTap")&&(e.enableTap=!this.disableTap),(t.has("interactionPrompt")||t.has("cameraControls")||t.has("src"))&&(this.interactionPrompt===_i&&this.cameraControls&&!this[fs]?this[gs]=!0:this[os]()),t.has("interactionPromptStyle")&&(this[as].style.opacity=this.interactionPromptStyle==Hi?"1":"0"),t.has("touchAction")){const t=this.touchAction;e.applyOptions({touchAction:t}),e.updateTouchActionStyle()}t.has("orbitSensitivity")&&(e.orbitSensitivity=this.orbitSensitivity),t.has("zoomSensitivity")&&(e.zoomSensitivity=this.zoomSensitivity),t.has("panSensitivity")&&(e.panSensitivity=this.panSensitivity),t.has("interpolationDecay")&&(e.setDamperDecayTime(this.interpolationDecay),i.setTargetDamperDecayTime(this.interpolationDecay)),t.has("a11y")&&this[cs](),!0===this[Ss]&&Promise.resolve().then((()=>{e.jumpToGoal(),i.jumpToGoal(),this[ps](),this[Ss]=!1}))}async updateFraming(){const t=this[mo],e=t.adjustedFoV(t.framedFoVDeg);await t.updateFraming();const i=t.adjustedFoV(t.framedFoVDeg),s=this[is].getFieldOfView()/e;this[is].setFieldOfView(i*s),this[Ms]=!0,this.requestUpdate("maxFieldOfView"),this.requestUpdate("fieldOfView"),this.requestUpdate("minCameraOrbit"),this.requestUpdate("maxCameraOrbit"),this.requestUpdate("cameraOrbit"),await this.updateComplete}interact(t,e,i){const s=this[uo],n=this[rs];if("1"===n[0].style.opacity)return void console.warn("interact() failed because an existing interaction is running.");const a=new Array;a.push({x:Ii(e.x),y:Ii(e.y)});const r=[{x:a[0].x(0),y:a[0].y(0)}];null!=i&&(a.push({x:Ii(i.x),y:Ii(i.y)}),r.push({x:a[1].x(0),y:a[1].y(0)}));let o=performance.now();const{width:l,height:h}=this[mo],c=this.getBoundingClientRect(),u=t=>{for(const[e,i]of r.entries()){const{style:a}=n[e];a.transform=`translateX(${l*i.x}px) translateY(${h*i.y}px)`,"pointerdown"===t?a.opacity="1":"pointerup"===t&&(a.opacity="0");const r={pointerId:e-5678,pointerType:"touch",target:s,clientX:l*i.x+c.x,clientY:h*i.y+c.y,altKey:!0};s.dispatchEvent(new PointerEvent(t,r))}},d=()=>{const e=this[bs];if(e!==zs.AUTOMATIC||!s.isConnected){for(const t of this[rs])t.style.opacity="0";return u("pointercancel"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:e}})),void document.removeEventListener("visibilitychange",p)}const i=Math.min(1,(performance.now()-o)/t);for(const[t,e]of r.entries())e.x=a[t].x(i),e.y=a[t].y(i);u("pointermove"),i<1?requestAnimationFrame(d):(u("pointerup"),this.dispatchEvent(new CustomEvent("interact-stopped",{detail:{source:zs.AUTOMATIC}})),document.removeEventListener("visibilitychange",p))},p=()=>{let t=0;"hidden"===document.visibilityState?t=performance.now()-o:o=performance.now()-t};document.addEventListener("visibilitychange",p),u("pointerdown"),this[bs]=zs.AUTOMATIC,requestAnimationFrame(d)}[(i=ns,s=as,n=rs,a=ss,r=ys,o=vs,l=fs,h=gs,c=bs,u=is,d=ws,p=Ss,m=xs,g=Ms,f=hs,Ts)](t){const e=this[is],i=this[mo];i.framedFoVDeg=180*t[0]/Math.PI,e.changeSource=zs.NONE,e.setFieldOfView(i.adjustedFoV(i.framedFoVDeg)),this[ds]()}[Cs](t){const e=this[is];if(this[Ms]){const{theta:e,phi:i}=this.getCameraOrbit();t[0]=e,t[1]=i,this[Ms]=!1}e.changeSource=zs.NONE,e.setOrbit(t[0],t[1],t[2]),this[ds]()}[As](t){this[is].applyOptions({minimumAzimuthalAngle:t[0],minimumPolarAngle:t[1],minimumRadius:t[2]}),this.jumpCameraToGoal()}[Ls](t){this[is].applyOptions({maximumAzimuthalAngle:t[0],maximumPolarAngle:t[1],maximumRadius:t[2]}),this[us](t[2]),this.jumpCameraToGoal()}[Es](t){this[is].applyOptions({minimumFieldOfView:180*t[0]/Math.PI}),this.jumpCameraToGoal()}[Ps](t){const e=this[mo].adjustedFoV(180*t[0]/Math.PI);this[is].applyOptions({maximumFieldOfView:e}),this.jumpCameraToGoal()}[Rs](t){const[e,i,s]=t;this[bo].arRenderer.isPresenting||this[mo].setTarget(e,i,s),this[is].changeSource=zs.NONE,this[bo].arRenderer.updateTarget(),this[ds]()}[fo](t,e){if(super[fo](t,e),this[bo].isPresenting||!this[xo]())return;const i=this[is],s=this[mo],n=performance.now();if(this[gs]&&this.loaded&&n>this[oo]+this.interactionPromptThreshold&&(this[gs]=!1,this[vs]=n,this[ns].classList.add("visible")),isFinite(this[vs])&&this.interactionPromptStyle===qi){const t=(n-this[vs])/5e3%1,e=Vi(t),a=Ni(t);if(this[as].style.opacity=`${a}`,e!==this[ys]){const t=e*s.width*.05,n=(e-this[ys])*Math.PI/16;this[as].style.transform=`translateX(${t}px)`,i.changeSource=zs.AUTOMATIC,i.adjustOrbit(n,0,0),this[ys]=e}}const a=i.update(t,e),r=s.updateTarget(e);(a||r)&&this[ps]()}[os](){this[gs]=!1,this[ns].classList.remove("visible"),this[vs]=1/0}[us](t){const e=Math.max(this[mo].farRadius(),t),i=Math.abs(2*e);this[is].updateNearFar(0,i)}[ls](){const{theta:t,phi:e}=this[is].getCameraSpherical(this[ws]),i=(4+Math.floor((t%es+ts)/Ji))%4,s=Math.floor(e/Qi),n=`${Ui[s]}${ji[i]}`,a=n;a in this[hs]?this[ro](this[hs][a]):this[ro](`View from stage ${n}`)}get[so](){let t=". Use mouse, touch or arrow keys to move.";return"interaction-prompt"in this[hs]&&(t=`. ${this[hs]["interaction-prompt"]}`),super[so].replace(/\.$/,"")+(this.cameraControls?t:"")}async[yo](t){const e=this[is],i=this[mo],s=i.adjustedFoV(i.framedFoVDeg);super[yo](t);const n=i.adjustedFoV(i.framedFoVDeg)/s,a=e.getFieldOfView()*(isFinite(n)?n:1);e.updateAspect(this[mo].aspect),this.requestUpdate("maxFieldOfView",this.maxFieldOfView),await this.updateComplete,this[is].setFieldOfView(a),this.jumpCameraToGoal()}[vo](){super[vo](),this[xs]?this[Ms]=!0:this[xs]=!0,this.requestUpdate("maxFieldOfView",this.maxFieldOfView),this.requestUpdate("fieldOfView",this.fieldOfView),this.requestUpdate("minCameraOrbit",this.minCameraOrbit),this.requestUpdate("maxCameraOrbit",this.maxCameraOrbit),this.requestUpdate("cameraOrbit",this.cameraOrbit),this.requestUpdate("cameraTarget",this.cameraTarget),this.jumpCameraToGoal()}[(y=ds,b=ps,w=ms,cs)](){if("string"==typeof this.a11y)if(this.a11y.startsWith("{"))try{this[hs]=JSON.parse(this.a11y)}catch(t){console.warn("Error parsing a11y JSON:",t)}else this.a11y.length>0?console.warn("Error not supported format, should be a JSON string:",this.a11y):this[hs]={};else"object"==typeof this.a11y&&null!=this.a11y?this[hs]=Object.assign({},this.a11y):this[hs]={};this[uo].setAttribute("aria-label",this[so])}}return zi([t({type:Boolean,attribute:"camera-controls"})],S.prototype,"cameraControls",void 0),zi([Di({intrinsics:$i,observeEffects:!0,updateHandler:Cs}),t({type:String,attribute:"camera-orbit",hasChanged:()=>!0})],S.prototype,"cameraOrbit",void 0),zi([Di({intrinsics:Zi,observeEffects:!0,updateHandler:Rs}),t({type:String,attribute:"camera-target",hasChanged:()=>!0})],S.prototype,"cameraTarget",void 0),zi([Di({intrinsics:Gi,observeEffects:!0,updateHandler:Ts}),t({type:String,attribute:"field-of-view",hasChanged:()=>!0})],S.prototype,"fieldOfView",void 0),zi([Di({intrinsics:Yi,updateHandler:As}),t({type:String,attribute:"min-camera-orbit",hasChanged:()=>!0})],S.prototype,"minCameraOrbit",void 0),zi([Di({intrinsics:Ki,updateHandler:Ls}),t({type:String,attribute:"max-camera-orbit",hasChanged:()=>!0})],S.prototype,"maxCameraOrbit",void 0),zi([Di({intrinsics:Xi,updateHandler:Es}),t({type:String,attribute:"min-field-of-view",hasChanged:()=>!0})],S.prototype,"minFieldOfView",void 0),zi([Di({intrinsics:Gi,updateHandler:Ps}),t({type:String,attribute:"max-field-of-view",hasChanged:()=>!0})],S.prototype,"maxFieldOfView",void 0),zi([t({type:Number,attribute:"interaction-prompt-threshold"})],S.prototype,"interactionPromptThreshold",void 0),zi([t({type:String,attribute:"interaction-prompt"})],S.prototype,"interactionPrompt",void 0),zi([t({type:String,attribute:"interaction-prompt-style"})],S.prototype,"interactionPromptStyle",void 0),zi([t({type:Number,attribute:"orbit-sensitivity"})],S.prototype,"orbitSensitivity",void 0),zi([t({type:Number,attribute:"zoom-sensitivity"})],S.prototype,"zoomSensitivity",void 0),zi([t({type:Number,attribute:"pan-sensitivity"})],S.prototype,"panSensitivity",void 0),zi([t({type:String,attribute:"touch-action"})],S.prototype,"touchAction",void 0),zi([t({type:Boolean,attribute:"disable-zoom"})],S.prototype,"disableZoom",void 0),zi([t({type:Boolean,attribute:"disable-pan"})],S.prototype,"disablePan",void 0),zi([t({type:Boolean,attribute:"disable-tap"})],S.prototype,"disableTap",void 0),zi([t({type:Number,attribute:"interpolation-decay"})],S.prototype,"interpolationDecay",void 0),zi([t()],S.prototype,"a11y",void 0),S})((e=>{var i,s,n,a,r,o,l,h,c,u;class d extends e{constructor(){super(...arguments),this.ar=!1,this.arScale="auto",this.arUsdzMaxTextureSize="auto",this.arPlacement="floor",this.arModes="webxr scene-viewer quick-look",this.iosSrc=null,this.xrEnvironment=!1,this[i]=!1,this[s]=this.shadowRoot.querySelector(".ar-button"),this[n]=document.createElement("a"),this[a]=new Set,this[r]=Ko,this[o]=!1,this[l]=t=>{t.preventDefault(),this.activateAR()},this[h]=({status:t})=>{t!==Bs&&this[bo].arRenderer.presentedScene!==this[mo]||(this.setAttribute("ar-status",t),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:t}})),t===Bs?this.removeAttribute("ar-tracking"):t===js&&this.setAttribute("ar-tracking",Hs))},this[c]=({status:t})=>{this.setAttribute("ar-tracking",t),this.dispatchEvent(new CustomEvent("ar-tracking",{detail:{status:t}}))},this[u]=t=>{"_apple_ar_quicklook_button_tapped"==t.data&&this.dispatchEvent(new CustomEvent("quick-look-button-tapped"))}}get canActivateAR(){return this[il]!==Ko}connectedCallback(){super.connectedCallback(),this[bo].arRenderer.addEventListener("status",this[ol]),this.setAttribute("ar-status",Bs),this[bo].arRenderer.addEventListener("tracking",this[ll]),this[nl].addEventListener("message",this[hl])}disconnectedCallback(){super.disconnectedCallback(),this[bo].arRenderer.removeEventListener("status",this[ol]),this[bo].arRenderer.removeEventListener("tracking",this[ll]),this[nl].removeEventListener("message",this[hl])}update(t){super.update(t),t.has("arScale")&&(this[mo].canScale="fixed"!==this.arScale),t.has("arPlacement")&&(this[mo].updateShadow(),this[go]()),t.has("arModes")&&(this[sl]=Wo(this.arModes)),(t.has("ar")||t.has("arModes")||t.has("src")||t.has("iosSrc")||t.has("arUsdzMaxTextureSize"))&&this[cl]()}async activateAR(){switch(this[il]){case Xo:await this[tl]();break;case Yo:await this[Jo]();break;case $o:this[Qo]();break;default:console.warn("No AR Mode can be activated. This is probably due to missing configuration or device capabilities")}}async[(i=el,s=Zo,n=nl,a=sl,r=il,o=al,l=rl,h=ol,c=ll,u=hl,cl)](){var t;let e=Ko;if(this.ar){if(null!=this.src)for(const i of this[sl]){if("webxr"===i&&Vt&&!_o&&await this[bo].arRenderer.supportsPresentation()){e=Yo;break}if("scene-viewer"===i&&!Ho&&(_t||navigator.userAgentData&&navigator.userAgentData.getHighEntropyValues&&(null===(t=(await navigator.userAgentData.getHighEntropyValues(["formFactor"])).formFactor)||void 0===t?void 0:t.includes("XR")))){e=$o;break}if("quick-look"===i&&qt){e=Xo;break}}e===Ko&&null!=this.iosSrc&&qt&&(e=Xo)}if(e!==Ko)this[Zo].classList.add("enabled"),this[Zo].addEventListener("click",this[rl]);else if(this[Zo].classList.contains("enabled")){this[Zo].removeEventListener("click",this[rl]),this[Zo].classList.remove("enabled");const t=_s;this.setAttribute("ar-status",t),this.dispatchEvent(new CustomEvent("ar-status",{detail:{status:t}}))}this[il]=e}async[Jo](){console.log("Attempting to present in AR with WebXR..."),await this[ul]();try{this[Zo].removeEventListener("click",this[rl]);const{arRenderer:t}=this[bo];t.placeOnWall="wall"===this.arPlacement,await t.present(this[mo],this.xrEnvironment)}catch(t){console.warn("Error while trying to present in AR with WebXR"),console.error(t),await this[bo].arRenderer.stopPresenting(),_o=!0,console.warn("Falling back to next ar-mode"),await this[cl](),this.activateAR()}finally{this[cl]()}}async[ul](){this.loaded||(this[al]=!0,this[lo](),await((t,e,i=null)=>new Promise((s=>{t.addEventListener(e,(function n(a){i&&!i(a)||(s(a),t.removeEventListener(e,n))}))})))(this,"load"),this[al]=!1)}[Mo](){return super[Mo]()||this[al]}[Qo](){const t=self.location.toString(),e=new URL(t),i=new URL(this.src,t);i.hash&&(i.hash="");const s=new URLSearchParams(i.search);if(e.hash=qo,s.set("mode","ar_preferred"),s.has("disable_occlusion")||s.set("disable_occlusion","true"),"fixed"===this.arScale&&s.set("resizable","false"),"wall"===this.arPlacement&&s.set("enable_vertical_placement","true"),s.has("sound")){const e=new URL(s.get("sound"),t);s.set("sound",e.toString())}if(s.has("link")){const e=new URL(s.get("link"),t);s.set("link",e.toString())}const n=`intent://arvr.google.com/scene-viewer/1.2?${s.toString()+"&file="+encodeURIComponent(i.toString())}#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=${encodeURIComponent(e.toString())};end;`;self.addEventListener("hashchange",(()=>{self.location.hash===qo&&(Ho=!0,self.history.back(),console.warn("Error while trying to present in AR with Scene Viewer"),console.warn("Falling back to next ar-mode"),this[cl]())}),{once:!0}),this[nl].setAttribute("href",n),console.log("Attempting to present in AR with Scene Viewer..."),this[nl].click()}async[tl](){const t=!this.iosSrc;this[Zo].classList.remove("enabled");const e=t?await this.prepareUSDZ():this.iosSrc,i=new URL(e,self.location.toString());if(t){const t=self.location.toString(),e=new URL(t),s=new URL(this.src,e);s.hash&&(i.hash=s.hash)}"fixed"===this.arScale&&(i.hash&&(i.hash+="&"),i.hash+="allowsContentScaling=0");const s=this[nl];s.setAttribute("rel","ar");const n=document.createElement("img");s.appendChild(n),s.setAttribute("href",i.toString()),t&&s.setAttribute("download","model.usdz"),s.style.display="none",s.isConnected||this.shadowRoot.appendChild(s),console.log("Attempting to present in AR with Quick Look..."),s.click(),s.removeChild(n),t&&URL.revokeObjectURL(e),this[Zo].classList.add("enabled")}async prepareUSDZ(){const t=this[wo].beginActivity("usdz-conversion");await this[ul]();const{model:e,shadow:i,target:s}=this[mo];if(null==e)return"";let n=!1;null!=i&&(n=i.visible,i.visible=!1),t(.2);const a=new Dt;s.remove(e),e.position.copy(s.position),e.updateWorldMatrix(!1,!0);const r=await a.parseAsync(e,{maxTextureSize:isNaN(this.arUsdzMaxTextureSize)?1/0:Math.max(parseInt(this.arUsdzMaxTextureSize),16)});e.position.set(0,0,0),s.add(e);const o=new Blob([r],{type:"model/vnd.usdz+zip"}),l=URL.createObjectURL(o);return t(1),null!=i&&(i.visible=n),l}}return Uo([t({type:Boolean,attribute:"ar"})],d.prototype,"ar",void 0),Uo([t({type:String,attribute:"ar-scale"})],d.prototype,"arScale",void 0),Uo([t({type:String,attribute:"ar-usdz-max-texture-size"})],d.prototype,"arUsdzMaxTextureSize",void 0),Uo([t({type:String,attribute:"ar-placement"})],d.prototype,"arPlacement",void 0),Uo([t({type:String,attribute:"ar-modes"})],d.prototype,"arModes",void 0),Uo([t({type:String,attribute:"ios-src"})],d.prototype,"iosSrc",void 0),Uo([t({type:Boolean,attribute:"xr-environment"})],d.prototype,"xrEnvironment",void 0),d})((e=>{var i,s,n,a,r,o,l,h;class c extends e{static set dracoDecoderLocation(t){Re.setDRACODecoderLocation(t)}static get dracoDecoderLocation(){return Re.getDRACODecoderLocation()}static set ktx2TranscoderLocation(t){Re.setKTX2TranscoderLocation(t)}static get ktx2TranscoderLocation(){return Re.getKTX2TranscoderLocation()}static set meshoptDecoderLocation(t){Re.setMeshoptDecoderLocation(t)}static get meshoptDecoderLocation(){return Re.getMeshoptDecoderLocation()}static set lottieLoaderLocation(t){Tn.singleton.textureUtils.lottieLoaderUrl=t}static get lottieLoaderLocation(){return Tn.singleton.textureUtils.lottieLoaderUrl}static mapURLs(t){Tn.singleton.loader[Me].manager.setURLModifier(t)}dismissPoster(){this.loaded?this[wl]():(this[bl]=!0,this[lo]())}showPoster(){const t=this[vl];if(t.classList.contains("show"))return;t.classList.add("show"),this[uo].classList.remove("show");const e=this[yl];e.removeAttribute("tabindex"),e.removeAttribute("aria-hidden");const i=this.modelIsVisible;this[Sl]=!1,this[io](i)}getDimensions(){return Co(this[mo].size)}getBoundingBoxCenter(){return Co(this[mo].boundingBox.getCenter(new y))}constructor(...t){super(...t),this.poster=null,this.reveal=pl,this.loading=ml,this[i]=!1,this[s]=!1,this[n]=this.shadowRoot.querySelector(".slot.poster"),this[a]=this.shadowRoot.querySelector("#default-poster"),this[r]=this.shadowRoot.querySelector("#default-progress-bar > .bar"),this[o]=this[yl].getAttribute("aria-label"),this[l]=((t,e)=>{let i=null;const s=(...s)=>{null==i&&(t(...s),i=self.setTimeout((()=>i=null),e))};return s.flush=()=>{null!=i&&(self.clearTimeout(i),i=null)},s})((t=>{const e=this[fl].parentNode;requestAnimationFrame((()=>{this[fl].style.transform=`scaleX(${t})`,0===t&&(e.removeChild(this[fl]),e.appendChild(this[fl])),this[fl].classList.toggle("hide",1===t)}))}),100),this[h]=t=>{const e=t.detail.totalProgress,i=t.detail.reason;1===e&&(this[xl].flush(),this.loaded&&(this[bl]||this.reveal===pl)&&this[wl]()),this[xl](e),this.dispatchEvent(new CustomEvent("progress",{detail:{totalProgress:e,reason:i}}))};const e=self.ModelViewerElement||{},c=e.dracoDecoderLocation||"https://www.gstatic.com/draco/versioned/decoders/1.5.6/";Re.setDRACODecoderLocation(c);const u=e.ktx2TranscoderLocation||"https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/";Re.setKTX2TranscoderLocation(u),e.meshoptDecoderLocation&&Re.setMeshoptDecoderLocation(e.meshoptDecoderLocation);const d=e.lottieLoaderLocation||"https://cdn.jsdelivr.net/npm/three@0.149.0/examples/jsm/loaders/LottieLoader.js";Tn.singleton.textureUtils.lottieLoaderUrl=d}connectedCallback(){super.connectedCallback(),this.loaded||this.showPoster(),this[wo].addEventListener("progress",this[Cl])}disconnectedCallback(){super.disconnectedCallback(),this[wo].removeEventListener("progress",this[Cl])}async updated(t){super.updated(t),t.has("poster")&&null!=this.poster&&(this[yl].style.backgroundImage=`url(${this.poster})`),t.has("alt")&&this[yl].setAttribute("aria-label",this[no]),(t.has("reveal")||t.has("loading"))&&this[lo]()}[(i=Sl,s=bl,n=vl,a=yl,r=fl,o=Ml,l=xl,h=Cl,Mo)](){return!!this.src&&(this[bl]||this.loading===gl||this.reveal===pl&&this[eo])}[wl](){this[bl]=!1;const t=this[vl];if(!t.classList.contains("show"))return;t.classList.remove("show"),this[uo].classList.add("show");const e=this.modelIsVisible;this[Sl]=!0,this[io](e);const i=this.getRootNode();i&&i.activeElement===this&&this[uo].focus();const s=this[yl];s.setAttribute("aria-hidden","true"),s.tabIndex=-1,this.dispatchEvent(new CustomEvent("poster-dismissed"))}[xo](){return super[xo]()&&this[Sl]}}return dl([t({type:String})],c.prototype,"poster",void 0),dl([t({type:String})],c.prototype,"reveal",void 0),dl([t({type:String})],c.prototype,"loading",void 0),c})((e=>{var i;class s extends e{constructor(...t){super(t),this.autoplay=!1,this.animationName=void 0,this.animationCrossfadeDuration=300,this[i]=!0,this[mo].subscribeMixerEvent("loop",(t=>{const e=t.action._loopCount,i=t.action._clip.name,s=t.action._clip.uuid,n=this[mo].markedAnimations.find((t=>t.name===i));if(n){this[mo].updateAnimationLoop(n.name,n.loopMode,n.repetitionCount);const t=this[mo].markedAnimations.filter((t=>t.name!==i));this[mo].markedAnimations=t}this.dispatchEvent(new CustomEvent("loop",{detail:{count:e,name:i,uuid:s}}))})),this[mo].subscribeMixerEvent("finished",(t=>{if(this[mo].appendedAnimations.includes(t.action._clip.name)){const e=this[mo].appendedAnimations.filter((e=>e!==t.action._clip.name));this[mo].appendedAnimations=e}else this[ko]=!0;this.dispatchEvent(new CustomEvent("finished"))}))}get availableAnimations(){return this.loaded?this[mo].animationNames:[]}get duration(){return this[mo].duration}get paused(){return this[ko]}get currentTime(){return this[mo].animationTime}get appendedAnimations(){return this[mo].appendedAnimations}set currentTime(t){this[mo].animationTime=t,this[go]()}get timeScale(){return this[mo].animationTimeScale}set timeScale(t){this[mo].animationTimeScale=t}pause(){this[ko]||(this[ko]=!0,this.dispatchEvent(new CustomEvent("pause")))}play(t){this.availableAnimations.length>0&&(this[ko]=!1,this[Lo](t),this.dispatchEvent(new CustomEvent("play")))}appendAnimation(t,e){this.availableAnimations.length>0&&(this[ko]=!1,this[Eo](t,e),this.dispatchEvent(new CustomEvent("append-animation")))}detachAnimation(t,e){this.availableAnimations.length>0&&(this[ko]=!1,this[Po](t,e),this.dispatchEvent(new CustomEvent("detach-animation")))}[(i=ko,vo)](){super[vo](),this[ko]=!0,null!=this.animationName&&this[Lo](),this.autoplay&&this.play()}[fo](t,e){super[fo](t,e),this[ko]||!this[xo]()&&!this[bo].isPresenting||(this[mo].updateAnimation(e/1e3),this[go]())}updated(t){super.updated(t),t.has("autoplay")&&this.autoplay&&this.play(),t.has("animationName")&&this[Lo]()}[Lo](t=Do){var e;const i=null!==(e=t.repetitions)&&void 0!==e?e:1/0,s=t.pingpong?ut:1===i?pt:dt;this[mo].playAnimation(this.animationName,this.animationCrossfadeDuration/1e3,s,i),this[ko]&&(this[mo].updateAnimation(0),this[go]())}[Eo](t="",e=Fo){var i;const s=null!==(i=e.repetitions)&&void 0!==i?i:1/0,n=e.pingpong?ut:1===s?pt:dt,a=!!e.repetitions||"pingpong"in e;this[mo].appendAnimation(t||this.animationName,n,s,e.weight,e.timeScale,e.fade,e.warp,e.relativeWarp,e.time,a),this[ko]&&(this[mo].updateAnimation(0),this[go]())}[Po](t="",e=Oo){this[mo].detachAnimation(t||this.animationName,e.fade),this[ko]&&(this[mo].updateAnimation(0),this[go]())}}return Ao([t({type:Boolean})],s.prototype,"autoplay",void 0),Ao([t({type:String,attribute:"animation-name"})],s.prototype,"animationName",void 0),Ao([t({type:Number,attribute:"animation-crossfade-duration"})],s.prototype,"animationCrossfadeDuration",void 0),s})(Ro))))))));customElements.define("model-viewer",Dl);export{Dl as ModelViewerElement};export default null;
//# sourceMappingURL=/sm/9e43ccd662efb71ccd97d72e3f0e8a20a78d2047c94aa0bbd86894385e810840.map